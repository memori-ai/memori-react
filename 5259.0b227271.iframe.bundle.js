"use strict";(self.webpackChunk_memori_ai_memori_react=self.webpackChunk_memori_ai_memori_react||[]).push([[5259],{"./src/components/ChatHistoryDrawer/ChatHistory.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>src_components_ChatHistoryDrawer_ChatHistory});var Drawer=__webpack_require__("./src/components/ui/Drawer.tsx"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),react=__webpack_require__("./node_modules/react/index.js"),Card=__webpack_require__("./src/components/ui/Card.tsx"),Button=__webpack_require__("./src/components/ui/Button.tsx"),Chat=__webpack_require__("./src/components/icons/Chat.tsx"),utils=__webpack_require__("./src/helpers/utils.ts"),dialog=__webpack_require__("./node_modules/@headlessui/react/dist/components/dialog/dialog.js"),debounce=__webpack_require__("./node_modules/lodash/debounce.js"),debounce_default=__webpack_require__.n(debounce),Chat_Chat=__webpack_require__("./src/components/Chat/Chat.tsx"),Spin=__webpack_require__("./src/components/ui/Spin.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),ChatHistoryDrawer_ChatHistory=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[7].use[1]!./src/components/ChatHistoryDrawer/ChatHistory.css"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(ChatHistoryDrawer_ChatHistory.A,options);ChatHistoryDrawer_ChatHistory.A&&ChatHistoryDrawer_ChatHistory.A.locals&&ChatHistoryDrawer_ChatHistory.A.locals;var Download=__webpack_require__("./src/components/icons/Download.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const calculateTitle=lines=>{const userMessages=lines.filter((line=>line.inbound));if(0===userMessages.length)return"";let messageIndex=0;3===userMessages.length?messageIndex=1:5===userMessages.length?messageIndex=3:userMessages.length>5&&(messageIndex=5);const message=(0,utils._e)(userMessages[messageIndex]?.text||"");return message.length>100?`${message.substring(0,100)}...`:message},downloadFile=(text,filename)=>{const data=new Blob([text],{type:"text/plain"}),url=URL.createObjectURL(data),element=document.createElement("a");element.setAttribute("href",url),element.setAttribute("download",filename),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element)},ChatHistoryDrawer=({open,onClose,apiClient,sessionId,memori,resumeSession,baseUrl,apiUrl,history})=>{const{t}=(0,useTranslation.B)(),{getChatLogsByUser,getSessionChatLogs}=apiClient.chatLogs,textCurrentChat=`${t("write_and_speak.conversationStartedLabel")} ${new Intl.DateTimeFormat("it",{dateStyle:"short",timeStyle:"short"}).format(new Date)}\n\n`.concat(history.map((m=>`${m.fromUser?"YOU":memori.name}: ${m.text}`)).join("\n")),[chatLogs,setChatLogs]=(0,react.useState)([]),[selectedChatLog,setSelectedChatLog]=(0,react.useState)(null),[currentPage,setCurrentPage]=(0,react.useState)(1),[searchText,setSearchText]=(0,react.useState)(""),[isLoading,setIsLoading]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null),[sortOrder,setSortOrder]=(0,react.useState)("desc"),fetchChatLogs=(0,react.useCallback)((async()=>{setIsLoading(!0),setError(null);try{const res=await getChatLogsByUser(sessionId);setChatLogs(res.chatLogs.sort(((a,b)=>{const dateA=Math.max(...a.lines.map((l=>new Date(l.timestamp).getTime()))),dateB=Math.max(...b.lines.map((l=>new Date(l.timestamp).getTime())));return"desc"===sortOrder?dateB-dateA:dateA-dateB})))}catch(err){setError(t("errorFetchingSession")||"Error loading chat history"),console.error("Error fetching chat logs:",err)}finally{setIsLoading(!1)}}),[sessionId,sortOrder]);(0,react.useEffect)((()=>{open&&fetchChatLogs()}),[open,fetchChatLogs]);const debouncedSearch=(0,react.useMemo)((()=>debounce_default()((value=>setSearchText(value)),300)),[]),filteredChatLogs=(0,react.useMemo)((()=>chatLogs.filter((c=>c.lines.some((l=>l.text.toLowerCase().includes(searchText.toLowerCase())))&&c.lines.length>1))),[chatLogs,searchText]),totalPages=Math.ceil(filteredChatLogs.length/8),paginatedChatLogs=(0,react.useMemo)((()=>{const startIndex=8*(currentPage-1);return filteredChatLogs.slice(startIndex,startIndex+8)}),[filteredChatLogs,currentPage]),handleResumeChat=async()=>{selectedChatLog&&(resumeSession(selectedChatLog),onClose())};return(0,jsx_runtime.jsx)(Drawer.A,{className:"memori-chat-history-drawer",open,onClose,title:(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--title-wrapper",style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,jsx_runtime.jsx)("span",{children:t("write_and_speak.chatHistory")||"Chat History"}),(0,jsx_runtime.jsx)(Button.A,{primary:!0,shape:"circle",className:"memori-chat-history-drawer--download-button",title:t("download")||"Download chat",icon:(0,jsx_runtime.jsx)(Download.default,{}),onClick:()=>{const fileName=`${memori.name.replace(/\W+/g,"-")}-chat-${(new Date).toISOString().split("T")[0]}.txt`;downloadFile(textCurrentChat,fileName)}})]}),description:t("write_and_speak.chatHistoryDescription"),children:(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--content",children:[(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--toolbar",children:[(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--toolbar--search",children:[(0,jsx_runtime.jsx)("input",{type:"search",className:"memori-chat-history-drawer--toolbar--search--input",placeholder:t("write_and_speak.searchInChatHistory")||"Search in chat history...",onChange:e=>debouncedSearch(e.target.value)}),(0,jsx_runtime.jsx)("span",{className:"memori-chat-history-drawer--toolbar--search--icon",children:(0,jsx_runtime.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--toolbar--actions",children:(0,jsx_runtime.jsx)(Button.A,{onClick:()=>{setSortOrder((order=>"asc"===order?"desc":"asc")),setCurrentPage(1)},className:"memori-chat-history-drawer--toolbar--sort-button",children:t("desc"===sortOrder?"write_and_speak.latestFirst":"write_and_speak.oldestFirst")})})]}),isLoading?(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--loading",children:[(0,jsx_runtime.jsx)(Spin.A,{spinning:!0,primary:!0,className:"memori-chat-history-drawer--loading--spinner"}),(0,jsx_runtime.jsx)("p",{className:"memori-chat-history-drawer--loading--text",children:t("write_and_speak.loadingChatHistory")||"Loading chat history..."})]}):error?(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--error",children:(0,jsx_runtime.jsx)("p",{children:error})}):chatLogs.length?0===filteredChatLogs.length?(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--no-results",children:(0,jsx_runtime.jsx)("p",{children:t("write_and_speak.noResultsFound",{searchText:searchText||""})||"No results found"})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("ul",{className:"memori-chat-history-drawer--list",children:paginatedChatLogs.map((chatLog=>{const lastMessageDate=Math.max(...chatLog.lines.map((line=>new Date(line.timestamp).getTime())));return(0,jsx_runtime.jsx)(Card.A,{hoverable:!0,onClick:async()=>{selectedChatLog?.chatLogID!==chatLog.chatLogID?setSelectedChatLog(chatLog):setSelectedChatLog(null)},className:"memori-chat-history-drawer--card "+(selectedChatLog?.chatLogID===chatLog.chatLogID?"memori-chat-history-drawer--card--selected":""),children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--card--header",children:(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--card--header--content",children:[(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--card--header--icon-wrapper",children:(0,jsx_runtime.jsx)(Chat.default,{className:"memori-chat-history-drawer--card--header--icon"})}),(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--card--header--info",children:(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--card--header--title-wrapper",children:[(0,jsx_runtime.jsx)(dialog.l.Title,{as:"h3",className:"memori-chat-history-drawer--card--header--title",children:calculateTitle(chatLog.lines)||"Chat-"+chatLog.chatLogID.substring(0,4)}),chatLog.boardOfExperts&&(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--card--header--badge",children:"BOE"})]})})]})}),(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--card--header--meta",children:[(0,jsx_runtime.jsxs)("time",{className:"memori-chat-history-drawer--card--header--meta--time",dateTime:new Date(lastMessageDate).toISOString(),children:[(0,jsx_runtime.jsx)("svg",{className:"memori-chat-history-drawer--card--header--meta--icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(timestamp=new Date(lastMessageDate).toISOString(),new Intl.DateTimeFormat(navigator.language,{dateStyle:"medium",timeStyle:"short"}).format(new Date(timestamp)))]}),chatLog.lines.some((line=>line.media&&line.media.filter((m=>"text/html"!==m.mimeType&&"text/plain"!==m.mimeType)).length>0))&&(0,jsx_runtime.jsxs)("span",{className:"memori-chat-history-drawer--card--header--meta--messages",children:[(0,jsx_runtime.jsx)("svg",{className:"memori-chat-history-drawer--card--header--meta--icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),chatLog.lines.reduce(((acc,line)=>acc+(line.media?.filter((m=>"text/html"!==m.mimeType&&"text/plain"!==m.mimeType)).length||0)),0)]}),(0,jsx_runtime.jsxs)("span",{className:"memori-chat-history-drawer--card--header--meta--messages",children:[(0,jsx_runtime.jsx)("svg",{className:"memori-chat-history-drawer--card--header--meta--icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),chatLog.lines.length]}),(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--card--content--header",children:(0,jsx_runtime.jsx)(Button.A,{className:"memori-chat-history-drawer--card--content--export-button",onClick:e=>((chatLog,e)=>{e.stopPropagation();const text=`${t("write_and_speak.conversationStartedLabel")} ${new Intl.DateTimeFormat(navigator.language,{dateStyle:"short",timeStyle:"short"}).format(new Date)}\n\n`.concat(chatLog.lines.map((line=>`${line.inbound?"YOU":memori.name}: ${line.text}`)).join("\n"));downloadFile(text,`${memori.name.replace(/\W+/g,"-")}-chat-${chatLog.chatLogID.substring(0,4)}.txt`)})(chatLog,e),children:(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--card--content--export-button--content",children:[(0,jsx_runtime.jsx)(Download.default,{className:"memori-chat-history-drawer--card--content--export-button--icon"}),(0,jsx_runtime.jsx)("span",{className:"memori-chat-history-drawer--card--content--export-button--text",children:t("write_and_speak.exportChat")||"Export Chat"})]})})})]}),selectedChatLog?.chatLogID===chatLog.chatLogID&&(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--card--content",children:[(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--card--content--messages",children:(0,jsx_runtime.jsx)(Chat_Chat.A,{baseUrl,apiUrl,memoriTyping:!1,showTypingText:!1,showAIicon:!0,showTranslationOriginal:!1,showWhyThisAnswer:!1,showCopyButton:!1,showInputs:!1,history:chatLog.lines.map((line=>({text:(0,utils.Sj)(line.text),contextVars:line.contextVars,media:line.media,fromUser:line.inbound,timestamp:line.timestamp}))),memori,sessionID:sessionId,setDialogState:()=>{},pushMessage:()=>{},simulateUserPrompt:()=>{},setSendOnEnter:()=>{},attachmentsMenuOpen:void 0,setAttachmentsMenuOpen:()=>{},userMessage:"",onChangeUserMessage:()=>{},sendMessage:()=>{},startListening:()=>{},stopListening:()=>{},resetTranscript:()=>{},listening:!1,setEnableFocusChatInput:()=>{},stopAudio:()=>{},isHistoryView:!0},`${chatLog.lines[0].text}-${chatLog.lines[0].timestamp}`)}),(0,jsx_runtime.jsx)("div",{className:"memori-chat-history-drawer--card--content--actions",children:(0,jsx_runtime.jsx)(Button.A,{className:"memori-chat-history-drawer--card--content--resume-button",primary:!0,onClick:handleResumeChat,children:(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--card--content--resume-button--content",children:[(0,jsx_runtime.jsx)(Chat.default,{className:"memori-chat-history-drawer--card--content--resume-button--icon"}),(0,jsx_runtime.jsx)("span",{className:"memori-chat-history-drawer--card--content--resume-button--text",children:t("write_and_speak.resumeButton")||"Resume chat"})]})})})]})]})},chatLog.chatLogID);var timestamp}))}),totalPages>1&&(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--pagination",children:[(0,jsx_runtime.jsx)(Button.A,{primary:!0,onClick:()=>setCurrentPage((p=>Math.max(1,p-1))),disabled:1===currentPage,className:"memori-chat-history-drawer--pagination--button",children:t("previous")||"Previous"}),(0,jsx_runtime.jsx)("span",{className:"memori-chat-history-drawer--pagination--info",children:t("write_and_speak.page",{current:currentPage,total:totalPages})}),(0,jsx_runtime.jsx)(Button.A,{primary:!0,onClick:()=>setCurrentPage((p=>Math.min(totalPages,p+1))),disabled:currentPage===totalPages,className:"memori-chat-history-drawer--pagination--button",children:t("next")||"Next"})]})]}):(0,jsx_runtime.jsxs)("div",{className:"memori-chat-history-drawer--empty",children:[(0,jsx_runtime.jsx)(Chat.default,{className:"memori-chat-history-drawer--empty--icon"}),(0,jsx_runtime.jsx)("p",{className:"memori-chat-history-drawer--empty--text",children:t("write_and_speak.noChatHistoryAvailable")||"No chat history available"})]})]})})};ChatHistoryDrawer.displayName="ChatHistoryDrawer";const src_components_ChatHistoryDrawer_ChatHistory=ChatHistoryDrawer;try{ChatHistory.displayName="ChatHistory",ChatHistory.__docgenInfo={description:"",displayName:"ChatHistory",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},apiClient:{defaultValue:null,description:"",name:"apiClient",required:!0,type:{name:'{ constants: { BACKEND_URL: string; ENGINE_URL: string; allowedMediaTypes: string[]; anonTag: "👤"; }; asset: { getResourceUrl: ({ type, resourceURI, sessionID, baseURL, }: ResourceURLParams) => string; }; getAllFunctions: (sessionId: string) => Promise<...>; ... 134 more ...; backend: { ...; }; }'}},sessionId:{defaultValue:null,description:"",name:"sessionId",required:!0,type:{name:"string"}},memori:{defaultValue:null,description:"",name:"memori",required:!0,type:{name:"Memori"}},resumeSession:{defaultValue:null,description:"",name:"resumeSession",required:!0,type:{name:"(chatLog: ChatLog) => void"}},baseUrl:{defaultValue:null,description:"",name:"baseUrl",required:!0,type:{name:"string"}},apiUrl:{defaultValue:null,description:"",name:"apiUrl",required:!0,type:{name:"string"}},history:{defaultValue:null,description:"",name:"history",required:!0,type:{name:"Message[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ChatHistoryDrawer/ChatHistory.tsx#ChatHistory"]={docgenInfo:ChatHistory.__docgenInfo,name:"ChatHistory",path:"src/components/ChatHistoryDrawer/ChatHistory.tsx#ChatHistory"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/Chat.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const ChatRound=({className,title})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("svg",{...title?{}:{"aria-hidden":"true"},focusable:"false",width:"24",height:"24",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",className,"aria-label":title,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.5997 2.37562 15.1116 3.04346 16.4525C3.22094 16.8088 3.28001 17.2161 3.17712 17.6006L2.58151 19.8267C2.32295 20.793 3.20701 21.677 4.17335 21.4185L6.39939 20.8229C6.78393 20.72 7.19121 20.7791 7.54753 20.9565C8.88837 21.6244 10.4003 22 12 22Z",stroke:"currentColor","stroke-width":"1.5"})});ChatRound.displayName="ChatRound";const __WEBPACK_DEFAULT_EXPORT__=ChatRound;try{Chat.displayName="Chat",Chat.__docgenInfo={description:"",displayName:"Chat",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Chat.tsx#Chat"]={docgenInfo:Chat.__docgenInfo,name:"Chat",path:"src/components/icons/Chat.tsx#Chat"})}catch(__react_docgen_typescript_loader_error){}}}]);