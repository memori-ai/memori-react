"use strict";(self.webpackChunk_memori_ai_memori_react=self.webpackChunk_memori_ai_memori_react||[]).push([[5527],{"./src/components/AgeVerificationModal/AgeVerificationModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react_i18next__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),react_hot_toast__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs"),_ui_Button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/ui/Button.tsx"),_ui_Modal__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/ui/Modal.tsx"),luxon__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/luxon/src/luxon.js"),_DateSelector_DateSelector__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/DateSelector/DateSelector.tsx"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/react/jsx-runtime.js");const AgeVerificationModal=({visible=!1,onClose,minAge})=>{const{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_0__.B)(),[birthDate,setBirthDate]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(),[error,setError]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(),[submitting,setSubmitting]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1),onSubmit=(0,react__WEBPACK_IMPORTED_MODULE_6__.useCallback)(()=>{if(setSubmitting(!0),!birthDate)return react_hot_toast__WEBPACK_IMPORTED_MODULE_1__.Ay.error(t("requiredField")),setError(t("requiredField")||"Required field"),void setSubmitting(!1);if(luxon__WEBPACK_IMPORTED_MODULE_4__.c9.now().diff(birthDate,"years").years<minAge)return react_hot_toast__WEBPACK_IMPORTED_MODULE_1__.Ay.error(t("underageTwinSession",{age:minAge})),setError(t("underageTwinSession",{age:minAge})||`You must be at least ${minAge} years old to interact with this Agent`),void setSubmitting(!1);onClose(birthDate.toJSDate().toISOString())},[birthDate,minAge,onClose,t]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_3__.A,{open:visible,title:t("ageVerification"),className:"age-verification-modal",closable:!0,onClose:()=>onClose(),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("p",{children:t("ageVerificationText",{minAge})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("form",{className:"age-verification-form",onSubmit:e=>{e.preventDefault(),onSubmit()},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:"form-item",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("fieldset",{name:"birthDate",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("legend",{className:"sr-only",children:t("birthDate")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_DateSelector_DateSelector__WEBPACK_IMPORTED_MODULE_5__.A,{defaultDate:new Date(Date.now()),onChange:date=>{setBirthDate(date)}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("p",{className:"form-item-help",children:t("birthDateHelper")}),error&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("p",{className:"form-item-error",children:error})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:"form-item form-submit",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_2__.A,{primary:!0,htmlType:"submit",className:"age-verification-submit",loading:submitting,disabled:!birthDate,children:t("confirm")})})]})]})};AgeVerificationModal.displayName="AgeVerificationModal";const __WEBPACK_DEFAULT_EXPORT__=AgeVerificationModal;try{AgeVerificationModal.displayName="AgeVerificationModal",AgeVerificationModal.__docgenInfo={description:"",displayName:"AgeVerificationModal",props:{visible:{defaultValue:{value:"false"},description:"",name:"visible",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"(birthDate?: string | undefined) => void"}},minAge:{defaultValue:null,description:"",name:"minAge",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/AgeVerificationModal/AgeVerificationModal.tsx#AgeVerificationModal"]={docgenInfo:AgeVerificationModal.__docgenInfo,name:"AgeVerificationModal",path:"src/components/AgeVerificationModal/AgeVerificationModal.tsx#AgeVerificationModal"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/Auth/Auth.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_i18next__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),_ui_Button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/ui/Button.tsx"),_ui_Modal__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/ui/Modal.tsx"),react_hook_form__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react-hook-form/dist/index.esm.mjs"),_icons_Plus__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/icons/Plus.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");const AuthWidget=({pwdOrTokens,setPwdOrTokens,onFinish,minimumNumberOfRecoveryTokens=1,showTokens=!0,openModal=!1,withModal=!1})=>{const{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_1__.B)(),{register,handleSubmit,formState:{errors},setError}=(0,react_hook_form__WEBPACK_IMPORTED_MODULE_4__.mN)(),[numTokens,setNumTokens]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(1),[showModal,setShowModal]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!!pwdOrTokens),form=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("form",{name:"memoriAuth",onSubmit:handleSubmit(data=>{"password"===pwdOrTokens&&!data.password?.length||"tokens"===pwdOrTokens&&((data?.tokens?.length||0)<minimumNumberOfRecoveryTokens||!data?.tokens?.every(t=>t.length))?setError("tokens",{type:"minLength",message:"Tokens"}):onFinish&&onFinish(data).then(()=>{setShowModal(!1)})}),className:"memori-auth-widget--form",children:[("password"===pwdOrTokens||!showTokens)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("fieldset",{className:"memori-auth-widget--password-fieldset",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("label",{children:["Password:"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("input",{className:"memori-auth-widget--input",required:!0,type:"password",placeholder:"Password",...register("password",{required:!0})})]}),showTokens&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("hr",{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_2__.A,{outlined:!0,onClick:()=>setPwdOrTokens("tokens"),children:t("auth.useRecoveryTokens")||"Recovery tokens"})]})]}),"tokens"===pwdOrTokens&&showTokens&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("fieldset",{className:"memori-auth-widget--tokens-fieldset",name:"tokens",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("legend",{children:[t("auth.tokens"),": "]}),(length=numTokens,Array.from({length},(_,i)=>i)).map(idx=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{className:"memori-auth-widget--token",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("input",{type:"password",className:"memori-auth-widget--input",placeholder:"Recovery token",required:!0,autoComplete:"off",...register(`tokens.${idx}`,{required:!0})})},idx)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_2__.A,{onClick:()=>setNumTokens(t=>t+1),className:"memori-auth-widget--token-add",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_icons_Plus__WEBPACK_IMPORTED_MODULE_5__.default,{}),children:t("auth.addToken")||"Add token"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("hr",{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_2__.A,{outlined:!0,onClick:()=>setPwdOrTokens("password"),children:t("auth.usePassword")||"Password"})]}),"minLength"===errors.tokens?.type&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"memori-auth-widget--error",children:[t("auth.atLeast")||"At least"," ",minimumNumberOfRecoveryTokens]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_2__.A,{htmlType:"submit",primary:!0,className:"memori-auth-widget--submit",children:t("confirm")||"Submit"})]});var length;return withModal?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_3__.A,{open:openModal||showModal,title:t("auth.title")||"Authentication",onClose:()=>setPwdOrTokens(null),closable:!1,children:form}):form},__WEBPACK_DEFAULT_EXPORT__=AuthWidget;try{AuthWidget.displayName="AuthWidget",AuthWidget.__docgenInfo={description:"",displayName:"AuthWidget",props:{pwdOrTokens:{defaultValue:null,description:"",name:"pwdOrTokens",required:!0,type:{name:'"password" | "tokens" | null'}},setPwdOrTokens:{defaultValue:null,description:"",name:"setPwdOrTokens",required:!0,type:{name:'(state: "password" | "tokens" | null) => void'}},onFinish:{defaultValue:null,description:"",name:"onFinish",required:!1,type:{name:"((values: AuthInputs) => Promise<void>)"}},minimumNumberOfRecoveryTokens:{defaultValue:{value:"1"},description:"",name:"minimumNumberOfRecoveryTokens",required:!1,type:{name:"number"}},showTokens:{defaultValue:{value:"true"},description:"",name:"showTokens",required:!1,type:{name:"boolean"}},withModal:{defaultValue:{value:"false"},description:"",name:"withModal",required:!1,type:{name:"boolean"}},openModal:{defaultValue:{value:"false"},description:"",name:"openModal",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Auth/Auth.tsx#AuthWidget"]={docgenInfo:AuthWidget.__docgenInfo,name:"AuthWidget",path:"src/components/Auth/Auth.tsx#AuthWidget"})}catch(__react_docgen_typescript_loader_error){}try{Auth.displayName="Auth",Auth.__docgenInfo={description:"",displayName:"Auth",props:{pwdOrTokens:{defaultValue:null,description:"",name:"pwdOrTokens",required:!0,type:{name:'"password" | "tokens" | null'}},setPwdOrTokens:{defaultValue:null,description:"",name:"setPwdOrTokens",required:!0,type:{name:'(state: "password" | "tokens" | null) => void'}},onFinish:{defaultValue:null,description:"",name:"onFinish",required:!1,type:{name:"((values: AuthInputs) => Promise<void>)"}},minimumNumberOfRecoveryTokens:{defaultValue:{value:"1"},description:"",name:"minimumNumberOfRecoveryTokens",required:!1,type:{name:"number"}},showTokens:{defaultValue:{value:"true"},description:"",name:"showTokens",required:!1,type:{name:"boolean"}},withModal:{defaultValue:{value:"false"},description:"",name:"withModal",required:!1,type:{name:"boolean"}},openModal:{defaultValue:{value:"false"},description:"",name:"openModal",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Auth/Auth.tsx#Auth"]={docgenInfo:Auth.__docgenInfo,name:"Auth",path:"src/components/Auth/Auth.tsx#Auth"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/Avatar/Avatar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>Avatar_Avatar});var react=__webpack_require__("./node_modules/react/index.js"),Button=__webpack_require__("./src/components/ui/Button.tsx"),withTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/withTranslation.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");class ErrorBoundary extends react.Component{state={hasError:!1};static getDerivedStateFromError(_){return{hasError:!0}}componentDidCatch(error,errorInfo){console.error("Uncaught error:",error,errorInfo)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,jsx_runtime.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.4)",color:"#000",padding:"2rem",borderRadius:"10px"},children:[(0,jsx_runtime.jsx)("h2",{children:this.props.t("error.generic")}),(0,jsx_runtime.jsx)(Button.A,{primary:!0,onClick:()=>this.setState({hasError:!1}),children:this.props.t("error.tryAgain")||"Try again"})]}):this.props.children}}ErrorBoundary.displayName="ErrorBoundary";const ErrorBoundary_ErrorBoundary=(0,withTranslation.C)(["common"])(ErrorBoundary);var Tooltip=__webpack_require__("./src/components/ui/Tooltip.tsx"),media=__webpack_require__("./src/helpers/media.ts"),Blob=__webpack_require__("./src/components/Blob/Blob.tsx"),ModelViewer=__webpack_require__("./src/components/CustomGLBModelViewer/ModelViewer.tsx"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),Eye=__webpack_require__("./src/components/icons/Eye.tsx"),EyeInvisible=__webpack_require__("./src/components/icons/EyeInvisible.tsx"),Edit=__webpack_require__("./src/components/icons/Edit.tsx"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),AvatarView=__webpack_require__("./src/components/Avatar/AvatarView/index.tsx"),visemeContext=__webpack_require__("./src/context/visemeContext.tsx");const Avatar=({memori,integration,integrationConfig,tenant,instruct=!1,avatar3dVisible=!1,setAvatar3dVisible,hasUserActivatedSpeak=!1,isPlayingAudio=!1,loading=!1,baseUrl,apiUrl,animation,isZoomed=!1,chatProps,avatarType=null,enablePositionControls,setEnablePositionControls,isTotem=!1})=>{const{t}=(0,useTranslation.B)(),[isClient,setIsClient]=(0,react.useState)(!1),{stopProcessing,updateCurrentViseme,resetVisemeQueue}=(0,visemeContext.zE)();(0,react.useEffect)(()=>{setIsClient(!0)},[]);const getAvatarUrl=()=>{if("userAvatar"===integrationConfig?.avatar&&memori.avatarURL&&memori.avatarURL.length>0)return(0,media.A)({type:"avatar",tenantID:tenant?.name,resourceURI:memori.avatarURL,baseURL:baseUrl,apiURL:apiUrl})},renderAvatarContent=()=>isClient?"readyplayerme"===integrationConfig?.avatar||"readyplayerme-full"===integrationConfig?.avatar||"customrpm"===integrationConfig?.avatar?(0,jsx_runtime.jsx)(ErrorBoundary_ErrorBoundary,{fallback:(0,jsx_runtime.jsx)("div",{className:"memori--blob-container",children:isClient&&(0,jsx_runtime.jsx)(Blob.A,{speaking:isPlayingAudio,avatar:getAvatarUrl()})}),children:(0,jsx_runtime.jsx)(AvatarView.A,{enablePositionControls,updateCurrentViseme,url:integrationConfig.avatarURL,sex:"FEMALE"===memori.voiceType?"FEMALE":"MALE",fallbackImg:getAvatarUrl(),headMovement:!0,eyeBlink:!0,animation,halfBody:"readyplayerme"===integrationConfig.avatar,speaking:isPlayingAudio,loading,style:getAvatarStyle(),stopProcessing,resetVisemeQueue,isZoomed,isTotem,chatEmission:chatProps?.dialogState?.emission,setEnablePositionControls})}):"customglb"===integrationConfig?.avatar?(0,jsx_runtime.jsx)(ModelViewer.A,{poster:getAvatarUrl()||"",src:integrationConfig.avatarURL,alt:""}):null:null,renderAvatarToggle=()=>(0,jsx_runtime.jsx)("div",{className:"memori--avatar-toggle",children:(0,jsx_runtime.jsx)(Button.A,{ghost:!0,onClick:()=>setAvatar3dVisible(!avatar3dVisible),icon:avatar3dVisible?(0,jsx_runtime.jsx)(EyeInvisible.default,{}):(0,jsx_runtime.jsx)(Eye.default,{}),children:(0,jsx_runtime.jsx)("span",{className:"memori--avatar-toggle-text",children:t(avatar3dVisible?"hide":"show")})})}),getAvatarStyle=()=>"readyplayerme"===integrationConfig?.avatar?{width:"100%",height:"100%",backgroundColor:"none",boxShadow:"none"}:{width:"100%",height:"100%",backgroundColor:"none"};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[("readyplayerme"===integrationConfig?.avatar||"readyplayerme-full"===integrationConfig?.avatar||"customglb"===integrationConfig?.avatar||"customrpm"===integrationConfig?.avatar)&&integrationConfig?.avatarURL&&avatarType&&"blob"!==avatarType?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:classnames_default()("memori--avatar-wrapper",`memori--avatar-${integrationConfig?.avatar||"default"}`,{hidden:!avatar3dVisible}),children:renderAvatarContent()}),renderAvatarToggle()]}):(0,jsx_runtime.jsx)("div",{className:"memori--blob-container",children:isClient&&(0,jsx_runtime.jsx)(Blob.A,{speaking:isPlayingAudio,avatar:getAvatarUrl()})}),(()=>{if(!instruct||hasUserActivatedSpeak||!memori.isGiver||!tenant?.name)return null;const href=`https://${tenant.name}/${"it-IT"===memori.culture?"it":"en"}/${memori.ownerUserName}/${memori.name}/integrations${integration?.integrationID?`?integration=${integration.integrationID}&openAvatarModal=true`:""}`;return(0,jsx_runtime.jsx)("div",{className:"memori--avatar-link-to-integrations",children:(0,jsx_runtime.jsx)("a",{className:"memori-button memori-button--circle memori-button--outlined",href,children:(0,jsx_runtime.jsx)(Tooltip.A,{content:t("widgetgoToIntegrationsToCustomizeAvatar"),children:(0,jsx_runtime.jsx)("span",{className:"memori-button--icon",children:(0,jsx_runtime.jsx)(Edit.default,{})})})})})})()]})},Avatar_Avatar=(0,react.memo)(Avatar,(prevProps,nextProps)=>JSON.stringify(prevProps)===JSON.stringify(nextProps));try{Avatar.displayName="Avatar",Avatar.__docgenInfo={description:"",displayName:"Avatar",props:{memori:{defaultValue:null,description:"",name:"memori",required:!0,type:{name:"Memori"}},integration:{defaultValue:null,description:"",name:"integration",required:!1,type:{name:"Integration"}},integrationConfig:{defaultValue:null,description:"",name:"integrationConfig",required:!1,type:{name:"{ [key: string]: any; }"}},tenant:{defaultValue:null,description:"",name:"tenant",required:!1,type:{name:"Tenant"}},instruct:{defaultValue:{value:"false"},description:"",name:"instruct",required:!1,type:{name:"boolean"}},hasUserActivatedSpeak:{defaultValue:{value:"false"},description:"",name:"hasUserActivatedSpeak",required:!1,type:{name:"boolean"}},avatar3dVisible:{defaultValue:{value:"false"},description:"",name:"avatar3dVisible",required:!1,type:{name:"boolean"}},setAvatar3dVisible:{defaultValue:null,description:"",name:"setAvatar3dVisible",required:!0,type:{name:"(visible: boolean) => void"}},isPlayingAudio:{defaultValue:{value:"false"},description:"",name:"isPlayingAudio",required:!1,type:{name:"boolean"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},baseUrl:{defaultValue:null,description:"",name:"baseUrl",required:!1,type:{name:"string"}},apiUrl:{defaultValue:null,description:"",name:"apiUrl",required:!1,type:{name:"string"}},animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:"string"}},isZoomed:{defaultValue:{value:"false"},description:"",name:"isZoomed",required:!1,type:{name:"boolean"}},chatProps:{defaultValue:null,description:"",name:"chatProps",required:!1,type:{name:"any"}},enablePositionControls:{defaultValue:null,description:"",name:"enablePositionControls",required:!1,type:{name:"boolean"}},setEnablePositionControls:{defaultValue:null,description:"",name:"setEnablePositionControls",required:!0,type:{name:"(value: boolean) => void"}},avatarType:{defaultValue:{value:"null"},description:"",name:"avatarType",required:!1,type:{name:'"blob" | "avatar3d" | null'}},isTotem:{defaultValue:{value:"false"},description:"",name:"isTotem",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/Avatar.tsx#Avatar"]={docgenInfo:Avatar.__docgenInfo,name:"Avatar",path:"src/components/Avatar/Avatar.tsx#Avatar"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/Blob/Blob.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const ExperienceBlob=({avatar,speaking=!1})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("memori-blob",{"memori-blob--speaking":speaking}),children:[avatar&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("figure",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("img",{src:avatar,alt:"",role:"presentation"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"mainDiv"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"mainDiv"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"mainDiv"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"mainDiv"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"mainDiv"})]});ExperienceBlob.displayName="ExperienceBlob";const __WEBPACK_DEFAULT_EXPORT__=ExperienceBlob;try{Blob.displayName="Blob",Blob.__docgenInfo={description:"",displayName:"Blob",props:{avatar:{defaultValue:null,description:"",name:"avatar",required:!1,type:{name:"string"}},speaking:{defaultValue:{value:"false"},description:"",name:"speaking",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Blob/Blob.tsx#Blob"]={docgenInfo:Blob.__docgenInfo,name:"Blob",path:"src/components/Blob/Blob.tsx#Blob"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/DateSelector/DateSelector.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_headlessui_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@headlessui/react/dist/components/listbox/listbox.js"),_headlessui_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@headlessui/react/dist/components/transitions/transition.js"),luxon__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/luxon/src/luxon.js"),react_i18next__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),_icons_SelectIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/icons/SelectIcon.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");const months={en:["January","February","March","April","May","June","July","August","September","October","November","December"],it:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"]},DateSelector=(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(({defaultDate,onChange,disabled=!1})=>{const{t,i18n}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_4__.B)(),[date,setDate]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultDate?"string"==typeof defaultDate?luxon__WEBPACK_IMPORTED_MODULE_3__.c9.fromISO(defaultDate):luxon__WEBPACK_IMPORTED_MODULE_3__.c9.fromJSDate(defaultDate):luxon__WEBPACK_IMPORTED_MODULE_3__.c9.now());return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{onChange(date)},[date,onChange]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"memori--date-selector",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"memori--date-selector__select",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W,{value:date,onChange:value=>{setDate(value)},disabled,name:"day",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Label,{className:"memori--date-selector__select-label",children:[t("day"),":"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Button,{"aria-label":t("day"),className:"memori--date-selector__select-button",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"memori--date-selector__select--value",children:date.day}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"memori--date-selector__select--icon",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_icons_SelectIcon__WEBPACK_IMPORTED_MODULE_5__.default,{})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_2__.e,{as:react__WEBPACK_IMPORTED_MODULE_0__.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Options,{className:"memori--date-selector__select-options",children:[...Array(31).keys()].map(day=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Option,{value:date.set({day:day+1}),className:"memori--date-selector__select-option",children:day+1},day))})})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"memori--date-selector__select",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W,{value:date,onChange:value=>{setDate(value)},disabled,name:"month",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Label,{className:"memori--date-selector__select-label",children:[t("month"),":"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Button,{"aria-label":t("month"),className:"memori--date-selector__select-button",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"memori--date-selector__select--value",children:months["it"===i18n.language?"it":"en"][date.month-1]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"memori--date-selector__select--icon",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_icons_SelectIcon__WEBPACK_IMPORTED_MODULE_5__.default,{})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_2__.e,{as:react__WEBPACK_IMPORTED_MODULE_0__.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Options,{className:"memori--date-selector__select-options",children:months["it"===i18n.language?"it":"en"].map(month=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Option,{className:"memori--date-selector__select-option",value:date.set({month:months["it"===i18n.language?"it":"en"].findIndex(m=>m===month)+1}),children:month},month))})})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"memori--date-selector__select",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W,{value:date,onChange:value=>{setDate(value)},disabled,name:"year",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Label,{className:"memori--date-selector__select-label",children:[t("year"),":"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Button,{"aria-label":t("year"),className:"memori--date-selector__select-button",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"memori--date-selector__select--value",children:date.year}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"memori--date-selector__select--icon",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_icons_SelectIcon__WEBPACK_IMPORTED_MODULE_5__.default,{})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_2__.e,{as:react__WEBPACK_IMPORTED_MODULE_0__.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Options,{className:"memori--date-selector__select-options",children:[...Array(luxon__WEBPACK_IMPORTED_MODULE_3__.c9.now().year-1899).keys()].sort((a,b)=>b-a).map(year=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_1__.W.Option,{value:date.set({year:year+1900}),className:"memori--date-selector__select-option",children:year+1900},year))})})]})})]})});DateSelector.displayName="DateSelector";const __WEBPACK_DEFAULT_EXPORT__=DateSelector;try{DateSelector.displayName="DateSelector",DateSelector.__docgenInfo={description:"",displayName:"DateSelector",props:{defaultDate:{defaultValue:null,description:"",name:"defaultDate",required:!1,type:{name:"string | Date"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(date: DateTime<boolean>) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/DateSelector/DateSelector.tsx#DateSelector"]={docgenInfo:DateSelector.__docgenInfo,name:"DateSelector",path:"src/components/DateSelector/DateSelector.tsx#DateSelector"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/ExpertsDrawer/ExpertsDrawer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _ui_Drawer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/components/ui/Drawer.tsx"),react_i18next__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),_helpers_media__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/helpers/media.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");const ExpertsDrawer=({open=!1,baseUrl,apiUrl,tenant,experts,onClose})=>{const{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_1__.B)();return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Drawer__WEBPACK_IMPORTED_MODULE_0__.A,{open,onClose,className:"memori--experts-drawer",title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h2",{className:"memori--experts-drawer--title",children:t("widget.expertsInTheBoard")}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("ul",{className:"memori--experts-drawer--list",children:experts.map(expert=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("li",{className:"memori--experts-drawer--item",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("figure",{className:"memori--experts-drawer--avatar",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("img",{src:`${new URL(apiUrl).origin}/api/v1/memoriai/memori/avatar/${expert.expertMemoriID}`,alt:expert.name,onError:e=>{e.currentTarget.src=(0,_helpers_media__WEBPACK_IMPORTED_MODULE_2__.A)({tenantID:tenant?.name,type:"avatar",baseURL:baseUrl}),e.currentTarget.onerror=null}})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"memori--experts-drawer--content",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h3",{className:"memori--experts-drawer--name",children:expert.name}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"memori--experts-drawer--description",children:expert.description})]})]},expert.expertID))})})};ExpertsDrawer.displayName="ExpertsDrawer";const __WEBPACK_DEFAULT_EXPORT__=ExpertsDrawer;try{ExpertsDrawer.displayName="ExpertsDrawer",ExpertsDrawer.__docgenInfo={description:"",displayName:"ExpertsDrawer",props:{experts:{defaultValue:null,description:"",name:"experts",required:!0,type:{name:"ExpertReference[]"}},baseUrl:{defaultValue:null,description:"",name:"baseUrl",required:!0,type:{name:"string"}},apiUrl:{defaultValue:null,description:"",name:"apiUrl",required:!0,type:{name:"string"}},tenant:{defaultValue:null,description:"",name:"tenant",required:!1,type:{name:"Tenant"}},open:{defaultValue:{value:"false"},description:"",name:"open",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ExpertsDrawer/ExpertsDrawer.tsx#ExpertsDrawer"]={docgenInfo:ExpertsDrawer.__docgenInfo,name:"ExpertsDrawer",path:"src/components/ExpertsDrawer/ExpertsDrawer.tsx#ExpertsDrawer"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/KnownFacts/KnownFacts.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_ui_Button__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/components/ui/Button.tsx"),_ui_Drawer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/ui/Drawer.tsx"),_ui_Spin__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/ui/Spin.tsx"),_ui_Modal__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/components/ui/Modal.tsx"),react_hot_toast__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs"),_helpers_error__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/helpers/error.ts"),react_i18next__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),_icons_Delete__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/components/icons/Delete.tsx"),_ui_Checkbox__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/components/ui/Checkbox.tsx"),_ui_Select__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/components/ui/Select.tsx"),_icons_ChevronLeft__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./src/components/icons/ChevronLeft.tsx"),_icons_ChevronRight__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./src/components/icons/ChevronRight.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/react/jsx-runtime.js");const KnownFacts=({apiClient,sessionID,memori,visible=!0,initialKnownFacts=[],closeDrawer})=>{const{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_7__.B)(),{getKnownFactsPaginated,deleteKnownFact}=apiClient.knownFacts,[knownFacts,setKnownFacts]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(initialKnownFacts),[numberOfResults,setNumberOfResults]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(25),[pageIndex,setPageIndex]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(0),[knownFactsCount,setKnownFactsCount]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(initialKnownFacts?.length??0),[loading,setLoading]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),fetchKnownFacts=async(sessionId,from,howMany)=>{if(sessionID||sessionId){setLoading(!0);try{const{knownFacts,count,...response}=await getKnownFactsPaginated(sessionId??sessionID,from??pageIndex,howMany??numberOfResults);setKnownFacts(knownFacts??initialKnownFacts),setKnownFactsCount(count??0),0!==response.resultCode&&(console.error(response),react_hot_toast__WEBPACK_IMPORTED_MODULE_5__.Ay.error(t((0,_helpers_error__WEBPACK_IMPORTED_MODULE_6__._)(response.resultCode))))}catch(err){console.error("KNOWN_FACTS/FETCH",err),setKnownFacts(initialKnownFacts??[])}setLoading(!1)}};(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{fetchKnownFacts()},[]);const[bulkDeleteModalVisible,setBulkDeleteModalVisible]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[deleteModalVisibleFor,setDeleteModalVisibleFor]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(),[selectedRowKeys,setSelectedRowKeys]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_ui_Drawer__WEBPACK_IMPORTED_MODULE_2__.A,{open:visible,width:"80%",className:"memori-known-facts-drawer",onClose:()=>closeDrawer(),title:t("knownFacts.title"),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("p",{children:t("knownFacts.description",{memoriName:memori.name})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_ui_Spin__WEBPACK_IMPORTED_MODULE_3__.A,{spinning:loading,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"memori-known-facts-actions",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_1__.A,{primary:!0,danger:!0,onClick:()=>{setBulkDeleteModalVisible(!0)},className:"memori-known-facts-delete-selected",disabled:0===selectedRowKeys?.length,icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_icons_Delete__WEBPACK_IMPORTED_MODULE_8__.default,{}),loading,children:[t("selected")," (",selectedRowKeys?.length,")"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_4__.A,{className:"memori-known-facts-modal",open:bulkDeleteModalVisible,closable:!0,title:selectedRowKeys.length>1?t("knownFacts.deleteSelectedConfirmTitle"):t("knownFacts.deleteConfirmTitle"),description:selectedRowKeys.length>1?t("knownFacts.deleteSelectedConfirmMessage",{number:selectedRowKeys.length}):t("knownFacts.deleteConfirmMessage"),onClose:()=>{setBulkDeleteModalVisible(!1)},footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_1__.A,{ghost:!0,onClick:()=>{setBulkDeleteModalVisible(!1)},children:t("cancel")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_1__.A,{primary:!0,danger:!0,onClick:async()=>{try{const mutations=selectedRowKeys.map(key=>deleteKnownFact(sessionID,key));Promise.all(mutations).then(responses=>{if(responses.every(r=>0===r.resultCode))react_hot_toast__WEBPACK_IMPORTED_MODULE_5__.Ay.success(t("knownFacts.deleteSuccess")),setSelectedRowKeys([]),fetchKnownFacts(),setBulkDeleteModalVisible(!1);else{let errored=responses.find(r=>0!==r.resultCode);console.error(errored),void 0!==errored?.resultCode&&react_hot_toast__WEBPACK_IMPORTED_MODULE_5__.Ay.error(t((0,_helpers_error__WEBPACK_IMPORTED_MODULE_6__._)(errored?.resultCode)))}})}catch(_e){let error=_e;react_hot_toast__WEBPACK_IMPORTED_MODULE_5__.Ay.error(t("Error")+error.message)}},children:t("confirm")})]})})]}),knownFactsCount>25&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("nav",{className:"memori--table--pagination",children:[knownFactsCount>numberOfResults&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"memori--table--pagination--pages",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_1__.A,{shape:"circle",disabled:0===pageIndex||pageIndex<numberOfResults,padded:!1,title:t("previous")||"Previous",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_icons_ChevronLeft__WEBPACK_IMPORTED_MODULE_11__.default,{}),onClick:()=>{let from=(pageIndex/numberOfResults-1)*numberOfResults;setPageIndex(from),fetchKnownFacts(void 0,from,numberOfResults)}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("span",{className:"memori--table--pagination--pages--current",children:[Math.ceil(pageIndex/numberOfResults)+1," /"," ",Math.ceil(knownFactsCount/numberOfResults)]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_1__.A,{shape:"circle",padded:!1,title:t("next")||"Next",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_icons_ChevronRight__WEBPACK_IMPORTED_MODULE_12__.default,{}),disabled:(pageIndex/numberOfResults+1)*numberOfResults>=knownFactsCount,onClick:()=>{let from=(pageIndex/numberOfResults+1)*numberOfResults;setPageIndex(from),fetchKnownFacts(void 0,from,numberOfResults)}})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Select__WEBPACK_IMPORTED_MODULE_10__.A,{options:[{label:`25 / ${t("page")||"page"}`,value:25},{label:`50 / ${t("page")||"page"}`,value:50},{label:`100 / ${t("page")||"page"}`,value:100}],value:numberOfResults,displayValue:`${numberOfResults} / ${t("page")||"page"}`,onChange:value=>{setNumberOfResults(value),setPageIndex(0),fetchKnownFacts(void 0,0,value)}})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("table",{className:"memori--table",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("thead",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("tr",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("th",{className:"memori--table--column-centered",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_9__.A,{checked:!!knownFacts?.length&&selectedRowKeys?.length===knownFacts.length,indeterminate:!!knownFacts?.length&&!!selectedRowKeys?.length&&selectedRowKeys?.length!==knownFacts?.length,onChange:e=>{e.target.checked?setSelectedRowKeys(knownFacts.map(kf=>kf.knownFactID)):setSelectedRowKeys([])}})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("th",{children:t("knownFacts.text")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("th",{className:"mobile-hidden",children:t("createdAt")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("th",{className:"memori--table--column-right",children:t("actions")})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("tbody",{children:knownFacts.map(kf=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("tr",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("th",{className:"memori--table--column-centered",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_9__.A,{checked:selectedRowKeys?.includes(kf.knownFactID),onChange:e=>{e.target.checked?setSelectedRowKeys(srk=>[...new Set([...srk,kf.knownFactID])]):setSelectedRowKeys(srk=>srk.filter(key=>key!==kf.knownFactID))}})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("td",{children:kf.text}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("td",{className:"mobile-hidden",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{className:"memori--table--date",children:kf.creationTimestamp?new Intl.DateTimeFormat("it",{dateStyle:"short",timeStyle:"short"}).format(new Date(kf.creationTimestamp)):"-"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("td",{className:"memori--table--column-right",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"memori--table--action-column",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_1__.A,{danger:!0,ghost:!0,shape:"circle",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_icons_Delete__WEBPACK_IMPORTED_MODULE_8__.default,{}),disabled:selectedRowKeys?.length>0,title:t("delete")||"Delete",onClick:()=>setDeleteModalVisibleFor(kf.knownFactID)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_4__.A,{className:"memori-known-facts-modal",open:deleteModalVisibleFor===kf.knownFactID,closable:!0,title:t("knownFacts.deleteConfirmTitle"),description:t("knownFacts.deleteConfirmMessage"),onClose:()=>{setDeleteModalVisibleFor(void 0)},footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_1__.A,{ghost:!0,onClick:()=>{setDeleteModalVisibleFor(void 0)},children:t("cancel")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_1__.A,{primary:!0,danger:!0,onClick:async()=>{try{const response=await deleteKnownFact(sessionID,kf.knownFactID);0===response.resultCode?(react_hot_toast__WEBPACK_IMPORTED_MODULE_5__.Ay.success(t("knownFacts.deleteSuccess")),setSelectedRowKeys([]),fetchKnownFacts(),setDeleteModalVisibleFor(void 0)):(console.error(response),react_hot_toast__WEBPACK_IMPORTED_MODULE_5__.Ay.error(t((0,_helpers_error__WEBPACK_IMPORTED_MODULE_6__._)(response.resultCode),{ns:"common"})))}catch(_e){let error=_e;react_hot_toast__WEBPACK_IMPORTED_MODULE_5__.Ay.error(t("Error")+error.message)}},children:t("confirm")})]})})]})})]},kf.knownFactID))})]})]})]})};KnownFacts.displayName="KnownFacts";const __WEBPACK_DEFAULT_EXPORT__=KnownFacts;try{KnownFacts.displayName="KnownFacts",KnownFacts.__docgenInfo={description:"",displayName:"KnownFacts",props:{apiClient:{defaultValue:null,description:"",name:"apiClient",required:!0,type:{name:'{ constants: { BACKEND_URL: string; ENGINE_URL: string; allowedMediaTypes: string[]; anonTag: "👤"; }; asset: { getResourceUrl: ({ type, resourceURI, sessionID, baseURL, }: ResourceURLParams) => string; }; getAllFunctions: (sessionId: string) => Promise<...>; ... 137 more ...; backend: { ...; }; }'}},sessionID:{defaultValue:null,description:"",name:"sessionID",required:!0,type:{name:"string"}},memori:{defaultValue:null,description:"",name:"memori",required:!0,type:{name:"Memori"}},initialKnownFacts:{defaultValue:{value:"[]"},description:"",name:"initialKnownFacts",required:!1,type:{name:"KnownFact[]"}},visible:{defaultValue:{value:"true"},description:"",name:"visible",required:!1,type:{name:"boolean"}},closeDrawer:{defaultValue:null,description:"",name:"closeDrawer",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/KnownFacts/KnownFacts.tsx#KnownFacts"]={docgenInfo:KnownFacts.__docgenInfo,name:"KnownFacts",path:"src/components/KnownFacts/KnownFacts.tsx#KnownFacts"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/MemoriWidget/MemoriWidget.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>MemoriWidget_MemoriWidget});var react=__webpack_require__("./node_modules/react/index.js"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),esm=__webpack_require__("./node_modules/@memori.ai/memori-api-client/esm/index.js"),es2019_module=__webpack_require__("./node_modules/standardized-audio-context/build/es2019/module.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),luxon=__webpack_require__("./node_modules/luxon/src/luxon.js"),dist=__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs"),PositionDrawer=__webpack_require__("./src/components/PositionDrawer/PositionDrawer.tsx"),Auth=__webpack_require__("./src/components/Auth/Auth.tsx"),Chat_Chat=__webpack_require__("./src/components/Chat/Chat.tsx"),StartPanel=__webpack_require__("./src/components/StartPanel/StartPanel.tsx"),Avatar=__webpack_require__("./src/components/Avatar/Avatar.tsx"),Header=__webpack_require__("./src/components/Header/Header.tsx"),PoweredBy=__webpack_require__("./src/components/PoweredBy/PoweredBy.tsx"),AgeVerificationModal=__webpack_require__("./src/components/AgeVerificationModal/AgeVerificationModal.tsx"),SettingsDrawer=__webpack_require__("./src/components/SettingsDrawer/SettingsDrawer.tsx"),KnownFacts=__webpack_require__("./src/components/KnownFacts/KnownFacts.tsx"),ExpertsDrawer=__webpack_require__("./src/components/ExpertsDrawer/ExpertsDrawer.tsx"),LoginDrawer=__webpack_require__("./src/components/LoginDrawer/LoginDrawer.tsx"),Button=__webpack_require__("./src/components/ui/Button.tsx"),Close=__webpack_require__("./src/components/icons/Close.tsx"),Spin=__webpack_require__("./src/components/ui/Spin.tsx"),ArtifactContext=__webpack_require__("./src/components/MemoriArtifactSystem/context/ArtifactContext.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const layouts_FullPage=({Header,headerProps,Avatar,avatarProps,Chat,chatProps,StartPanel,startPanelProps,integrationStyle,integrationBackground,sessionId,hasUserActivatedSpeak,loading=!1,poweredBy})=>{const{state}=(0,ArtifactContext.S)(),hasArtifact=state.currentArtifact;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[integrationStyle,integrationBackground,(0,jsx_runtime.jsxs)(Spin.A,{spinning:loading,children:[(0,jsx_runtime.jsx)("div",{className:"memori-chat-layout--header "+(state.isDrawerOpen?"memori-chat-layout--header-with-artifact":""),children:Header&&headerProps&&(0,jsx_runtime.jsx)(Header,{...headerProps})}),(0,jsx_runtime.jsxs)("div",{className:"memori--grid",children:[!state.isDrawerOpen&&(0,jsx_runtime.jsxs)("div",{className:"memori--grid-column memori--grid-column-left",children:[Avatar&&avatarProps&&(0,jsx_runtime.jsx)(Avatar,{chatProps,...avatarProps}),(0,jsx_runtime.jsx)("div",{id:"extension"})]}),(0,jsx_runtime.jsx)("div",{className:"memori-chat-layout--main "+(hasArtifact?"memori-chat-layout--main-with-artifact":""),children:(0,jsx_runtime.jsx)("div",{className:state.isFullscreen?"memori-chat-layout-controls-hide":"memori-chat-layout--controls "+(state.isDrawerOpen?"memori-chat-layout--controls-with-artifact":""),children:sessionId&&hasUserActivatedSpeak&&Chat&&chatProps?(0,jsx_runtime.jsx)(Chat,{...chatProps}):startPanelProps?(0,jsx_runtime.jsx)(StartPanel,{...startPanelProps}):null})}),poweredBy]})]})]})};try{FullPage.displayName="FullPage",FullPage.__docgenInfo={description:"",displayName:"FullPage",props:{Header:{defaultValue:null,description:"",name:"Header",required:!1,type:{name:"FC<Props>"}},headerProps:{defaultValue:null,description:"",name:"headerProps",required:!1,type:{name:"Props"}},Avatar:{defaultValue:null,description:"",name:"Avatar",required:!0,type:{name:"NamedExoticComponent<Props>"}},avatarProps:{defaultValue:null,description:"",name:"avatarProps",required:!1,type:{name:"Props"}},Chat:{defaultValue:null,description:"",name:"Chat",required:!1,type:{name:"NamedExoticComponent<Props>"}},chatProps:{defaultValue:null,description:"",name:"chatProps",required:!1,type:{name:"Props"}},StartPanel:{defaultValue:null,description:"",name:"StartPanel",required:!0,type:{name:"FC<Props>"}},startPanelProps:{defaultValue:null,description:"",name:"startPanelProps",required:!1,type:{name:"Props"}},integrationStyle:{defaultValue:null,description:"",name:"integrationStyle",required:!1,type:{name:"Element | null"}},integrationBackground:{defaultValue:null,description:"",name:"integrationBackground",required:!1,type:{name:"Element | null"}},poweredBy:{defaultValue:null,description:"",name:"poweredBy",required:!1,type:{name:"Element | null"}},sessionId:{defaultValue:null,description:"",name:"sessionId",required:!1,type:{name:"string"}},hasUserActivatedSpeak:{defaultValue:null,description:"",name:"hasUserActivatedSpeak",required:!1,type:{name:"boolean"}},showUpload:{defaultValue:null,description:"",name:"showUpload",required:!1,type:{name:"boolean"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},autoStart:{defaultValue:null,description:"",name:"autoStart",required:!1,type:{name:"boolean"}},onSidebarToggle:{defaultValue:null,description:"",name:"onSidebarToggle",required:!1,type:{name:"((isOpen: boolean) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/layouts/FullPage.tsx#FullPage"]={docgenInfo:FullPage.__docgenInfo,name:"FullPage",path:"src/components/layouts/FullPage.tsx#FullPage"})}catch(__react_docgen_typescript_loader_error){}const layouts_Totem=({Header,headerProps,Avatar,avatarProps,Chat,chatProps,StartPanel,startPanelProps,integrationStyle,integrationBackground,sessionId,hasUserActivatedSpeak,loading=!1,poweredBy})=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[integrationStyle,integrationBackground,(0,jsx_runtime.jsxs)(Spin.A,{spinning:loading,className:"memori-totem-layout",children:[poweredBy,(0,jsx_runtime.jsx)("div",{className:"memori-totem-layout--header",children:Header&&headerProps&&(0,jsx_runtime.jsx)(Header,{...headerProps})}),(0,jsx_runtime.jsx)("div",{className:"memori-totem-layout--avatar",children:Avatar&&avatarProps&&(0,jsx_runtime.jsx)(Avatar,{chatProps,...avatarProps,isTotem:!0})}),(0,jsx_runtime.jsx)("div",{id:"extension"}),(0,jsx_runtime.jsx)("div",{className:"memori-totem-layout--controls",children:sessionId&&hasUserActivatedSpeak&&Chat&&chatProps?(0,jsx_runtime.jsx)(Chat,{...chatProps}):startPanelProps?(0,jsx_runtime.jsx)(StartPanel,{...startPanelProps}):null})]})]});try{Totem.displayName="Totem",Totem.__docgenInfo={description:"",displayName:"Totem",props:{Header:{defaultValue:null,description:"",name:"Header",required:!1,type:{name:"FC<Props>"}},headerProps:{defaultValue:null,description:"",name:"headerProps",required:!1,type:{name:"Props"}},Avatar:{defaultValue:null,description:"",name:"Avatar",required:!0,type:{name:"NamedExoticComponent<Props>"}},avatarProps:{defaultValue:null,description:"",name:"avatarProps",required:!1,type:{name:"Props"}},Chat:{defaultValue:null,description:"",name:"Chat",required:!1,type:{name:"NamedExoticComponent<Props>"}},chatProps:{defaultValue:null,description:"",name:"chatProps",required:!1,type:{name:"Props"}},StartPanel:{defaultValue:null,description:"",name:"StartPanel",required:!0,type:{name:"FC<Props>"}},startPanelProps:{defaultValue:null,description:"",name:"startPanelProps",required:!1,type:{name:"Props"}},integrationStyle:{defaultValue:null,description:"",name:"integrationStyle",required:!1,type:{name:"Element | null"}},integrationBackground:{defaultValue:null,description:"",name:"integrationBackground",required:!1,type:{name:"Element | null"}},poweredBy:{defaultValue:null,description:"",name:"poweredBy",required:!1,type:{name:"Element | null"}},sessionId:{defaultValue:null,description:"",name:"sessionId",required:!1,type:{name:"string"}},hasUserActivatedSpeak:{defaultValue:null,description:"",name:"hasUserActivatedSpeak",required:!1,type:{name:"boolean"}},showUpload:{defaultValue:null,description:"",name:"showUpload",required:!1,type:{name:"boolean"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},autoStart:{defaultValue:null,description:"",name:"autoStart",required:!1,type:{name:"boolean"}},onSidebarToggle:{defaultValue:null,description:"",name:"onSidebarToggle",required:!1,type:{name:"((isOpen: boolean) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/layouts/Totem.tsx#Totem"]={docgenInfo:Totem.__docgenInfo,name:"Totem",path:"src/components/layouts/Totem.tsx#Totem"})}catch(__react_docgen_typescript_loader_error){}const layouts_Chat=({Header,headerProps,Chat,chatProps,StartPanel,startPanelProps,integrationStyle,integrationBackground,sessionId,hasUserActivatedSpeak,loading=!1,poweredBy})=>{const{state}=(0,ArtifactContext.S)();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[integrationStyle,integrationBackground,(0,jsx_runtime.jsxs)(Spin.A,{spinning:loading,className:"memori-chat-layout",children:[poweredBy,(0,jsx_runtime.jsx)("div",{className:"memori-chat-layout--header "+(state.isDrawerOpen?"memori-chat-layout--header-with-artifact":""),children:Header&&headerProps&&(0,jsx_runtime.jsx)(Header,{...headerProps})}),(0,jsx_runtime.jsx)("div",{id:"extension"}),(0,jsx_runtime.jsx)("div",{className:"memori-chat-layout--main "+(state.isDrawerOpen?"memori-chat-layout--main-with-artifact":""),children:(0,jsx_runtime.jsx)("div",{className:state.isFullscreen?"memori-chat-layout-controls-hide":"memori-chat-layout--controls "+(state.isDrawerOpen?"memori-chat-layout--controls-with-artifact":""),children:sessionId&&hasUserActivatedSpeak&&Chat&&chatProps?(0,jsx_runtime.jsx)(Chat,{...chatProps}):startPanelProps?(0,jsx_runtime.jsx)(StartPanel,{...startPanelProps}):null})})]})]})};try{Chat.displayName="Chat",Chat.__docgenInfo={description:"",displayName:"Chat",props:{Header:{defaultValue:null,description:"",name:"Header",required:!1,type:{name:"FC<Props>"}},headerProps:{defaultValue:null,description:"",name:"headerProps",required:!1,type:{name:"Props"}},Avatar:{defaultValue:null,description:"",name:"Avatar",required:!0,type:{name:"NamedExoticComponent<Props>"}},avatarProps:{defaultValue:null,description:"",name:"avatarProps",required:!1,type:{name:"Props"}},Chat:{defaultValue:null,description:"",name:"Chat",required:!1,type:{name:"NamedExoticComponent<Props>"}},chatProps:{defaultValue:null,description:"",name:"chatProps",required:!1,type:{name:"Props"}},StartPanel:{defaultValue:null,description:"",name:"StartPanel",required:!0,type:{name:"FC<Props>"}},startPanelProps:{defaultValue:null,description:"",name:"startPanelProps",required:!1,type:{name:"Props"}},integrationStyle:{defaultValue:null,description:"",name:"integrationStyle",required:!1,type:{name:"Element | null"}},integrationBackground:{defaultValue:null,description:"",name:"integrationBackground",required:!1,type:{name:"Element | null"}},poweredBy:{defaultValue:null,description:"",name:"poweredBy",required:!1,type:{name:"Element | null"}},sessionId:{defaultValue:null,description:"",name:"sessionId",required:!1,type:{name:"string"}},hasUserActivatedSpeak:{defaultValue:null,description:"",name:"hasUserActivatedSpeak",required:!1,type:{name:"boolean"}},showUpload:{defaultValue:null,description:"",name:"showUpload",required:!1,type:{name:"boolean"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},autoStart:{defaultValue:null,description:"",name:"autoStart",required:!1,type:{name:"boolean"}},onSidebarToggle:{defaultValue:null,description:"",name:"onSidebarToggle",required:!1,type:{name:"((isOpen: boolean) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/layouts/Chat.tsx#Chat"]={docgenInfo:Chat.__docgenInfo,name:"Chat",path:"src/components/layouts/Chat.tsx#Chat"})}catch(__react_docgen_typescript_loader_error){}var Blob_Blob=__webpack_require__("./src/components/Blob/Blob.tsx");const WebsiteAssistantLayout=({Header,headerProps,Avatar,avatarProps,Chat,chatProps,StartPanel,startPanelProps,integrationStyle,sessionId,hasUserActivatedSpeak,loading=!1,poweredBy})=>{const{t}=(0,useTranslation.B)(),[collapsed,_setCollapsed]=(0,react.useState)(!0),[expandedKey,setExpandedKey]=(0,react.useState)(),stopAudio=(0,react.useMemo)(()=>chatProps?.stopAudio,[chatProps?.stopAudio]),setCollapsed=collapsed=>{_setCollapsed(collapsed),setExpandedKey(collapsed?void 0:(new Date).toISOString());try{stopAudio?.()}catch(e){console.log(e)}};return(0,jsx_runtime.jsx)("div",{className:"memori-website_assistant--"+(collapsed?"collapsed":"expanded"),children:collapsed?(0,jsx_runtime.jsx)("div",{className:"memori-website_assistant--trigger",children:(0,jsx_runtime.jsx)(Button.A,{className:"memori-website_assistant--trigger-button",ghost:!0,shape:"circle",onClick:()=>setCollapsed(!1),title:t("expand")||"Expand",children:(0,jsx_runtime.jsx)(Blob_Blob.A,{avatar:avatarProps?.memori.avatarURL})})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[integrationStyle,(0,jsx_runtime.jsxs)(Spin.A,{spinning:loading,className:"memori-website_assistant-layout",children:[poweredBy,(0,jsx_runtime.jsx)("div",{className:"memori-website_assistant--close-button-wrapper",children:(0,jsx_runtime.jsx)(Button.A,{className:"memori-website_assistant--close-button",primary:!0,shape:"circle",onClick:()=>setCollapsed(!0),icon:(0,jsx_runtime.jsx)(Close.default,{}),title:t("close")||"Close"})}),(0,jsx_runtime.jsx)("div",{className:"memori-website_assistant-layout--header",children:Header&&headerProps&&(0,jsx_runtime.jsx)(Header,{...headerProps,showSettings:!1,showReload:!1})}),(0,jsx_runtime.jsx)("div",{className:"memori-website_assistant-layout--avatar",children:Avatar&&avatarProps&&(0,react.createElement)(Avatar,{...avatarProps,integrationConfig:avatarProps.integrationConfig?{...avatarProps.integrationConfig,avatarURL:avatarProps.integrationConfig?.avatarURL?`${avatarProps.integrationConfig?.avatarURL.split("#")[0]}#${expandedKey}`:void 0}:{},key:expandedKey})}),(0,jsx_runtime.jsx)("div",{id:"extension"}),(0,jsx_runtime.jsx)("div",{className:"memori-website_assistant-layout--controls",children:sessionId&&hasUserActivatedSpeak&&Chat&&chatProps?(0,jsx_runtime.jsx)(Chat,{...chatProps}):startPanelProps?(0,jsx_runtime.jsx)(StartPanel,{...startPanelProps}):null})]})]})})};WebsiteAssistantLayout.displayName="WebsiteAssistantLayout";const layouts_WebsiteAssistant=WebsiteAssistantLayout;try{WebsiteAssistant.displayName="WebsiteAssistant",WebsiteAssistant.__docgenInfo={description:"",displayName:"WebsiteAssistant",props:{Header:{defaultValue:null,description:"",name:"Header",required:!1,type:{name:"FC<Props>"}},headerProps:{defaultValue:null,description:"",name:"headerProps",required:!1,type:{name:"Props"}},Avatar:{defaultValue:null,description:"",name:"Avatar",required:!0,type:{name:"NamedExoticComponent<Props>"}},avatarProps:{defaultValue:null,description:"",name:"avatarProps",required:!1,type:{name:"Props"}},Chat:{defaultValue:null,description:"",name:"Chat",required:!1,type:{name:"NamedExoticComponent<Props>"}},chatProps:{defaultValue:null,description:"",name:"chatProps",required:!1,type:{name:"Props"}},StartPanel:{defaultValue:null,description:"",name:"StartPanel",required:!0,type:{name:"FC<Props>"}},startPanelProps:{defaultValue:null,description:"",name:"startPanelProps",required:!1,type:{name:"Props"}},integrationStyle:{defaultValue:null,description:"",name:"integrationStyle",required:!1,type:{name:"Element | null"}},integrationBackground:{defaultValue:null,description:"",name:"integrationBackground",required:!1,type:{name:"Element | null"}},poweredBy:{defaultValue:null,description:"",name:"poweredBy",required:!1,type:{name:"Element | null"}},sessionId:{defaultValue:null,description:"",name:"sessionId",required:!1,type:{name:"string"}},hasUserActivatedSpeak:{defaultValue:null,description:"",name:"hasUserActivatedSpeak",required:!1,type:{name:"boolean"}},showUpload:{defaultValue:null,description:"",name:"showUpload",required:!1,type:{name:"boolean"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},autoStart:{defaultValue:null,description:"",name:"autoStart",required:!1,type:{name:"boolean"}},onSidebarToggle:{defaultValue:null,description:"",name:"onSidebarToggle",required:!1,type:{name:"((isOpen: boolean) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/layouts/WebsiteAssistant.tsx#WebsiteAssistant"]={docgenInfo:WebsiteAssistant.__docgenInfo,name:"WebsiteAssistant",path:"src/components/layouts/WebsiteAssistant.tsx#WebsiteAssistant"})}catch(__react_docgen_typescript_loader_error){}var QuestionHelp=__webpack_require__("./src/components/icons/QuestionHelp.tsx");const layouts_HiddenChat=({Header,headerProps,Chat,chatProps,startPanelProps,sessionId,hasUserActivatedSpeak,autoStart,StartPanel,onSidebarToggle})=>{const{t}=(0,useTranslation.B)(),[isOpen,setIsOpen]=(0,react.useState)(!1),[fullScreen,setFullScreen]=(0,react.useState)(!1),[hasTriggeredAutostart,setHasTriggeredAutostart]=(0,react.useState)(!1),{onClickStart,hasInitialSession}=startPanelProps||{},originalSidebarStyles=(0,react.useRef)({right:"",width:"",backgroundColor:""});(0,react.useEffect)(()=>{console.log("[HiddenChatLayout] Setting up fullscreen change listener");const handleFullscreenChange=()=>{console.log("[HiddenChatLayout] Fullscreen changed:",{fullscreenElement:!!document.fullscreenElement,fullScreen}),!document.fullscreenElement&&fullScreen&&restoreFromFullscreen()};return document.addEventListener("fullscreenchange",handleFullscreenChange),()=>{console.log("[HiddenChatLayout] Cleaning up fullscreen change listener"),document.removeEventListener("fullscreenchange",handleFullscreenChange)}},[fullScreen]),(0,react.useEffect)(()=>{console.log("[HiddenChatLayout] Updating body styles:",{isOpen,fullScreen});const mainDiv=document.body;isOpen?fullScreen?(mainDiv.style.width="100%",mainDiv.style.marginLeft="0"):(mainDiv.style.width="calc(100% - 350px)",mainDiv.style.marginRight="300px",mainDiv.style.transition="all 0.5s"):(mainDiv.style.width="100%",mainDiv.style.marginRight="0",mainDiv.style.marginLeft="0")},[isOpen,fullScreen]);const restoreFromFullscreen=()=>{console.log("[HiddenChatLayout] Restoring from fullscreen");const sidebarElement=document.querySelector(".memori-sidebar");if(sidebarElement){const closeButton=document.querySelector(".memori-close-label");closeButton&&(closeButton.style.display="flex");const sidebar=sidebarElement;sidebar.style.right=originalSidebarStyles.current.right,sidebar.style.width=originalSidebarStyles.current.width,sidebar.style.backgroundColor=originalSidebarStyles.current.backgroundColor,sidebar.classList.remove("memori-sidebar-fullscreen")}setFullScreen(!1)};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",id:"memori-sidebar-toggle",className:"memori-sidebar-toggle",checked:isOpen,onChange:()=>{console.log("[HiddenChatLayout] Sidebar toggle clicked:",{currentState:isOpen,autoStart,sessionId,hasInitialSession,hasTriggeredAutostart}),isOpen||hasTriggeredAutostart||!autoStart&&void 0!==autoStart||sessionId&&!hasInitialSession||(console.log("[HiddenChatLayout] Triggering autostart"),setHasTriggeredAutostart(!0),onClickStart?.()),fullScreen&&isOpen&&(console.log("[HiddenChatLayout] Exiting fullscreen before closing sidebar"),document.fullscreenElement&&document.exitFullscreen().catch(err=>{console.warn("[HiddenChatLayout] Error exiting fullscreen:",err)}),restoreFromFullscreen());const newState=!isOpen;setIsOpen(newState),onSidebarToggle&&onSidebarToggle(newState),console.log("[HiddenChatLayout] Setting isOpen to:",newState)}}),(0,jsx_runtime.jsxs)("div",{className:"memori-sidebar-container",children:[(0,jsx_runtime.jsx)("label",{htmlFor:"memori-sidebar-toggle",className:"memori-sidebar-toggle-label memori-open-label",children:(0,jsx_runtime.jsx)(QuestionHelp.default,{className:"memori-icon","aria-label":t("expand")})}),(0,jsx_runtime.jsxs)("aside",{className:"memori-sidebar "+(fullScreen?"memori-sidebar-fullscreen":""),children:[(0,jsx_runtime.jsx)("label",{htmlFor:"memori-sidebar-toggle",className:"memori-sidebar-toggle-label memori-close-label",children:(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(Close.default,{className:"memori-icon-close","aria-label":t("collapse")})})}),(0,jsx_runtime.jsx)("div",{className:"memori-sidebar-content",children:(0,jsx_runtime.jsx)("div",{className:"memori-hidden-chat-layout--header",children:Header&&headerProps&&(0,jsx_runtime.jsx)(Header,{position:{latitude:0,longitude:0,placeName:""},...headerProps,className:"memori-hidden-chat-layout-header--layout",fullScreenHandler:()=>{if(console.log("[HiddenChatLayout] Fullscreen toggle clicked:",{currentFullscreen:!!document.fullscreenElement}),document.fullscreenElement)document.exitFullscreen&&document.exitFullscreen().catch(err=>{console.warn("[HiddenChatLayout] Error exiting fullscreen:",err)}),restoreFromFullscreen();else{const sidebarElement=document.querySelector(".memori-sidebar");if(sidebarElement){const sidebar=sidebarElement,closeButton=document.querySelector(".memori-close-label");closeButton&&(closeButton.style.display="none"),originalSidebarStyles.current={right:sidebar.style.right,width:sidebar.style.width,backgroundColor:sidebar.style.backgroundColor},console.log("[HiddenChatLayout] Stored original styles:",originalSidebarStyles.current),sidebar.style.right="0",sidebar.style.width="100%",sidebar.style.backgroundColor="#FFFFFF",sidebar.requestFullscreen().catch(err=>{console.warn("[HiddenChatLayout] Error enabling fullscreen:",err)})}setFullScreen(!0)}}})})}),(0,jsx_runtime.jsx)("div",{id:"extension"}),(0,jsx_runtime.jsx)("div",{className:"memori-hidden-chat-layout--controls",children:sessionId&&hasUserActivatedSpeak&&Chat&&chatProps?(0,jsx_runtime.jsx)(Chat,{...chatProps}):!autoStart&&startPanelProps?(0,jsx_runtime.jsx)("div",{className:"memori-loading",children:(0,jsx_runtime.jsx)(StartPanel,{...startPanelProps})}):(0,jsx_runtime.jsx)("div",{className:"memori-loading",children:(0,jsx_runtime.jsx)(Spin.A,{})})})]})]})]})};try{HiddenChat.displayName="HiddenChat",HiddenChat.__docgenInfo={description:"",displayName:"HiddenChat",props:{Header:{defaultValue:null,description:"",name:"Header",required:!1,type:{name:"FC<Props>"}},headerProps:{defaultValue:null,description:"",name:"headerProps",required:!1,type:{name:"Props"}},Avatar:{defaultValue:null,description:"",name:"Avatar",required:!0,type:{name:"NamedExoticComponent<Props>"}},avatarProps:{defaultValue:null,description:"",name:"avatarProps",required:!1,type:{name:"Props"}},Chat:{defaultValue:null,description:"",name:"Chat",required:!1,type:{name:"NamedExoticComponent<Props>"}},chatProps:{defaultValue:null,description:"",name:"chatProps",required:!1,type:{name:"Props"}},StartPanel:{defaultValue:null,description:"",name:"StartPanel",required:!0,type:{name:"FC<Props>"}},startPanelProps:{defaultValue:null,description:"",name:"startPanelProps",required:!1,type:{name:"Props"}},integrationStyle:{defaultValue:null,description:"",name:"integrationStyle",required:!1,type:{name:"Element | null"}},integrationBackground:{defaultValue:null,description:"",name:"integrationBackground",required:!1,type:{name:"Element | null"}},poweredBy:{defaultValue:null,description:"",name:"poweredBy",required:!1,type:{name:"Element | null"}},sessionId:{defaultValue:null,description:"",name:"sessionId",required:!1,type:{name:"string"}},hasUserActivatedSpeak:{defaultValue:null,description:"",name:"hasUserActivatedSpeak",required:!1,type:{name:"boolean"}},showUpload:{defaultValue:null,description:"",name:"showUpload",required:!1,type:{name:"boolean"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},autoStart:{defaultValue:null,description:"",name:"autoStart",required:!1,type:{name:"boolean"}},onSidebarToggle:{defaultValue:null,description:"",name:"onSidebarToggle",required:!1,type:{name:"((isOpen: boolean) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/layouts/HiddenChat.tsx#HiddenChat"]={docgenInfo:HiddenChat.__docgenInfo,name:"HiddenChat",path:"src/components/layouts/HiddenChat.tsx#HiddenChat"})}catch(__react_docgen_typescript_loader_error){}const layouts_ZoomedFullBody=({Header,headerProps,Avatar,avatarProps,Chat,chatProps,StartPanel,startPanelProps,integrationStyle,integrationBackground,sessionId,hasUserActivatedSpeak,loading=!1,poweredBy})=>{const{state}=(0,ArtifactContext.S)(),hasArtifact=state.currentArtifact;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[integrationStyle,integrationBackground,(0,jsx_runtime.jsxs)(Spin.A,{className:"memori-spin--zoomed-full-body",spinning:loading,children:[(0,jsx_runtime.jsx)("div",{className:"memori-chat-layout--header "+(state.isDrawerOpen?"memori-chat-layout--header-with-artifact":""),children:Header&&headerProps&&(0,jsx_runtime.jsx)(Header,{...headerProps})}),(0,jsx_runtime.jsxs)("div",{className:"memori--grid",children:[!state.isDrawerOpen&&(0,jsx_runtime.jsxs)("div",{className:"memori--grid-column memori--grid-column-left",children:[Avatar&&avatarProps&&(0,jsx_runtime.jsx)(Avatar,{chatProps,isZoomed:!0,...avatarProps}),(0,jsx_runtime.jsx)("div",{id:"extension"})]}),(0,jsx_runtime.jsx)("div",{className:"memori-chat-layout--main "+(hasArtifact?"memori-chat-layout--main-with-artifact":""),children:(0,jsx_runtime.jsx)("div",{className:state.isFullscreen?"memori-chat-layout-controls-hide":"memori-chat-layout--controls "+(state.isDrawerOpen?"memori-chat-layout--controls-with-artifact":""),children:sessionId&&hasUserActivatedSpeak&&Chat&&chatProps?(0,jsx_runtime.jsx)(Chat,{...chatProps}):startPanelProps?(0,jsx_runtime.jsx)(StartPanel,{...startPanelProps}):null})}),poweredBy]})]})]})};try{ZoomedFullBody.displayName="ZoomedFullBody",ZoomedFullBody.__docgenInfo={description:"",displayName:"ZoomedFullBody",props:{Header:{defaultValue:null,description:"",name:"Header",required:!1,type:{name:"FC<Props>"}},headerProps:{defaultValue:null,description:"",name:"headerProps",required:!1,type:{name:"Props"}},Avatar:{defaultValue:null,description:"",name:"Avatar",required:!0,type:{name:"NamedExoticComponent<Props>"}},avatarProps:{defaultValue:null,description:"",name:"avatarProps",required:!1,type:{name:"Props"}},Chat:{defaultValue:null,description:"",name:"Chat",required:!1,type:{name:"NamedExoticComponent<Props>"}},chatProps:{defaultValue:null,description:"",name:"chatProps",required:!1,type:{name:"Props"}},StartPanel:{defaultValue:null,description:"",name:"StartPanel",required:!0,type:{name:"FC<Props>"}},startPanelProps:{defaultValue:null,description:"",name:"startPanelProps",required:!1,type:{name:"Props"}},integrationStyle:{defaultValue:null,description:"",name:"integrationStyle",required:!1,type:{name:"Element | null"}},integrationBackground:{defaultValue:null,description:"",name:"integrationBackground",required:!1,type:{name:"Element | null"}},poweredBy:{defaultValue:null,description:"",name:"poweredBy",required:!1,type:{name:"Element | null"}},sessionId:{defaultValue:null,description:"",name:"sessionId",required:!1,type:{name:"string"}},hasUserActivatedSpeak:{defaultValue:null,description:"",name:"hasUserActivatedSpeak",required:!1,type:{name:"boolean"}},showUpload:{defaultValue:null,description:"",name:"showUpload",required:!1,type:{name:"boolean"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},autoStart:{defaultValue:null,description:"",name:"autoStart",required:!1,type:{name:"boolean"}},onSidebarToggle:{defaultValue:null,description:"",name:"onSidebarToggle",required:!1,type:{name:"((isOpen: boolean) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/layouts/ZoomedFullBody.tsx#ZoomedFullBody"]={docgenInfo:ZoomedFullBody.__docgenInfo,name:"ZoomedFullBody",path:"src/components/layouts/ZoomedFullBody.tsx#ZoomedFullBody"})}catch(__react_docgen_typescript_loader_error){}var translations=__webpack_require__("./src/helpers/translations.ts"),configuration=__webpack_require__("./src/helpers/configuration.ts"),utils=__webpack_require__("./src/helpers/utils.ts");const AZURE_VOICES={IT:{MALE:"it-IT-DiegoNeural",FEMALE:"it-IT-ElsaNeural"},DE:{MALE:"de-DE-ConradNeural",FEMALE:"de-DE-KatjaNeural"},EN:{MALE:"en-GB-RyanNeural",FEMALE:"en-GB-SoniaNeural"},ES:{MALE:"es-ES-AlvaroNeural",FEMALE:"es-ES-ElviraNeural"},FR:{MALE:"fr-FR-HenriNeural",FEMALE:"fr-FR-DeniseNeural"},PT:{MALE:"pt-PT-DuarteNeural",FEMALE:"pt-PT-RaquelNeural"},UK:{MALE:"uk-UA-OstapNeural",FEMALE:"uk-UA-PolinaNeural"},RU:{MALE:"ru-RU-DmitryNeural",FEMALE:"ru-RU-SvetlanaNeural"},PL:{MALE:"pl-PL-MarekNeural",FEMALE:"pl-PL-AgnieszkaNeural"},FI:{MALE:"fi-FI-HarriNeural",FEMALE:"fi-FI-SelmaNeural"},EL:{MALE:"el-GR-NestorasNeural",FEMALE:"el-GR-AthinaNeural"},AR:{MALE:"ar-SA-HamedNeural",FEMALE:"ar-SA-ZariyahNeural"},ZH:{MALE:"zh-CN-YunxiNeural",FEMALE:"zh-CN-XiaoxiaoNeural"},JA:{MALE:"ja-JP-KeitaNeural",FEMALE:"ja-JP-NanamiNeural"}},DEFAULT_AZURE_VOICE={MALE:"en-US-GuyNeural",FEMALE:"en-US-JennyNeural"},OPENAI_VOICES={ALL:["alloy","echo","fable","onyx","nova","shimmer"],CHARACTERISTICS:{alloy:{gender:"NEUTRAL",tone:"BALANCED"},echo:{gender:"MALE",tone:"DEEP"},fable:{gender:"FEMALE",tone:"EXPRESSIVE"},onyx:{gender:"MALE",tone:"AUTHORITATIVE"},nova:{gender:"FEMALE",tone:"FRIENDLY"},shimmer:{gender:"FEMALE",tone:"BRIGHT"}},RECOMMENDED:{DEFAULT:{MALE:"onyx",FEMALE:"nova",NEUTRAL:"alloy"},IT:{MALE:"echo",FEMALE:"nova"},ES:{MALE:"echo",FEMALE:"shimmer"},FR:{MALE:"echo",FEMALE:"fable"},PT:{MALE:"onyx",FEMALE:"shimmer"},DE:{MALE:"onyx",FEMALE:"fable"},EN:{MALE:"echo",FEMALE:"nova"},ZH:{MALE:"echo",FEMALE:"shimmer"},JA:{MALE:"echo",FEMALE:"nova"},RU:{MALE:"onyx",FEMALE:"fable"}}};OPENAI_VOICES.ALL;function getTTSVoice(lang,provider="azure",voiceType="FEMALE"){const voiceLang=(lang||"EN").toUpperCase();if("openai"===provider.toLowerCase()){return(OPENAI_VOICES.RECOMMENDED[voiceLang]||OPENAI_VOICES.RECOMMENDED.DEFAULT)[voiceType]||OPENAI_VOICES.RECOMMENDED.DEFAULT[voiceType]||"alloy"}{const langVoices=AZURE_VOICES[voiceLang]||DEFAULT_AZURE_VOICE;return langVoices[voiceType]||langVoices.FEMALE||DEFAULT_AZURE_VOICE.FEMALE}}var constants=__webpack_require__("./src/helpers/constants.ts"),helpers_error=__webpack_require__("./src/helpers/error.ts");var visemeContext=__webpack_require__("./src/context/visemeContext.tsx");var Alert=__webpack_require__("./src/components/ui/Alert.tsx"),ChatHistory=__webpack_require__("./src/components/ChatHistoryDrawer/ChatHistory.tsx");async function convertToWav(audioBlob){return new Promise((resolve,reject)=>{const AudioContextClass=window.AudioContext||window.webkitAudioContext;if(!AudioContextClass)return void reject(new Error("AudioContext not supported in this browser"));const audioContext=new AudioContextClass,fileReader=new FileReader;fileReader.onload=async()=>{try{const arrayBuffer=fileReader.result;"suspended"===audioContext.state&&await audioContext.resume();const wavBlob=function audioBufferToWav(buffer){const length=buffer.length,sampleRate=buffer.sampleRate,numberOfChannels=buffer.numberOfChannels,arrayBuffer=new ArrayBuffer(44+length*numberOfChannels*2),view=new DataView(arrayBuffer),writeString=(offset,string)=>{for(let i=0;i<string.length;i++)view.setUint8(offset+i,string.charCodeAt(i))};writeString(0,"RIFF"),view.setUint32(4,36+length*numberOfChannels*2,!0),writeString(8,"WAVE"),writeString(12,"fmt "),view.setUint32(16,16,!0),view.setUint16(20,1,!0),view.setUint16(22,numberOfChannels,!0),view.setUint32(24,sampleRate,!0),view.setUint32(28,sampleRate*numberOfChannels*2,!0),view.setUint16(32,2*numberOfChannels,!0),view.setUint16(34,16,!0),writeString(36,"data"),view.setUint32(40,length*numberOfChannels*2,!0);let offset=44;for(let i=0;i<length;i++)for(let channel=0;channel<numberOfChannels;channel++){const sample=Math.max(-1,Math.min(1,buffer.getChannelData(channel)[i]));view.setInt16(offset,sample<0?32768*sample:32767*sample,!0),offset+=2}return new Blob([arrayBuffer],{type:"audio/wav"})}(await audioContext.decodeAudioData(arrayBuffer));await audioContext.close(),resolve(wavBlob)}catch(error){console.error("Error converting audio to WAV:",error),reject(error)}},fileReader.onerror=()=>{console.error("Failed to read audio file"),reject(new Error("Failed to read audio file"))},fileReader.readAsArrayBuffer(audioBlob)})}const typeMessage=(message,waitForPrevious=!0,hidden=!1,typingText,useLoaderTextAsMsg=!1,hasBatchQueued=!1)=>{const e=new CustomEvent("MemoriTextEntered",{detail:{text:message,waitForPrevious,hidden,typingText,useLoaderTextAsMsg,hasBatchQueued}});document.dispatchEvent(e);window.navigator.userAgent.includes("Safari")&&!window.navigator.userAgent.includes("Chrome")&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&setTimeout(()=>{document.dispatchEvent(new CustomEvent("MemoriEndSpeak"))},300)};let audioContext,memoriPassword;window.getMemoriState=integrationId=>{let widget=integrationId?document.querySelector(`.memori-widget[data-memori-integration="${integrationId}"]`)||document.querySelector("memori-client")?.shadowRoot?.querySelector(".memori-widget[data-memori-integration]"):document.querySelector(".memori-widget")||document.querySelector("memori-client")?.shadowRoot?.querySelector(".memori-widget");if(!widget)return null;let engineState=widget.dataset?.memoriEngineState;return engineState?{...JSON.parse(engineState),loginToken:(0,configuration.uY)("loginToken",void 0)}:null},window.typeMessage=typeMessage,window.typeMessageHidden=(message,waitForPrevious=!0,typingText,useLoaderTextAsMsg=!1,hasBatchQueued=!1)=>typeMessage(message,waitForPrevious,!0,typingText,useLoaderTextAsMsg,hasBatchQueued),window.typeBatchMessages=messages=>{function disableInputs(){document.querySelector("fieldset#chat-fieldset")?.setAttribute("disabled","");const styles="opacity: 0.5; touch-action: none; pointer-events: none;";document.querySelector("textarea.memori-chat-textarea--input")?.setAttribute("style",styles),document.querySelector("button.memori-chat-inputs--send")?.setAttribute("style",styles),document.querySelector("button.memori-chat-inputs--mic")?.setAttribute("style",styles)}function reEnableInputs(){document.querySelector("fieldset#chat-fieldset")?.removeAttribute("disabled"),document.querySelector("textarea.memori-chat-textarea--input")?.removeAttribute("style"),document.querySelector("button.memori-chat-inputs--send")?.removeAttribute("style"),document.querySelector("button.memori-chat-inputs--mic")?.removeAttribute("style")}function areInputsDisabled(){return!!document.querySelector("fieldset#chat-fieldset")?.hasAttribute("disabled")}const isSafariIOS=window.navigator.userAgent.includes("Safari")&&!window.navigator.userAgent.includes("Chrome")&&/iPad|iPhone|iPod/.test(navigator.userAgent),stepsGenerator=function*(){yield*messages}();disableInputs();const submitNewMessage=()=>{const next=stepsGenerator.next(),step=next.value;if(step){areInputsDisabled()||disableInputs();let waitForPrevious=step.waitForPrevious;isSafariIOS&&(waitForPrevious=!1),typeMessage(step.message,waitForPrevious,step.hidden,step.typingText,step.useLoaderTextAsMsg,!next.done),isSafariIOS&&setTimeout(()=>{document.dispatchEvent(new CustomEvent("MemoriEndSpeak")),reEnableInputs()},3e3)}else areInputsDisabled()&&reEnableInputs();if(next.done)return document.removeEventListener("MemoriEndSpeak",submitNewMessage),void(areInputsDisabled()&&reEnableInputs())};document.addEventListener("MemoriEndSpeak",submitNewMessage),submitNewMessage()};let userToken;const MemoriWidget=({memori,memoriConfigs,ownerUserID,ownerUserName,tenantID,memoriLang,multilingual,integration,layout,customLayout,showShare,preview=!1,embed=!1,showCopyButton=!0,showTranslationOriginal=!1,showInputs=!0,showDates=!1,showContextPerLine=!1,showSettings,showTypingText=!1,showClear=!1,showLogin=!1,showUpload,showOnlyLastMessages,showChatHistory,showReasoning,height="100vh",secret,baseUrl="https://aisuru-staging.aclambda.online",apiURL="https://backend-staging.memori.ai",engineURL="https://engine-staging.memori.ai",initialContextVars,initialQuestion,ttsProvider,ogImage,sessionID:initialSessionID,tenant,personification,authToken,enableAudio,defaultSpeakerActive=!0,disableTextEnteredEvents=!1,onStateChange,additionalInfo,additionalSettings,customMediaRenderer,userAvatar,useMathFormatting=!1,autoStart=!1,applyVarsToRoot=!1,showFunctionCache=!1})=>{const{t,i18n}=(0,useTranslation.B)(),[isClient,setIsClient]=(0,react.useState)(!1);(0,react.useEffect)(()=>{setIsClient(!0)},[]);const client=(0,esm.A)(apiURL,engineURL),{initSession,deleteSession,postTextEnteredEvent,postPlaceChangedEvent,postDateChangedEvent,postTimeoutEvent,postTagChangedEvent,getSession,getExpertReferences,getSessionChatLogs}=client,[instruct,setInstruct]=(0,react.useState)(!1),[enableFocusChatInput,setEnableFocusChatInput]=(0,react.useState)(!0),[loginToken,setLoginToken]=(0,react.useState)(additionalInfo?.loginToken??authToken),[user,setUser]=(0,react.useState)({avatarURL:"string"==typeof userAvatar?userAvatar:void 0});(0,react.useEffect)(()=>{loginToken&&!user?.userID&&(showLogin||memori.requireLoginToken)&&client.backend.getCurrentUser(loginToken).then(({user,resultCode})=>{user&&0===resultCode?(setUser(user),(0,configuration.yY)("loginToken",loginToken),!birthDate&&user.birthDate&&(setBirthDate(user.birthDate),(0,configuration.yY)("birthDate",user.birthDate))):(0,configuration.k4)("loginToken")})},[loginToken,user?.userID]);const[showLoginDrawer,setShowLoginDrawer]=(0,react.useState)(!1),[clickedStart,setClickedStart]=(0,react.useState)(!1),[gotErrorInOpening,setGotErrorInOpening]=(0,react.useState)(!1),language=memori.culture?.split("-")?.[0]?.toUpperCase()||memoriConfigs?.find(c=>c.memoriConfigID===memori.memoriConfigurationID)?.culture?.split("-")?.[0]?.toUpperCase(),integrationConfig=integration?.customData?JSON.parse(integration.customData):null,isMultilanguageEnabled=void 0!==multilingual?multilingual:!!integrationConfig?.multilanguage,forcedTimeout=integrationConfig?.forcedTimeout,[userLang,setUserLang]=(0,react.useState)(memoriLang??integrationConfig?.lang??language??integrationConfig?.uiLang??i18n.language??"IT"),applyMathFormatting=void 0!==useMathFormatting?useMathFormatting:!!integrationConfig?.useMathFormatting;(0,react.useEffect)(()=>{applyMathFormatting&&(0,utils.lA)()},[applyMathFormatting]),(0,react.useEffect)(()=>{isMultilanguageEnabled&&userLang&&constants.uiLanguages.includes(userLang.toLowerCase())&&i18n.changeLanguage(userLang.toLowerCase())},[userLang]);const[loading,setLoading]=(0,react.useState)(!1),[memoriTyping,setMemoriTyping]=(0,react.useState)(!1),[typingText,setTypingText]=(0,react.useState)(),selectedLayout=layout||integrationConfig?.layout||"DEFAULT",defaultEnableAudio=enableAudio??integrationConfig?.enableAudio??!0,[hasUserActivatedListening,setHasUserActivatedListening]=(0,react.useState)(!1),[showPositionDrawer,setShowPositionDrawer]=(0,react.useState)(!1),[showSettingsDrawer,setShowSettingsDrawer]=(0,react.useState)(!1),[showChatHistoryDrawer,setShowChatHistoryDrawer]=(0,react.useState)(!1),[showKnownFactsDrawer,setShowKnownFactsDrawer]=(0,react.useState)(!1),[showExpertsDrawer,setShowExpertsDrawer]=(0,react.useState)(!1),[continuousSpeech,setContinuousSpeech]=(0,react.useState)(!1),[continuousSpeechTimeout,setContinuousSpeechTimeout]=(0,react.useState)(2),[controlsPosition,setControlsPosition]=(0,react.useState)("center"),[enablePositionControls,setEnablePositionControls]=(0,react.useState)(!1),[avatarType,setAvatarType]=(0,react.useState)(null),[hideEmissions,setHideEmissions]=(0,react.useState)(!1),speechSynthesizerRef=(0,react.useRef)(null),[memoriSpeaking,setMemoriSpeaking]=(0,react.useState)(!1);(0,react.useEffect)(()=>{setMemoriSpeaking(!!speechSynthesizerRef.current)},[speechSynthesizerRef.current]),(0,react.useEffect)(()=>{let defaultControlsPosition="bottom",microphoneMode=(0,configuration.uY)("microphoneMode","HOLD_TO_TALK");window.innerWidth<=768?(defaultControlsPosition="bottom",microphoneMode="HOLD_TO_TALK"):defaultControlsPosition=window.matchMedia("(orientation: portrait)").matches||window.innerHeight>window.innerWidth?"center":"bottom",setContinuousSpeech(!speakerMuted&&"CONTINUOUS"===microphoneMode),setContinuousSpeechTimeout((0,configuration.uY)("continuousSpeechTimeout",2)),setControlsPosition((0,configuration.uY)("controlsPosition",defaultControlsPosition)),setAvatarType((0,configuration.uY)("avatarType","avatar3d")),setHideEmissions((0,configuration.uY)("hideEmissions",!1)),additionalInfo?.loginToken||authToken||(setLoginToken((0,configuration.uY)("loginToken",void 0)),userToken=(0,configuration.uY)("loginToken",void 0),setBirthDate((0,configuration.uY)("birthDate",void 0))),(enableAudio??integrationConfig?.enableAudio??1)||(0,configuration.yY)("muteSpeaker",!0)},[]),(0,react.useEffect)(()=>{(enableAudio??integrationConfig?.enableAudio??!0)||(0,configuration.yY)("muteSpeaker",!0)},[enableAudio,integrationConfig?.enableAudio]);const[memoriPwd,setMemoriPwd]=(0,react.useState)(secret),[memoriTokens,setMemoriTokens]=(0,react.useState)(),[authModalState,setAuthModalState]=(0,react.useState)(null),[position,_setPosition]=(0,react.useState)(),applyPosition=async(venue,sessionID)=>{const session=sessionID??sessionId;if(venue&&session&&memori.needsPosition){const{currentState,...response}=await postPlaceChangedEvent({sessionId:session,placeName:venue.placeName,latitude:venue.latitude,longitude:venue.longitude,uncertaintyKm:venue.uncertainty??0});currentState&&0===response.resultCode&&_setCurrentDialogState(cds=>({...cds,...currentState,hints:currentState.hints?.length?currentState.hints:cds?.hints}))}};(0,react.useEffect)(()=>{if(memori.needsPosition){const position=(0,configuration.uY)("position",void 0);position&&_setPosition(position)}},[memori.needsPosition]);const[userMessage,setUserMessage]=(0,react.useState)(""),[listening,setListening]=(0,react.useState)(!1),[history,setHistory]=(0,react.useState)([]),pushMessage=message=>{setHistory(history=>[...history,{...message,media:message.media?.filter(m=>!("text/javascript"===m.mimeType&&m.properties?.executable))??[]}])},[chatLogID,setChatLogID]=(0,react.useState)(void 0),sendMessage=async(text,media,newSessionId,translate=!0,translatedText,hidden=!1,typingText,useLoaderTextAsMsg=!1,hasBatchQueued=!1)=>{const sessionID=newSessionId||sessionId||window.getMemoriState()?.sessionID;if(!sessionID||!text?.length)return;hidden||pushMessage({text,translatedText,fromUser:!0,media:media??[],initial:sessionId?!!newSessionId&&newSessionId!==sessionId:!!newSessionId}),setMemoriTyping(!0),setTypingText(typingText);let msg=text,gotError=!1;try{if(!hidden&&translate&&isMultilanguageEnabled&&userLang.toUpperCase()!==language.toUpperCase()){msg=(await(0,translations.s)(text,language,userLang,baseUrl)).text}const findMediaDocument=media?.find(m=>!m.mediumID&&m.properties?.isAttachedFile);findMediaDocument&&(msg=msg+" "+findMediaDocument.content);const mediaDocuments=media?.filter(m=>!m.mediumID&&m.properties?.isAttachedFile);if(mediaDocuments&&mediaDocuments.length>0){msg=msg+" "+mediaDocuments.map(doc=>doc.content).join(" ")}const{currentState,...response}=await postTextEnteredEvent({sessionId:sessionID,text:msg});if(0===response.resultCode&&currentState){setChatLogID(void 0);const emission=useLoaderTextAsMsg&&typingText?typingText:currentState.emission??currentDialogState?.emission;userLang.toLowerCase()!==language.toLowerCase()&&emission&&isMultilanguageEnabled?(currentState.emission=emission,translateDialogState(currentState,userLang,msg).then(ts=>{let text=ts.translatedEmission||ts.emission;text&&text.trim()&&!speakerMuted&&handleSpeak(text)})):(setCurrentDialogState({...currentState,emission}),emission&&(pushMessage({text:emission,emitter:currentState.emitter,media:currentState.emittedMedia??currentState.media,fromUser:!1,questionAnswered:msg,generatedByAI:!!currentState.completion,contextVars:currentState.contextVars,date:currentState.currentDate,placeName:currentState.currentPlaceName,placeLatitude:currentState.currentLatitude,placeLongitude:currentState.currentLongitude,placeUncertaintyKm:currentState.currentUncertaintyKm,tag:currentState.currentTag,memoryTags:currentState.memoryTags}),emission&&emission.trim()&&handleSpeak(emission)))}else 404===response.resultCode&&(setHistory(h=>[...h.slice(0,h.length-1)]),reopenSession(!1,memoriPwd||memori.secretToken,memoriTokens,void 0,void 0,{PATHNAME:window.location.pathname,ROUTE:window.location.pathname?.split("/")?.pop()||"",...initialContextVars||{}},initialQuestion).then(state=>{console.info("session timeout"),state?.sessionID&&setTimeout(()=>{sendMessage(text,media,state?.sessionID)},500)}))}catch(error){console.error(error),gotError=!0,setTypingText(void 0),setMemoriTyping(!1)}hasBatchQueued||(setTypingText(void 0),setMemoriTyping(!1))},translateDialogState=async(state,userLang,msg,avoidPushingMessage=!1)=>{const emission=state?.emission??currentDialogState?.emission;let translatedState={...state},translatedMsg=null;if(emission&&language.toUpperCase()!==userLang.toUpperCase()&&isMultilanguageEnabled&&!avoidPushingMessage)try{const t=await(0,translations.s)(emission,userLang,language,baseUrl);if(state.hints&&state.hints.length>0){const translatedHints=await Promise.all((state.hints??[]).map(async hint=>{const tHint=await(0,translations.s)(hint,userLang,language,baseUrl);return{text:tHint?.text??hint,originalText:hint}}));translatedState={...state,emission:t.text,translatedHints}}else translatedState={...state,emission,translatedEmission:t.text,hints:state.hints??("G1"===state.state?currentDialogState?.hints:[])};t.text.length>0&&(translatedMsg={text:emission,translatedText:t.text,emitter:state.emitter,media:state.emittedMedia??state.media,fromUser:!1,questionAnswered:msg,generatedByAI:!!state.completion,contextVars:state.contextVars,date:state.currentDate,placeName:state.currentPlaceName,placeLatitude:state.currentLatitude,placeLongitude:state.currentLongitude,placeUncertaintyKm:state.currentUncertaintyKm,tag:state.currentTag,memoryTags:state.memoryTags})}catch(error){console.error("[TRANSLATE] Error during translation:",error),translatedState={...state,emission},translatedMsg={text:emission,emitter:state.emitter,media:state.emittedMedia??state.media,fromUser:!1,questionAnswered:msg,contextVars:state.contextVars,date:state.currentDate,placeName:state.currentPlaceName,placeLatitude:state.currentLatitude,placeLongitude:state.currentLongitude,placeUncertaintyKm:state.currentUncertaintyKm,tag:state.currentTag,memoryTags:state.memoryTags}}else translatedState={...state,emission},emission&&(translatedMsg={text:emission,emitter:state.emitter,media:state.emittedMedia??state.media,fromUser:!1,questionAnswered:msg,contextVars:state.contextVars,date:state.currentDate,placeName:state.currentPlaceName,placeLatitude:state.currentLatitude,placeLongitude:state.currentLongitude,placeUncertaintyKm:state.currentUncertaintyKm,tag:state.currentTag,memoryTags:state.memoryTags});return setCurrentDialogState(translatedState),!avoidPushingMessage&&translatedMsg&&pushMessage(translatedMsg),translatedState},minAge=void 0!==memori.ageRestriction?memori.ageRestriction:memori.nsfw?18:memori.enableCompletions?14:0,[birthDate,setBirthDate]=(0,react.useState)(),[showAgeVerification,setShowAgeVerification]=(0,react.useState)(!1),getCultureCodeByLanguage=lang=>{let voice="";switch((lang||memori.culture?.split("-")?.[0]||i18n.language||"IT").toUpperCase()){case"IT":default:voice="it-IT";break;case"DE":voice="de-DE";break;case"EN":voice="en-GB";break;case"ES":voice="es-ES";break;case"FR":voice="fr-FR";break;case"PT":voice="pt-PT";break;case"UK":voice="uk-UK";break;case"RU":voice="ru-RU";break;case"PL":voice="pl-PL";break;case"FI":voice="fi-FI";break;case"EL":voice="el-GR";break;case"AR":voice="ar-SA";break;case"ZH":voice="zh-CN";break;case"JA":voice="ja-JP"}return voice},[sessionId,setSessionId]=(0,react.useState)(initialSessionID),[currentDialogState,_setCurrentDialogState]=(0,react.useState)(),setCurrentDialogState=state=>{_setCurrentDialogState(state),onStateChange&&onStateChange(state);const e=new CustomEvent("MemoriNewDialogState",{detail:state});document.dispatchEvent(e);const executableSnippets=(state?.emittedMedia??state?.media)?.filter(m=>"text/javascript"===m.mimeType&&!!m.properties?.executable);executableSnippets?.forEach(s=>{try{setTimeout(()=>{console.log("snippet",s),new Function(s.content??"")(),setTimeout(()=>{document.querySelector(".memori-chat--content")?.scrollTo(0,document.querySelector(".memori-chat--content")?.scrollHeight??0)},400)},1e3)}catch(e){console.warn(e)}})},fetchSession=async params=>{let storageBirthDate=(0,configuration.uY)("birthDate",void 0),userBirthDate=birthDate??params.birthDate??storageBirthDate;if(userBirthDate||!minAge)if("PUBLIC"===memori.privacyType||memori.secretToken||memoriPwd||memoriTokens){setLoading(!0);try{let referral;try{referral=window.location.href}catch(err){console.debug(err)}const session=await initSession({...params,birthDate:userBirthDate,tag:params.tag??personification?.tag,pin:params.pin??personification?.pin,additionalInfo:{...additionalInfo||{},loginToken:userToken??loginToken??additionalInfo?.loginToken??authToken,language:getCultureCodeByLanguage(userLang),referral,timeZoneOffset:(new Date).getTimezoneOffset().toString()}});if(session?.sessionID&&session?.currentState&&0===session.resultCode)return setSessionId(session.sessionID),currentDialogState?.currentTag&&memori.giverTag?setInstruct(currentDialogState?.currentTag===memori.giverTag):setInstruct(!1),position&&memori.needsPosition&&applyPosition(position,session.sessionID),setLoading(!1),{dialogState:session.currentState,sessionID:session.sessionID};if(!session?.resultMessage.startsWith("This Memori is aged restricted"))return 403===session?.resultCode?(setMemoriPwd(void 0),setAuthModalState("password"),session):(console.warn(session),dist.Ay.error(tst=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("p",{children:t((0,helpers_error._)(session?.resultCode))}),(0,jsx_runtime.jsx)(Button.A,{outlined:!0,padded:!1,onClick:()=>dist.Ay.dismiss(tst.id),icon:(0,jsx_runtime.jsx)(Close.default,{}),children:t("close")})]}),{duration:1/0}),setGotErrorInOpening(!0),session);console.warn(session),dist.Ay.error(t("underageTwinSession",{age:minAge})),setGotErrorInOpening(!0)}catch(err){console.error(err)}}else setAuthModalState("password");else setShowAgeVerification(!0)},reopenSession=async(updateDialogState=!1,password,recoveryTokens,tag,pin,initialContextVars,initialQuestion,birthDate)=>{setLoading(!0);let storageBirthDate=(0,configuration.uY)("birthDate",void 0),userBirthDate=birthDate??storageBirthDate;try{if(!userBirthDate&&minAge)return void setShowAgeVerification(!0);if(!("PUBLIC"===memori.privacyType||password||memori.secretToken||memoriPwd||recoveryTokens||memoriTokens))return void setAuthModalState("password");let referral;try{referral=window.location.href,console.log("[REOPEN_SESSION] Got referral:",referral)}catch(err){console.debug("[REOPEN_SESSION] Error getting referral:",err)}const{sessionID,currentState,...response}=await initSession({memoriID:memori.engineMemoriID??"",password:password||memoriPwd||memori.secretToken,recoveryTokens:recoveryTokens||memoriTokens,tag:tag??personification?.tag,pin:pin??personification?.pin,initialContextVars:{PATHNAME:window.location.pathname,ROUTE:window.location.pathname?.split("/")?.pop()||"",...initialContextVars||{}},initialQuestion,birthDate:userBirthDate,additionalInfo:{...additionalInfo||{},loginToken:userToken??loginToken??additionalInfo?.loginToken??authToken,language:getCultureCodeByLanguage(userLang),referral,timeZoneOffset:(new Date).getTimezoneOffset().toString()}});if(sessionID&&currentState&&0===response.resultCode)return setSessionId(sessionID),updateDialogState&&(setCurrentDialogState(currentState),currentState.emission&&(history.length<=1?setHistory([{text:currentState.emission,emitter:currentState.emitter,media:currentState.emittedMedia??currentState.media,fromUser:!1,initial:!0,contextVars:currentState.contextVars,date:currentState.currentDate,placeName:currentState.currentPlaceName,placeLatitude:currentState.currentLatitude,placeLongitude:currentState.currentLongitude,placeUncertaintyKm:currentState.currentUncertaintyKm,tag:currentState.currentTag,memoryTags:currentState.memoryTags}]):pushMessage({text:currentState.emission,emitter:currentState.emitter,media:currentState.emittedMedia??currentState.media,fromUser:!1,initial:!0,contextVars:currentState.contextVars,date:currentState.currentDate,placeName:currentState.currentPlaceName,placeLatitude:currentState.currentLatitude,placeLongitude:currentState.currentLongitude,placeUncertaintyKm:currentState.currentUncertaintyKm,tag:currentState.currentTag,memoryTags:currentState.memoryTags}))),position&&memori.needsPosition&&applyPosition(position,sessionID),memori.needsDateTime&&sendDateChangedEvent({sessionID,state:currentState}),setLoading(!1),{dialogState:currentState,sessionID};response?.resultMessage.startsWith("This Memori is aged restricted")?(console.error("[REOPEN_SESSION] Age restriction error:",response),dist.Ay.error(t("underageTwinSession",{age:minAge})),setGotErrorInOpening(!0)):403===response?.resultCode?(console.error("[REOPEN_SESSION] Authentication error"),setMemoriPwd(void 0),setAuthModalState("password")):(console.error("[REOPEN_SESSION] Other error:",response),dist.Ay.error(t((0,helpers_error._)(response.resultCode))),setGotErrorInOpening(!0))}catch(err){console.error("[REOPEN_SESSION] Caught error:",err)}return setLoading(!1),null},[chatLogs,setChatLogs]=(0,react.useState)([]),changeTag=async(memoriId,sessionId,tag,pin)=>{if(!memoriId||!sessionId)return console.error("CHANGETAG/Session not found"),Promise.reject("Session not found");try{const{currentState,resultCode}=await postTagChangedEvent(sessionId,tag??constants.anonTag);if(0===resultCode){let textResult=0;if(tag!==constants.anonTag&&pin&&("X1a"===currentState.state||"X1b"===currentState.state)){const{resultCode:textResultCode}=await postTextEnteredEvent({sessionId,text:pin??""});textResult=textResultCode}if(0===textResult){const{currentState,...response}=await getSession(sessionId);if(0===response.resultCode&&currentState)return{currentState,sessionId,...response}}else if([400,401,403,404,500].includes(resultCode)){console.warn("[APPCONTEXT/CHANGETAG]",resultCode);let referral,storageBirthDate=(0,configuration.uY)("birthDate",void 0);try{referral=window.location.href}catch(err){console.debug(err)}fetchSession({memoriID:memori.engineMemoriID??"",password:secret||memoriPwd||memori.secretToken,tag:tag??personification?.tag,pin:pin??personification?.pin,initialContextVars:{PATHNAME:window.location.pathname,ROUTE:window.location.pathname?.split("/")?.pop()||"",...initialContextVars||{}},initialQuestion,birthDate:birthDate||storageBirthDate||void 0,additionalInfo:{...additionalInfo||{},loginToken:userToken??loginToken??additionalInfo?.loginToken??authToken,language:getCultureCodeByLanguage(userLang),referral,timeZoneOffset:(new Date).getTimezoneOffset().toString()}})}else if(currentState)return{currentState,sessionId,resultCode}}}catch(_e){let err=_e;return console.warn("[APPCONTEXT/CHANGETAG]",err),Promise.reject(err)}return null},sendDateChangedEvent=(0,react.useCallback)(async({sessionID,date,state})=>{const session=sessionID??sessionId,dialogState=state??currentDialogState;if(!session||!memori.needsDateTime||dialogState?.hints?.length)return;const now=(date?luxon.c9.fromISO(date):luxon.c9.now()).toUTC().toFormat("yyyy/MM/dd HH:mm:ss ZZ").split(":").slice(0,-1).join(":"),{currentState,...response}=await postDateChangedEvent(session,now);0===response.resultCode&&currentState&&_setCurrentDialogState(cds=>({...cds,...currentState,hints:currentState.hints?.length?currentState.hints:cds?.hints}))},[currentDialogState,memori.needsDateTime,sessionId]);(0,react.useEffect)(()=>{if(sessionId&&memori.needsDateTime){sendDateChangedEvent({sessionID:sessionId,state:currentDialogState});let datePolling=setInterval(()=>{sendDateChangedEvent({sessionID:sessionId})},6e4);return()=>{clearInterval(datePolling)}}},[memori.needsDateTime,sessionId]);const[userInteractionTimeout,setUserInteractionTimeout]=(0,react.useState)(),timeoutRef=(0,react.useRef)(),clearInteractionTimeout=()=>{userInteractionTimeout&&(clearTimeout(userInteractionTimeout),setUserInteractionTimeout(void 0)),timeoutRef?.current&&(clearTimeout(timeoutRef.current),timeoutRef.current=void 0)};(0,react.useEffect)(()=>()=>{setHasUserActivatedSpeak(!1),setClickedStart(!1),clearInteractionTimeout(),timeoutRef.current=void 0},[]);const[requestedListening,setRequestedListening]=(0,react.useState)(!1);(0,react.useRef)(null);console.log("tenantID",tenantID);const ttsConfig=(0,react.useMemo)(()=>({provider:ttsProvider,voice:getTTSVoice(userLang||memori.culture?.split("-")?.[0]||"EN",ttsProvider,memori.voiceType),tenant:tenantID,region:"westeurope",voiceType:memori.voiceType,layout:selectedLayout}),[ttsProvider,userLang,memori.culture,memori.voiceType]),sttConfig=(0,react.useMemo)(()=>({provider:ttsProvider,language:getCultureCodeByLanguage(userLang),tenant:tenantID}),[ttsProvider,userLang]),{speak:ttsSpeak,stop:ttsStop,isPlaying:isPlayingAudio,speakerMuted,toggleMute,hasUserActivatedSpeak,setHasUserActivatedSpeak,error,setError}=function useTTS(config,options={},autoStart=!1,defaultEnableAudio=!0,defaultSpeakerActive=!0){const[isPlaying,setIsPlaying]=(0,react.useState)(!1),[speakerMuted,setSpeakerMuted]=(0,react.useState)((0,configuration.uY)("muteSpeaker",!defaultEnableAudio||!defaultSpeakerActive||autoStart)),{addViseme,resetVisemeQueue,startProcessing,stopProcessing}=(0,visemeContext.zE)(),[hasUserActivatedSpeak,setHasUserActivatedSpeak]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null),audioRef=(0,react.useRef)(null),audioWrapperRef=(0,react.useRef)(null),globalSpeakRef=(0,react.useRef)(null),visemeLoadedRef=(0,react.useRef)(!1),isSpeakingRef=(0,react.useRef)(!1),timeoutRef=(0,react.useRef)(null),isMountedRef=(0,react.useRef)(!0),loadVisemeData=(options.apiUrl,(0,react.useCallback)(visemeData=>(resetVisemeQueue(),visemeLoadedRef.current=!1,visemeData&&visemeData.length>0?(visemeData.forEach(viseme=>{addViseme(viseme.visemeId,viseme.audioOffset)}),visemeLoadedRef.current=!0,!0):(console.warn("[useTTS] No viseme data available"),!1)),[addViseme,resetVisemeQueue])),createAudioWrapper=(0,react.useCallback)(()=>{if(!audioRef.current)return console.warn("[useTTS] Cannot create audio wrapper: audio element is null"),null;const wrapper={state:"running",onstatechange:null,get currentTime(){return audioRef.current?audioRef.current.currentTime:0}},handlePause=()=>{wrapper.state="suspended",wrapper.onstatechange&&wrapper.onstatechange.call(null,new Event("statechange"))},handlePlay=()=>{wrapper.state="running",wrapper.onstatechange&&wrapper.onstatechange.call(null,new Event("statechange"))},handleEnded=()=>{wrapper.state="closed",wrapper.onstatechange&&wrapper.onstatechange.call(null,new Event("statechange"))};return audioRef.current.addEventListener("pause",handlePause),audioRef.current.addEventListener("play",handlePlay),audioRef.current.addEventListener("ended",handleEnded),wrapper.cleanup=()=>{audioRef.current&&(audioRef.current.removeEventListener("pause",handlePause),audioRef.current.removeEventListener("play",handlePlay),audioRef.current.removeEventListener("ended",handleEnded))},wrapper},[]),cleanup=(0,react.useCallback)(()=>{console.log("[useTTS] Cleaning up"),timeoutRef.current&&(clearTimeout(timeoutRef.current),timeoutRef.current=null),audioWrapperRef.current&&audioWrapperRef.current.cleanup&&audioWrapperRef.current.cleanup(),audioWrapperRef.current=null,stopProcessing(),audioRef.current?.src&&(URL.revokeObjectURL(audioRef.current.src),audioRef.current=null),visemeLoadedRef.current=!1},[stopProcessing]),stop=(0,react.useCallback)(()=>{console.log("[useTTS] Stopping audio playback"),audioRef.current&&(audioRef.current.pause(),audioRef.current.currentTime=0),setIsPlaying(!1),cleanup(),isSpeakingRef.current=!1;const e=new CustomEvent("MemoriAudioEnded");document.dispatchEvent(e)},[cleanup]),emitEndSpeakEvent=(0,react.useCallback)(()=>{const e=new CustomEvent("MemoriEndSpeak");document.dispatchEvent(e),options.continuousSpeech&&options.onEndSpeakStartListen&&options.onEndSpeakStartListen()},[options.continuousSpeech,options.onEndSpeakStartListen]),speak=(0,react.useCallback)(async text=>{if(isMountedRef.current)if(text&&text.trim()&&!options.preview){if(speakerMuted)return console.log("[useTTS] TTS disabled - speaker is muted"),void emitEndSpeakEvent();if(isPlaying&&stop(),!isSpeakingRef.current){isSpeakingRef.current=!0,hasUserActivatedSpeak||setHasUserActivatedSpeak(!0);try{setIsPlaying(!0),setError(null);const response=await fetch(options.apiUrl||"/api/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text,tenant:config.tenant||"www.aisuru.com",voice:config.voice,model:config.model||"tts-1",region:config.region,provider:config.provider,includeVisemes:"ZOOMED_FULL_BODY"===config.layout||"FULLPAGE"===config.layout||"DEFAULT"===config.layout})});if(!response.ok){const errorData=await response.json().catch(()=>({}));throw new Error(errorData.error||`API error: ${response.status}`)}const visemeDataHeader=response.headers.get("X-Viseme-Data");let hasVisemeData=!1;if(visemeDataHeader)try{const visemeData=JSON.parse(visemeDataHeader);hasVisemeData=loadVisemeData(visemeData)}catch(err){console.error("[useTTS] Error parsing viseme data:",err)}const audioBlob=await response.blob(),audioUrl=URL.createObjectURL(audioBlob);if(!isSpeakingRef.current||!isMountedRef.current)return void URL.revokeObjectURL(audioUrl);audioRef.current=new Audio(audioUrl),hasVisemeData&&(audioWrapperRef.current=createAudioWrapper()),audioRef.current.oncanplaythrough=async()=>{try{if(!isSpeakingRef.current||!isMountedRef.current)return;hasVisemeData&&audioWrapperRef.current&&startProcessing(audioWrapperRef.current),await(audioRef.current?.play()),timeoutRef.current&&(clearTimeout(timeoutRef.current),timeoutRef.current=null),audioRef.current&&(audioRef.current.oncanplaythrough=null)}catch(e){cleanup(),isSpeakingRef.current=!1,emitEndSpeakEvent();const event=new CustomEvent("MemoriAudioEnded");document.dispatchEvent(event)}},audioRef.current.onended=()=>{setIsPlaying(!1),isSpeakingRef.current=!1,emitEndSpeakEvent();const e=new CustomEvent("MemoriAudioEnded");document.dispatchEvent(e)},audioRef.current.onerror=e=>{console.error("[useTTS] Audio playback error:",e),setIsPlaying(!1),isSpeakingRef.current=!1,cleanup();const errorMsg=new Error("Audio playback failed. This may be due to a network issue or audio format problem.");setError(errorMsg),emitEndSpeakEvent();const event=new CustomEvent("MemoriAudioEnded");document.dispatchEvent(event)},audioRef.current.load()}catch(err){console.error("[useTTS] Error during speech synthesis:",err),setIsPlaying(!1),isSpeakingRef.current=!1,timeoutRef.current&&(clearTimeout(timeoutRef.current),timeoutRef.current=null),cleanup();const errorMsg=err instanceof Error?err:new Error(String(err));setError(errorMsg),emitEndSpeakEvent();const e=new CustomEvent("MemoriAudioEnded");document.dispatchEvent(e)}}}else emitEndSpeakEvent()},[config,speakerMuted,options.preview,hasUserActivatedSpeak,stop,cleanup,loadVisemeData,createAudioWrapper,startProcessing,emitEndSpeakEvent,isPlaying]),toggleMute=(0,react.useCallback)(mute=>{const newMuteState=void 0!==mute?mute:!speakerMuted;setSpeakerMuted(newMuteState),newMuteState&&isPlaying&&stop()},[speakerMuted,isPlaying,stop]);return(0,react.useEffect)(()=>{"undefined"!=typeof window&&(window.memoriSpeaking=isPlaying)},[isPlaying]),(0,react.useEffect)(()=>{if("undefined"!=typeof window)return globalSpeakRef.current=window.speak,window.speak=speak,()=>{window.speak=globalSpeakRef.current}},[speak]),(0,react.useEffect)(()=>()=>{isSpeakingRef.current=!1,isMountedRef.current=!1,stop()},[stop]),{speak,stop,isPlaying,speakerMuted,toggleMute,hasUserActivatedSpeak,setHasUserActivatedSpeak,error,setError}}(ttsConfig,{apiUrl:`${baseUrl}/api/tts`,continuousSpeech,preview},autoStart,defaultEnableAudio,defaultSpeakerActive),{isListening,startRecording,stopRecording}=function useSTT(config,processSpeechAndSendMessage,options={},defaultEnableAudio=!0){const[recordingState,setRecordingState]=(0,react.useState)("idle"),[microphoneMuted,setMicrophoneMuted]=(0,react.useState)((0,configuration.uY)("muteMicrophone",!defaultEnableAudio)),[hasUserActivatedRecord,setHasUserActivatedRecord]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null),[lastTranscription,setLastTranscription]=(0,react.useState)(null),[isListening,setIsListening]=(0,react.useState)(!1),mediaRecorderRef=(0,react.useRef)(null),audioStreamRef=(0,react.useRef)(null),chunksRef=(0,react.useRef)([]),isRecordingRef=(0,react.useRef)(!1),isMountedRef=(0,react.useRef)(!0),silenceTimeoutRef=(0,react.useRef)(null),audioContextRef=(0,react.useRef)(null),analyserRef=(0,react.useRef)(null),dataArrayRef=(0,react.useRef)(null),backgroundNoiseRef=(0,react.useRef)(0),audioActivityHistoryRef=(0,react.useRef)([]),apiUrl=options.apiUrl||"/api/stt",silenceTimeout=options.silenceTimeout||3,initializeRecording=(0,react.useCallback)(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Media recording is not supported in this browser");const stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}});if(audioStreamRef.current=stream,options.continuousRecording)try{const AudioContextClass=window.AudioContext||window.webkitAudioContext;if(AudioContextClass){audioContextRef.current=new AudioContextClass({sampleRate:16e3,latencyHint:"interactive"}),"suspended"===audioContextRef.current.state&&await audioContextRef.current.resume(),await new Promise(resolve=>setTimeout(resolve,100)),analyserRef.current=audioContextRef.current.createAnalyser(),analyserRef.current.fftSize=512,analyserRef.current.smoothingTimeConstant=.3,analyserRef.current.minDecibels=-90,analyserRef.current.maxDecibels=-10;const bufferLength=analyserRef.current.frequencyBinCount;dataArrayRef.current=new Uint8Array(bufferLength),audioContextRef.current.createMediaStreamSource(stream).connect(analyserRef.current),backgroundNoiseRef.current=0,audioActivityHistoryRef.current=[],console.log("AudioContext initialized for silence detection")}}catch(err){console.warn("Silence detection initialization failed:",err)}let mimeType="";const supportedFormats=["audio/mp4","audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/wav"];for(const format of supportedFormats)if(MediaRecorder.isTypeSupported(format)){mimeType=format;break}console.log("Selected audio format:",mimeType||"default");const mediaRecorder=new MediaRecorder(stream,mimeType?{mimeType}:{});return mediaRecorder.ondataavailable=event=>{event.data.size>0&&chunksRef.current.push(event.data)},mediaRecorder.onstop=async()=>{if(console.log("MediaRecorder stopped, isRecordingRef:",isRecordingRef.current,"isMountedRef:",isMountedRef.current),isRecordingRef.current&&isMountedRef.current){setRecordingState("processing"),setIsListening(!1);try{if(0===chunksRef.current.length)throw new Error("No audio data recorded");let audioBlob=new Blob(chunksRef.current,{type:mediaRecorder.mimeType});if(0===audioBlob.size)throw new Error("Recorded audio is empty");if(console.log(`Audio blob size: ${audioBlob.size} bytes, type: ${audioBlob.type}`),"azure"===config.provider)try{console.log("Converting audio to WAV format for Azure"),audioBlob=await convertToWav(audioBlob),console.log("Audio converted to WAV successfully, new size:",audioBlob.size)}catch(conversionError){throw console.error("Failed to convert audio to WAV:",conversionError),new Error("Failed to convert audio to WAV format for Azure")}const result=await transcribeAudio(audioBlob);console.log("Transcription result:",result),result.text&&result.text.trim().length>0?(processSpeechAndSendMessage&&processSpeechAndSendMessage(result.text),setLastTranscription(result),options.onTranscriptionComplete&&options.onTranscriptionComplete(result)):console.log("No meaningful text transcribed, skipping message processing"),setRecordingState("idle")}catch(err){const errorMsg=err instanceof Error?err:new Error(String(err));console.error("Transcription error:",errorMsg),setError(errorMsg),setRecordingState("error"),options.onError&&options.onError(errorMsg)}finally{chunksRef.current=[],isRecordingRef.current=!1}}else console.log("Recording stopped early, not processing audio")},mediaRecorder.onerror=()=>{const errorMsg=new Error("Recording failed");setError(errorMsg),setRecordingState("error"),isRecordingRef.current=!1,options.onError&&options.onError(errorMsg)},mediaRecorderRef.current=mediaRecorder,!0}catch(err){const errorMsg=err instanceof Error?err:new Error("Failed to access microphone");return setError(errorMsg),setRecordingState("error"),options.onError&&options.onError(errorMsg),!1}},[config.provider,options,silenceTimeout]),detectAudioActivity=(0,react.useCallback)(()=>{if(!options.continuousRecording||!analyserRef.current||!dataArrayRef.current)return!1;try{analyserRef.current.getByteFrequencyData(dataArrayRef.current);let sum=0;for(let i=0;i<dataArrayRef.current.length;i++)sum+=dataArrayRef.current[i]*dataArrayRef.current[i];const rms=Math.sqrt(sum/dataArrayRef.current.length);0===backgroundNoiseRef.current?backgroundNoiseRef.current=rms:backgroundNoiseRef.current=.95*backgroundNoiseRef.current+.05*rms,audioActivityHistoryRef.current.push(rms),audioActivityHistoryRef.current.length>20&&audioActivityHistoryRef.current.shift();const dynamicThreshold=Math.max(2.5*backgroundNoiseRef.current,15),hasActivity=rms>dynamicThreshold;if(hasActivity){const recentActivity=audioActivityHistoryRef.current.slice(-5);return recentActivity.reduce((a,b)=>a+b,0)/recentActivity.length>.8*dynamicThreshold}return hasActivity}catch(error){return console.warn("Error in audio activity detection:",error),!1}},[options.continuousRecording]),startSilenceDetection=(0,react.useCallback)(()=>{if(!options.continuousRecording||!analyserRef.current)return;let lastActivityTime=Date.now(),silenceStartTime=null,consecutiveSilenceCount=0;const maxSilenceDuration=1e3*silenceTimeout,intervalId=setInterval(()=>{if(!isRecordingRef.current||!isMountedRef.current)return;const currentTime=Date.now();if(detectAudioActivity())lastActivityTime=currentTime,silenceStartTime=null,consecutiveSilenceCount=0,silenceTimeoutRef.current&&(clearTimeout(silenceTimeoutRef.current),silenceTimeoutRef.current=null),console.log("Audio activity detected, continuing recording");else{consecutiveSilenceCount++,null===silenceStartTime&&(silenceStartTime=currentTime);const silenceDuration=currentTime-silenceStartTime;if(consecutiveSilenceCount>=15&&silenceDuration>=maxSilenceDuration&&isRecordingRef.current&&isMountedRef.current)return console.log(`Stopping recording due to sustained silence: ${consecutiveSilenceCount} frames, ${silenceDuration}ms`),isRecordingRef.current=!1,void(mediaRecorderRef.current&&"recording"===mediaRecorderRef.current.state&&mediaRecorderRef.current.stop());if(silenceDuration>=1.5*maxSilenceDuration)return console.log("Stopping recording due to excessive silence duration"),isRecordingRef.current=!1,void(mediaRecorderRef.current&&"recording"===mediaRecorderRef.current.state&&mediaRecorderRef.current.stop())}},100);window.memoriSilenceDetectionInterval=intervalId,console.log("Silence detection started with improved algorithm")},[options.continuousRecording,detectAudioActivity,silenceTimeout]),stopSilenceDetection=(0,react.useCallback)(()=>{options.continuousRecording&&(silenceTimeoutRef.current&&(clearTimeout(silenceTimeoutRef.current),silenceTimeoutRef.current=null),window.memoriSilenceDetectionInterval&&(clearInterval(window.memoriSilenceDetectionInterval),window.memoriSilenceDetectionInterval=null))},[options.continuousRecording]),transcribeAudio=(0,react.useCallback)(async audioBlob=>{const formData=new FormData;let fileExtension="webm";"azure"===config.provider?fileExtension="wav":mediaRecorderRef.current?.mimeType&&(mediaRecorderRef.current.mimeType.includes("webm")?fileExtension="webm":mediaRecorderRef.current.mimeType.includes("mp4")?fileExtension="mp4":mediaRecorderRef.current.mimeType.includes("ogg")&&(fileExtension="ogg")),formData.append("audio",audioBlob,`recording.${fileExtension}`),formData.append("provider",config.provider),formData.append("tenant",config.tenant||"www.aisuru.com"),config.language&&formData.append("language",config.language),config.model&&formData.append("model",config.model),config.region&&formData.append("region",config.region);const response=await fetch(apiUrl,{method:"POST",body:formData});if(!response.ok){const errorData=await response.json().catch(()=>({}));throw new Error(errorData.error||`API error: ${response.status}`)}const data=await response.json();if(!data.success||!data.result)throw new Error("Invalid response from transcription service");return data.result},[config,apiUrl]),startRecording=(0,react.useCallback)(async()=>{if(isMountedRef.current&&!microphoneMuted&&"recording"!==recordingState){hasUserActivatedRecord||setHasUserActivatedRecord(!0);try{if(!(setError(null),setRecordingState("recording"),mediaRecorderRef.current||await initializeRecording()))return;if(chunksRef.current=[],isRecordingRef.current=!0,options.continuousRecording&&(backgroundNoiseRef.current=0,audioActivityHistoryRef.current=[]),mediaRecorderRef.current&&"inactive"===mediaRecorderRef.current.state){const isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),timeslice=isSafari?500:100;console.log(`Starting MediaRecorder with ${timeslice}ms timeslice (Safari: ${isSafari})`),mediaRecorderRef.current.start(timeslice),setIsListening(!0),options.continuousRecording&&startSilenceDetection()}}catch(err){const errorMsg=err instanceof Error?err:new Error("Failed to start recording");setError(errorMsg),setRecordingState("error"),isRecordingRef.current=!1,options.onError&&options.onError(errorMsg)}}},[microphoneMuted,recordingState,hasUserActivatedRecord,initializeRecording,options,startSilenceDetection]),stopRecording=(0,react.useCallback)(()=>{if(console.log("stopRecording called, isRecordingRef:",isRecordingRef.current,"continuousRecording:",options.continuousRecording),isRecordingRef.current)try{setIsListening(!1),options.continuousRecording&&stopSilenceDetection(),mediaRecorderRef.current&&"recording"===mediaRecorderRef.current.state&&mediaRecorderRef.current.stop()}catch(err){const errorMsg=err instanceof Error?err:new Error("Failed to stop recording");setError(errorMsg),setRecordingState("error"),isRecordingRef.current=!1,options.onError&&options.onError(errorMsg)}else console.log("Not currently recording, ignoring stop request")},[recordingState,options,stopSilenceDetection]),toggleRecording=(0,react.useCallback)(async()=>{"recording"===recordingState?stopRecording():"idle"===recordingState&&await startRecording()},[recordingState,startRecording,stopRecording]),toggleMute=(0,react.useCallback)(mute=>{const newMuteState=void 0!==mute?mute:!microphoneMuted;setMicrophoneMuted(newMuteState),newMuteState&&"recording"===recordingState&&stopRecording()},[microphoneMuted,recordingState,stopRecording]),cleanup=(0,react.useCallback)(()=>{if(isRecordingRef.current=!1,mediaRecorderRef.current&&("recording"===mediaRecorderRef.current.state&&mediaRecorderRef.current.stop(),mediaRecorderRef.current=null),audioStreamRef.current&&(audioStreamRef.current.getTracks().forEach(track=>track.stop()),audioStreamRef.current=null),options.continuousRecording&&audioContextRef.current){try{"closed"!==audioContextRef.current.state&&audioContextRef.current.close()}catch(error){console.warn("Error closing AudioContext:",error)}audioContextRef.current=null}options.continuousRecording&&stopSilenceDetection(),backgroundNoiseRef.current=0,audioActivityHistoryRef.current=[],analyserRef.current=null,dataArrayRef.current=null,chunksRef.current=[],setIsListening(!1),setRecordingState("idle")},[options.continuousRecording,stopSilenceDetection]);return(0,react.useEffect)(()=>()=>{isMountedRef.current=!1,cleanup()},[cleanup]),(0,react.useEffect)(()=>{"undefined"!=typeof window&&(window.memoriListening=isListening)},[isListening]),{recordingState,microphoneMuted,hasUserActivatedRecord,error,lastTranscription,isListening,startRecording,stopRecording,toggleRecording,toggleMute,transcribeAudio,setHasUserActivatedRecord,setError,cleanup}}(sttConfig,text=>{if(console.log("processSpeechAndSendMessage",text),text&&0!==text.trim().length)try{const message=(0,utils.Vx)(text);console.debug("Processing speech message:",message),message.length>0&&(setUserMessage(""),console.debug("Sending message:",message),sendMessage(message))}catch(error){console.error("Error in processSpeechAndSendMessage:",error)}},{apiUrl:`${baseUrl}/api/stt`,continuousRecording:continuousSpeech,silenceTimeout:continuousSpeechTimeout,autoStart},defaultEnableAudio),resetInteractionTimeout=()=>{clearInteractionTimeout(),isPlayingAudio||userMessage.length||memoriTyping||listening||setInteractionTimeout()},handleTimeout=async()=>{if(!hasUserActivatedSpeak||isPlayingAudio||userMessage.length||memoriTyping||listening)resetInteractionTimeout();else if(sessionId&&hasUserActivatedSpeak&&currentDialogState?.acceptsTimeout){const{currentState,...response}=await postTimeoutEvent(sessionId);if(0===response.resultCode&&currentState){const emission=currentState.emission;if(isMultilanguageEnabled&&userLang!==i18n?.language&&emission&&emission.length>0)translateDialogState({...currentState,emission},userLang).then(ts=>{let text=ts.translatedEmission||ts.emission;text&&text.trim()&&!speakerMuted&&handleSpeak(text)});else{if(!(emission&&emission.length>0))return void resetInteractionTimeout();pushMessage({text:emission,emitter:currentState.emitter,media:currentState.emittedMedia??currentState.media,fromUser:!1,generatedByAI:!!currentState.completion,contextVars:currentState.contextVars,date:currentState.currentDate,placeName:currentState.currentPlaceName,placeLatitude:currentState.currentLatitude,placeLongitude:currentState.currentLongitude,placeUncertaintyKm:currentState.currentUncertaintyKm,tag:currentState.currentTag,memoryTags:currentState.memoryTags}),emission&&emission.trim()&&!speakerMuted&&handleSpeak(emission),setCurrentDialogState({...currentState,hints:currentState.hints??("G1"===currentState.state?currentDialogState?.hints:[])})}}}},setInteractionTimeout=()=>{let timeout=currentDialogState?.timeout;if(!timeout){let timeoutLimit=40,timeoutMinLimit=25;if(timeout=Math.floor(Math.random()*(timeoutLimit-timeoutMinLimit))+timeoutMinLimit,currentDialogState?.emission){timeout+=currentDialogState.emission.length/26.5}}if(forcedTimeout&&(timeout=forcedTimeout,currentDialogState?.emission)){timeout+=currentDialogState.emission.length/26.5}let uiTimeout=setTimeout(handleTimeout,1e3*timeout);setUserInteractionTimeout(uiTimeout),timeoutRef.current=uiTimeout};(0,react.useEffect)(()=>{(userMessage.length||isPlayingAudio||memoriTyping)&&clearInteractionTimeout(),sessionId&&!userMessage.length&&resetInteractionTimeout()},[currentDialogState?.acceptsTimeout,currentDialogState?.timeout,currentDialogState?.state,isPlayingAudio,sessionId,history,userMessage,memoriTyping,hasUserActivatedSpeak]);const handleSpeak=async text=>{if(!text||!text.trim()||preview||speakerMuted||!defaultEnableAudio){const e=new CustomEvent("MemoriEndSpeak");return document.dispatchEvent(e),Promise.resolve()}"function"==typeof stopRecording&&stopRecording();const processedText=function sanitizeText(text){return(0,utils.Zn)((0,utils.eA)((0,utils.o6)((0,utils._e)((0,utils.gI)((0,utils.f9)(text))))))}(text);return ttsSpeak(processedText)},translateAndSpeak=(0,react.useCallback)(async(dialogState,language,msg,skipEmission=!1)=>{try{if(!dialogState)return console.warn("translateAndSpeak called with empty dialog state"),null;const translatedState=await translateDialogState(dialogState,language,msg,skipEmission),textToSpeak=translatedState.translatedEmission||translatedState.emission;return textToSpeak&&textToSpeak.trim()&&!skipEmission&&!speakerMuted&&(hasUserActivatedSpeak||setHasUserActivatedSpeak(!0),await handleSpeak(textToSpeak)),translatedState}catch(error){return console.error("Error in translateAndSpeak:",error),hasUserActivatedSpeak||setHasUserActivatedSpeak(!0),dialogState}},[translateDialogState,handleSpeak,hasUserActivatedSpeak,setHasUserActivatedSpeak]),stopAudio=(0,react.useCallback)(async()=>{ttsStop()},[ttsStop]);(0,react.useEffect)(()=>{"TOTEM"!==selectedLayout&&(()=>{let textarea=document.querySelector("#chat-fieldset textarea");textarea&&enableFocusChatInput?textarea.focus():textarea?.blur()})()},[currentDialogState?.emission]);const resetUIEffects=()=>{try{clearInteractionTimeout(),setClickedStart(!1),timeoutRef.current=void 0,stopAudio()}catch(e){console.log("Error: resetUIEffects",e)}};(0,react.useEffect)(()=>()=>{resetUIEffects()},[]),(0,react.useEffect)(()=>(document.addEventListener("MemoriResetUIEffects",resetUIEffects),()=>{document.removeEventListener("MemoriResetUIEffects",resetUIEffects)}),[]),(0,react.useEffect)(()=>{isPlayingAudio||!continuousSpeech||!hasUserActivatedListening&&requestedListening||!sessionId?isPlayingAudio&&isListening&&stopRecording():startRecording()},[isPlayingAudio,hasUserActivatedListening]),(0,react.useEffect)(()=>{stopRecording()},[language]);const[sendOnEnter,setSendOnEnter]=(0,react.useState)("keypress");(0,react.useEffect)(()=>{window.innerWidth<=768&&(0,utils.K1)()?setSendOnEnter("click"):setSendOnEnter("keypress")},[]);const[attachmentsMenuOpen,setAttachmentsMenuOpen]=(0,react.useState)(),globalBackground=integrationConfig?.globalBackground,globalBackgroundUrl=globalBackground?`url(${globalBackground})`:null,integrationProperties=integration?{"--memori-chat-bubble-bg":"#fff",...integrationConfig&&!instruct?{"--memori-text-color":integrationConfig.textColor??"#000"}:{},...integrationConfig?.buttonBgColor?{"--memori-button-bg":integrationConfig.buttonBgColor,"--memori-primary":integrationConfig.buttonBgColor}:{},...integrationConfig?.buttonTextColor?{"--memori-button-text":integrationConfig.buttonTextColor}:{},...integrationConfig?.blurBackground?{"--memori-blur-background":"5px"}:{"--memori-blur-background":"0px"},...integrationConfig?.innerBgColor?{"--memori-inner-bg":`rgba(${"dark"===integrationConfig.innerBgColor?"0, 0, 0":"255, 255, 255"}, ${integrationConfig.innerBgAlpha??.4})`,"--memori-inner-content-pad":"1.5rem","--memori-nav-bg-image":"none","--memori-nav-bg":`rgba(${"dark"===integrationConfig.innerBgColor?"0, 0, 0":"255, 255, 255"}, ${integrationConfig?.innerBgAlpha??.4})`}:{"--memori-inner-content-pad":"0px"}}:{},integrationStylesheet=`\n    ${preview?"#preview, ":applyVarsToRoot?":root, ":""}memori-client, .memori-widget, .memori-drawer, .memori-modal {\n      ${Object.entries(integrationProperties).map(([key,value])=>`${key}: ${value};`).join("\n")}\n    }\n  `,showAIicon=void 0===integrationConfig?.showAIicon||integrationConfig?.showAIicon,enableUpload=!!(showUpload??integrationConfig?.showUpload),enableReasoning=!!(showReasoning??integrationConfig?.showReasoning),showWhyThisAnswer=void 0===integrationConfig?.showWhyThisAnswer||integrationConfig?.showWhyThisAnswer,[avatar3dVisible,setAvatar3dVisible]=(0,react.useState)(!1);(0,react.useEffect)(()=>{(window.innerWidth>=768&&"FULLPAGE"===selectedLayout||"FULLPAGE"!==selectedLayout)&&setAvatar3dVisible(!0)},[]),(0,react.useEffect)(()=>{if(integrationConfig?.seoTitle){let meta=document.createElement("meta");meta.setAttribute("property","og:title"),meta.setAttribute("content",integrationConfig.seoTitle),document.head.append(meta)}if(integrationConfig?.seoDescription){let meta=document.createElement("meta");meta.setAttribute("property","og:description"),meta.setAttribute("content",integrationConfig.seoDescription),document.head.append(meta)}if(integrationConfig?.seoUrl){let meta=document.createElement("meta");meta.setAttribute("property","og:url"),meta.setAttribute("content",integrationConfig.seoUrl),document.head.append(meta)}let image=ogImage||memori.avatarURL;if(integrationConfig?.seoImageShowAvatar&&image){let meta=document.createElement("meta");meta.setAttribute("property","og:image"),meta.setAttribute("content",image),document.head.append(meta)}},[integrationConfig,memori.avatarURL,ogImage]);const memoriTextEnteredHandler=(0,react.useCallback)(e=>{if(disableTextEnteredEvents)return;const{text,waitForPrevious,hidden,typingText,useLoaderTextAsMsg,hasBatchQueued}=e.detail;text&&(waitForPrevious&&!speakerMuted&&(memoriSpeaking||memoriTyping)?setTimeout(()=>{memoriTextEnteredHandler(e)},1e3):(stopAudio(),sendMessage(text,void 0,void 0,void 0,void 0,hidden,typingText,useLoaderTextAsMsg,hasBatchQueued)))},[sessionId,isPlayingAudio,memoriTyping,userLang,disableTextEnteredEvents]);(0,react.useEffect)(()=>(disableTextEnteredEvents?document.removeEventListener("MemoriTextEntered",memoriTextEnteredHandler):document.addEventListener("MemoriTextEntered",memoriTextEnteredHandler),()=>{document.removeEventListener("MemoriTextEntered",memoriTextEnteredHandler)}),[sessionId,userLang,disableTextEnteredEvents]);const onClickStart=(0,react.useCallback)(async(session,initialSessionExpired=!1,chatLog)=>{const sessionID=chatLog?void 0:session?.sessionID||sessionId,dialogState=chatLog?void 0:session?.dialogState||currentDialogState;setClickedStart(!0);let translatedMessages=[],storageBirthDate=(0,configuration.uY)("birthDate",void 0),birth=birthDate||storageBirthDate||user?.birthDate;!birth&&autoStart&&initialSessionID&&(birth="1970-01-01T10:24:03.845Z");const localPosition=(0,configuration.uY)("position",void 0);if(autoStart&&!localPosition&&memori.needsPosition)setShowPositionDrawer(!0);else if(sessionID||!minAge||birth){if(!sessionID&&"PUBLIC"!==memori.privacyType&&!memori.secretToken&&!memoriPwd&&!memoriTokens||!sessionID&&gotErrorInOpening)return setAuthModalState("password"),void setClickedStart(!1);if(!sessionID||initialSessionExpired){setClickedStart(!1),setGotErrorInOpening(!1);const session=await fetchSession({memoriID:memori.engineMemoriID,password:secret||memoriPwd||memori.secretToken,tag:personification?.tag,pin:personification?.pin,continueFromChatLogID:chatLog?.chatLogID,initialContextVars:{PATHNAME:window.location.pathname?.toUpperCase(),ROUTE:window.location.pathname?.split("/")?.pop()?.toUpperCase()||"",...(chatLog?chatLog.lines[chatLog.lines.length-1].contextVars:initialContextVars)||{}},initialQuestion:chatLog?void 0:initialQuestion,birthDate:birth,additionalInfo:{...additionalInfo||{},loginToken:userToken??loginToken??additionalInfo?.loginToken??authToken,language:getCultureCodeByLanguage(userLang),timeZoneOffset:(new Date).getTimezoneOffset().toString()}});if(session?.dialogState)if(chatLog){const messages=chatLog.lines.map((l,i)=>({text:l.text,media:l.media?.filter(m=>constants.allowedMediaTypes.includes(m.mimeType))?.map(m=>({mediumID:`${i}-${m.mimeType}`,...m})),fromUser:l.inbound,timestamp:l.timestamp,emitter:l.emitter,initial:0===i}));if(translatedMessages=messages??[],language.toUpperCase()!==userLang.toUpperCase()&&isMultilanguageEnabled)try{translatedMessages=await Promise.all(messages.map(async m=>"originalText"in m&&m.originalText?m:{...m,originalText:m.text,text:(await(0,translations.s)(m.text,userLang,language,baseUrl)).text}))}catch(e){console.error("[CLICK_START] Error translating messages:",e)}setHistory(translatedMessages),translateDialogState(session.dialogState,userLang,void 0,!0).finally(()=>{setHasUserActivatedSpeak(!0)})}else setHistory([]),await translateAndSpeak(session.dialogState,userLang),setHasUserActivatedSpeak(!0);else 0===session?.resultCode?await onClickStart(session||void 0):setLoading(!1);return}if(initialSessionID){const{currentState,...response}=await getSession(sessionID);if(0!==response.resultCode||!currentState)return setGotErrorInOpening(!0),setSessionId(void 0),setClickedStart(!1),void await onClickStart(void 0,!0);if(setHistory([]),position&&memori.needsPosition&&applyPosition(position,sessionID),memori.needsDateTime&&sendDateChangedEvent({sessionID,state:currentState}),personification&&currentState.currentTag!==personification.tag)try{await changeTag(memori.engineMemoriID,sessionID,"-");const session=await changeTag(memori.engineMemoriID,sessionID,personification.tag,personification.pin);if(!session||0!==session.resultCode)throw new Error("No session");await translateAndSpeak(session.currentState,userLang)}catch(e){reopenSession(!0,memori?.secretToken,void 0,personification.tag,personification.pin,{PATHNAME:window.location.pathname?.toUpperCase(),ROUTE:window.location.pathname?.split("/")?.pop()?.toUpperCase()||"",...initialContextVars||{}},initialQuestion,birth).then(()=>{setHasUserActivatedSpeak(!0)})}else if(!personification&&currentState?.currentTag&&currentState?.currentTag!==constants.anonTag&&"-"!==currentState?.currentTag)try{await changeTag(memori.engineMemoriID,sessionID,"-");const session=await changeTag(memori.engineMemoriID,sessionID,constants.anonTag);if(!session||0!==session.resultCode)throw new Error("No session");await translateAndSpeak(session.currentState,userLang)}catch(e){reopenSession(!0,memori?.secretToken,void 0,void 0,void 0,{PATHNAME:window.location.pathname?.toUpperCase(),ROUTE:window.location.pathname?.split("/")?.pop()?.toUpperCase()||"",...initialContextVars||{}},initialQuestion,birth).then(()=>{setHasUserActivatedSpeak(!0)})}else{try{const{chatLogs}=await getSessionChatLogs(sessionID,sessionID),messages=chatLogs?.[0]?.lines.map((l,i)=>({text:l.text,media:l.media?.filter(m=>constants.allowedMediaTypes.includes(m.mimeType))?.map(m=>({mediumID:`${i}-${m.mimeType}`,...m})),fromUser:l.inbound,timestamp:l.timestamp,emitter:l.emitter,initial:0===i}));if(translatedMessages=messages??[],language.toUpperCase()!==userLang.toUpperCase()&&isMultilanguageEnabled)try{translatedMessages=await Promise.all(messages.map(async m=>({...m,originalText:m.text,text:(await(0,translations.s)(m.text,userLang,language,baseUrl)).text})))}catch(e){console.error("[CLICK_START] Error translating messages:",e)}setHistory(translatedMessages)}catch(e){console.error("[CLICK_START] Error retrieving chat logs:",e)}if(translatedMessages?.length&&translatedMessages.length>1||!initialQuestion)await translateAndSpeak(currentState,userLang,void 0,!!translatedMessages?.length);else{translatedMessages=[],setHistory([]),setMemoriTyping(!0);const response=await postTextEnteredEvent({sessionId:sessionID,text:initialQuestion});await translateAndSpeak(response.currentState??currentState,userLang,void 0,!1)}}position&&memori.needsPosition&&applyPosition(position,sessionID),memori.needsDateTime&&sendDateChangedEvent({sessionID,state:currentState})}else setHistory([]),await translateAndSpeak(dialogState,userLang)}else setShowAgeVerification(!0),setClickedStart(!1)},[memoriPwd,memori,memoriTokens,birthDate,sessionId,userLang,position]);(0,react.useEffect)(()=>{console.log("clickedStart",clickedStart),console.log("autoStart",autoStart),console.log("selectedLayout",selectedLayout),!clickedStart&&autoStart&&"HIDDEN_CHAT"!==selectedLayout&&onClickStart()},[clickedStart,autoStart,selectedLayout]),(0,react.useEffect)(()=>{const targetNode=document.querySelector(`memori-client[memoriname="${memori.name}"]`)||document.querySelector(`memori-client[memoriid="${memori.memoriID}"]`)||document.querySelector("memori-client");if(!targetNode)return;const observer=new MutationObserver((mutationList,_observer)=>{for(const mutation of mutationList)"attributes"===mutation.type&&"authtoken"===mutation.attributeName?.toLowerCase()&&("MEMORI-CLIENT"===mutation.target.nodeName?(setLoginToken(mutation.target.getAttribute("authtoken")||void 0),userToken=mutation.target.getAttribute("authtoken")||void 0):(setLoginToken(mutation.target?.parentElement?.getAttribute("authtoken")||void 0),userToken=mutation.target.getAttribute("authtoken")||void 0))});return observer.observe(targetNode,{attributes:!0,childList:!1,subtree:!1}),()=>{observer.disconnect()}},[]);const[experts,setExperts]=(0,react.useState)(),fetchExperts=(0,react.useCallback)(async()=>{if(sessionId&&memori?.enableBoardOfExperts)try{const{experts,count,...resp}=await getExpertReferences(sessionId);0===resp.resultCode?setExperts(experts):console.warn("Error fetching experts",resp)}catch(err){console.warn(err)}},[sessionId,memori?.enableBoardOfExperts]);(0,react.useEffect)(()=>{fetchExperts()},[sessionId,fetchExperts]);const deepThoughtEnabled=memori.enableDeepThought&&!!loginToken&&!!user?.userID&&user?.pAndCUAccepted,needsCredits=tenant?.billingDelegation,[hasEnoughCredits,setHasEnoughCredits]=(0,react.useState)(!0),checkCredits=(0,react.useCallback)(async()=>{if(tenant?.billingDelegation)try{const resp=await(async({operation="session_creation",baseUrl,userID,userName,tenant})=>{if(!userID&&!userName)throw new Error("Either userID or userName must be provided");const resp=await fetch(`${baseUrl}/api/verify-tokens`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operation,userID,userName,tenant})});if(!resp.ok)throw new Error("Failed to fetch credits");return resp.json()})({operation:deepThoughtEnabled?"dt_session_creation":"session_creation",baseUrl,userID:ownerUserID,userName:ownerUserName,tenant:tenantID});resp.enough?setHasEnoughCredits(!0):(setHasEnoughCredits(!1),console.warn("Not enough credits. Required:",resp.required))}catch(e){let err=e;console.debug(err)}},[tenant?.billingDelegation,deepThoughtEnabled]);(0,react.useEffect)(()=>{tenant?.billingDelegation&&checkCredits()},[tenant?.billingDelegation,deepThoughtEnabled]),(0,react.useEffect)(()=>{const closeSession=()=>{sessionId&&deleteSession(sessionId)};return window.addEventListener("beforeunload",closeSession),()=>{window.removeEventListener("beforeunload",closeSession),closeSession()}},[sessionId]);const showFullHistory=void 0===showOnlyLastMessages?"TOTEM"!==selectedLayout&&"WEBSITE_ASSISTANT"!==selectedLayout&&"HIDDEN_CHAT"!==selectedLayout:!showOnlyLastMessages,headerProps={memori:{...memori,ownerUserID:memori.ownerUserID??ownerUserID??void 0},tenant,history,showShare:showShare??integrationConfig?.showShare??!0,position,setShowPositionDrawer,setShowSettingsDrawer,setShowKnownFactsDrawer,setShowExpertsDrawer,enableAudio:defaultEnableAudio,speakerMuted:speakerMuted??!1,setSpeakerMuted:mute=>{if((enableAudio??integrationConfig?.enableAudio??1)||(mute=!0),toggleMute(mute),"CONTINUOUS"===(0,configuration.uY)("microphoneMode","HOLD_TO_TALK")&&mute&&(setContinuousSpeech(!1),(0,configuration.yY)("microphoneMode","HOLD_TO_TALK")),(0,configuration.yY)("muteSpeaker",!!mute),mute)stopAudio();else{audioContext=new es2019_module.Ut;let buffer=audioContext.createBuffer(1,1e4,22050),source=audioContext.createBufferSource();source.buffer=buffer,source.connect(audioContext.destination)}},setShowChatHistoryDrawer,showSettings:showSettings??integrationConfig?.showSettings??!0,showChatHistory:showChatHistory??integrationConfig?.showChatHistory??!0,hasUserActivatedSpeak,showReload:"TOTEM"===selectedLayout,showClear,clearHistory:()=>setHistory(h=>h.slice(-1)),showLogin:showLogin??memori.requireLoginToken,setShowLoginDrawer,loginToken,user,sessionID:sessionId,baseUrl},avatarProps={memori,integration,integrationConfig,tenant,instruct,avatar3dVisible,setAvatar3dVisible,hasUserActivatedSpeak,isPlayingAudio:isPlayingAudio&&!speakerMuted&&(enableAudio??integrationConfig?.enableAudio??!0),loading:!!memoriTyping,baseUrl,apiUrl:client.constants.BACKEND_URL,enablePositionControls,setEnablePositionControls,avatarType},startPanelProps={memori,tenant,language,userLang,setUserLang,baseUrl,apiUrl:client.constants.BACKEND_URL,position,openPositionDrawer:()=>setShowPositionDrawer(!0),integrationConfig,instruct,sessionId,clickedStart,isMultilanguageEnabled,onClickStart,isUserLoggedIn:!!loginToken&&!!user?.userID,hasInitialSession:!!initialSessionID,notEnoughCredits:needsCredits&&!hasEnoughCredits,showLogin:showLogin??memori.requireLoginToken,setShowLoginDrawer,user},chatProps={memori,sessionID:sessionId||"",tenant,translateTo:isMultilanguageEnabled&&userLang.toUpperCase()!==(memori.culture?.split("-")?.[0]??i18n.language??"IT")?.toUpperCase()?userLang:void 0,baseUrl,apiUrl:client.constants.BACKEND_URL,layout,memoriTyping,typingText,showTypingText,history:showFullHistory?history:history.slice(-2),authToken:loginToken??userToken??additionalInfo?.loginToken??authToken,dialogState:currentDialogState,pushMessage,simulateUserPrompt:(text,translatedText)=>{stopAudio(),sendMessage(text,void 0,void 0,!1,translatedText)},showDates,showContextPerLine,showAIicon,showUpload:enableUpload,showReasoning:enableReasoning,showWhyThisAnswer,showCopyButton,showTranslationOriginal,client,instruct,preview,sendOnEnter,setSendOnEnter,microphoneMode:continuousSpeech?"CONTINUOUS":"HOLD_TO_TALK",attachmentsMenuOpen,setAttachmentsMenuOpen,showInputs,showMicrophone:!!ttsProvider&&(enableAudio??integrationConfig?.enableAudio??!0),showFunctionCache,userMessage,onChangeUserMessage:value=>{if(!value||"\n"===value||""===value.trim())return setUserMessage(""),void resetInteractionTimeout();setUserMessage(value),clearInteractionTimeout()},sendMessage:(msg,media)=>{stopAudio(),stopRecording(),sendMessage(msg,media),setUserMessage("")},stopListening:stopRecording,startListening:startRecording,stopAudio,listening:isListening,setEnableFocusChatInput,isPlayingAudio,customMediaRenderer,user,userAvatar,experts,useMathFormatting:applyMathFormatting},integrationBackground=integration&&globalBackgroundUrl?(0,jsx_runtime.jsx)("div",{className:"memori--global-background",children:(0,jsx_runtime.jsx)("div",{className:"memori--global-background-image",style:{backgroundImage:globalBackgroundUrl}})}):(0,jsx_runtime.jsx)("div",{className:"memori--global-background no-background-image"}),integrationStyle=integration?(0,jsx_runtime.jsx)("style",{dangerouslySetInnerHTML:{__html:integrationStylesheet}}):null,poweredBy=(0,jsx_runtime.jsx)(PoweredBy.A,{tenant,userLang,integrationID:integration?.integrationID,memoriHash:`${memori.ownerTenantName}-${memori.ownerUserName}-${memori.name}`}),Layout=customLayout||("TOTEM"===selectedLayout?layouts_Totem:"CHAT"===selectedLayout?layouts_Chat:"FULLPAGE"===selectedLayout?layouts_FullPage:"WEBSITE_ASSISTANT"===selectedLayout?layouts_WebsiteAssistant:"HIDDEN_CHAT"===selectedLayout?layouts_HiddenChat:"ZOOMED_FULL_BODY"===selectedLayout?layouts_ZoomedFullBody:layouts_FullPage);return(0,jsx_runtime.jsxs)("div",{className:classnames_default()("memori","memori-widget",`memori-layout-${selectedLayout.toLowerCase()}`,`memori-controls-${controlsPosition.toLowerCase()}`,`memori--avatar-${integrationConfig?.avatar||"default"}`,{"memori--auto-start":autoStart,"memori--preview":preview,"memori--embed":embed,"memori--with-integration":integration,"memori--with-speechkey":!!ttsProvider,"memori--active":hasUserActivatedSpeak,"memori--hide-emissions":hideEmissions,"memori--has-active-session":!!sessionId}),"data-memori-name":memori?.name,"data-memori-id":memori?.engineMemoriID,"data-memori-secondary-id":memori?.memoriID,"data-memori-session-id":sessionId,"data-memori-integration":integration?.integrationID,"data-memori-engine-state":JSON.stringify({...currentDialogState,sessionID:sessionId}),style:{height},children:[(0,jsx_runtime.jsx)(Layout,{Header:Header.A,headerProps,Avatar:Avatar.A,avatarProps,Chat:Chat_Chat.A,chatProps,StartPanel:StartPanel.A,startPanelProps,integrationStyle,integrationBackground,poweredBy,autoStart,sessionId,hasUserActivatedSpeak,loading}),(0,jsx_runtime.jsx)("audio",{id:"memori-audio",style:{display:"none"},src:"https://aisuru.com/intro.mp3"}),isClient&&(0,jsx_runtime.jsx)(Auth.A,{withModal:!0,pwdOrTokens:authModalState,openModal:!!authModalState,setPwdOrTokens:setAuthModalState,showTokens:"SECRET"===memori.privacyType,onFinish:async values=>{values.password&&setMemoriPwd(values.password),values.password&&(memoriPassword=values.password),values.tokens&&setMemoriTokens(values.tokens),reopenSession(!sessionId,values.password,values.tokens,personification?.tag,personification?.pin,{PATHNAME:window.location.pathname?.toUpperCase(),ROUTE:window.location.pathname?.split("/")?.pop()?.toUpperCase()||"",...initialContextVars||{}},initialQuestion,birthDate).then(state=>{setAuthModalState(null),state?.dialogState?setHasUserActivatedSpeak(!0):onClickStart(state||void 0)}).catch(()=>{setAuthModalState(null),setGotErrorInOpening(!0)})},minimumNumberOfRecoveryTokens:memori?.minimumNumberOfRecoveryTokens??1}),isClient&&(0,jsx_runtime.jsx)(AgeVerificationModal.A,{visible:showAgeVerification,minAge,onClose:birthDate=>{birthDate?(setBirthDate(birthDate),(0,configuration.yY)("birthDate",birthDate),reopenSession(!sessionId,memoriPassword||memoriPwd||memori?.secretToken,memoriTokens,personification?.tag,personification?.pin,{PATHNAME:window.location.pathname?.toUpperCase(),ROUTE:window.location.pathname?.split("/")?.pop()?.toUpperCase()||"",...initialContextVars||{}},initialQuestion,birthDate).then(state=>{setShowAgeVerification(!1),setAuthModalState(null),onClickStart(state||void 0)}).catch(()=>{setShowAgeVerification(!1),setGotErrorInOpening(!0)})):(setShowAgeVerification(!1),setClickedStart(!1))}}),showSettingsDrawer&&(0,jsx_runtime.jsx)(SettingsDrawer.A,{layout:selectedLayout,open:!!showSettingsDrawer,onClose:()=>setShowSettingsDrawer(!1),microphoneMode:continuousSpeech?"CONTINUOUS":"HOLD_TO_TALK",continuousSpeechTimeout,setMicrophoneMode:mode=>setContinuousSpeech("CONTINUOUS"===mode),setContinuousSpeechTimeout,controlsPosition,setControlsPosition,hideEmissions,setHideEmissions,avatarType,setAvatarType,enablePositionControls,setEnablePositionControls,isAvatar3d:!!integrationConfig?.avatarURL,additionalSettings,speakerMuted}),showChatHistoryDrawer&&(0,jsx_runtime.jsx)(ChatHistory.A,{open:!!showChatHistoryDrawer,onClose:()=>setShowChatHistoryDrawer(!1),resumeSession:chatLog=>{setChatLogID(chatLog.chatLogID),onClickStart(void 0,!1,chatLog),setShowChatHistoryDrawer(!1)},apiClient:client,sessionId:sessionId||"",memori,baseUrl,history,apiUrl:client.constants.BACKEND_URL,loginToken,language,userLang,isMultilanguageEnabled}),showPositionDrawer&&(0,jsx_runtime.jsx)(PositionDrawer.A,{memori,open:!!showPositionDrawer,venue:position,setVenue:venue=>{_setPosition(venue),applyPosition(venue),venue&&memori.needsPosition?(0,configuration.yY)("position",JSON.stringify(venue)):venue||(0,configuration.k4)("position")},onClose:position=>{position&&applyPosition(position),setShowPositionDrawer(!1),autoStart&&onClickStart()}}),showKnownFactsDrawer&&sessionId&&(0,jsx_runtime.jsx)(KnownFacts.A,{apiClient:client,memori,sessionID:sessionId,visible:showKnownFactsDrawer,closeDrawer:()=>setShowKnownFactsDrawer(!1)}),showExpertsDrawer&&!!experts&&(0,jsx_runtime.jsx)(ExpertsDrawer.A,{apiUrl:client.constants.BACKEND_URL,baseUrl,tenant,experts,open:showExpertsDrawer,onClose:()=>setShowExpertsDrawer(!1)}),showLoginDrawer&&tenant?.name&&(0,jsx_runtime.jsx)(LoginDrawer.A,{tenant,apiClient:client,open:!!showLoginDrawer,user,loginToken,onClose:()=>setShowLoginDrawer(!1),onLogin:(user,token)=>{setUser(user),setLoginToken(token),userToken=token,setShowLoginDrawer(!1),(0,configuration.yY)("loginToken",token)},onLogout:()=>{loginToken&&client.backend.userLogout(loginToken).then(()=>{setShowLoginDrawer(!1),setUser(void 0),setLoginToken(void 0),userToken=void 0,(0,configuration.k4)("loginToken")})}}),error&&(0,jsx_runtime.jsx)(Alert.A,{open:!!error,onClose:()=>{setError(null),window.open("chrome://settings/content/autoplay","_blank")},title:"Error",description:error.message,type:"error"})]})};MemoriWidget.displayName="MemoriWidget";const MemoriWidget_MemoriWidget=MemoriWidget;try{MemoriWidget.displayName="MemoriWidget",MemoriWidget.__docgenInfo={description:"",displayName:"MemoriWidget",props:{memori:{defaultValue:null,description:"",name:"memori",required:!0,type:{name:"Memori"}},ownerUserName:{defaultValue:null,description:"",name:"ownerUserName",required:!1,type:{name:"string | null"}},ownerUserID:{defaultValue:null,description:"",name:"ownerUserID",required:!1,type:{name:"string | null"}},tenantID:{defaultValue:null,description:"",name:"tenantID",required:!0,type:{name:"string"}},memoriConfigs:{defaultValue:null,description:"",name:"memoriConfigs",required:!1,type:{name:"MemoriConfig[]"}},memoriLang:{defaultValue:null,description:"",name:"memoriLang",required:!1,type:{name:"string"}},multilingual:{defaultValue:null,description:"",name:"multilingual",required:!1,type:{name:"boolean"}},integration:{defaultValue:null,description:"",name:"integration",required:!1,type:{name:"Integration"}},layout:{defaultValue:null,description:"",name:"layout",required:!1,type:{name:"enum",value:[{value:'"DEFAULT"'},{value:'"FULLPAGE"'},{value:'"TOTEM"'},{value:'"CHAT"'},{value:'"WEBSITE_ASSISTANT"'},{value:'"HIDDEN_CHAT"'},{value:'"ZOOMED_FULL_BODY"'}]}},customLayout:{defaultValue:null,description:"",name:"customLayout",required:!1,type:{name:"FC<LayoutProps>"}},showShare:{defaultValue:null,description:"",name:"showShare",required:!1,type:{name:"boolean"}},showCopyButton:{defaultValue:{value:"true"},description:"",name:"showCopyButton",required:!1,type:{name:"boolean"}},showTranslationOriginal:{defaultValue:{value:"false"},description:"",name:"showTranslationOriginal",required:!1,type:{name:"boolean"}},showInputs:{defaultValue:{value:"true"},description:"",name:"showInputs",required:!1,type:{name:"boolean"}},showDates:{defaultValue:{value:"false"},description:"",name:"showDates",required:!1,type:{name:"boolean"}},showContextPerLine:{defaultValue:{value:"false"},description:"",name:"showContextPerLine",required:!1,type:{name:"boolean"}},showSettings:{defaultValue:null,description:"",name:"showSettings",required:!1,type:{name:"boolean"}},showClear:{defaultValue:{value:"false"},description:"",name:"showClear",required:!1,type:{name:"boolean"}},showOnlyLastMessages:{defaultValue:null,description:"",name:"showOnlyLastMessages",required:!1,type:{name:"boolean"}},showTypingText:{defaultValue:{value:"false"},description:"",name:"showTypingText",required:!1,type:{name:"boolean"}},showLogin:{defaultValue:{value:"false"},description:"",name:"showLogin",required:!1,type:{name:"boolean"}},showUpload:{defaultValue:null,description:"",name:"showUpload",required:!1,type:{name:"boolean"}},showChatHistory:{defaultValue:null,description:"",name:"showChatHistory",required:!1,type:{name:"boolean"}},showReasoning:{defaultValue:null,description:"",name:"showReasoning",required:!1,type:{name:"boolean"}},preview:{defaultValue:{value:"false"},description:"",name:"preview",required:!1,type:{name:"boolean"}},embed:{defaultValue:{value:"false"},description:"",name:"embed",required:!1,type:{name:"boolean"}},height:{defaultValue:{value:"100vh"},description:"",name:"height",required:!1,type:{name:"string | number"}},secret:{defaultValue:null,description:"",name:"secret",required:!1,type:{name:"string"}},baseUrl:{defaultValue:{value:"https://aisuru-staging.aclambda.online"},description:"",name:"baseUrl",required:!1,type:{name:"string"}},apiURL:{defaultValue:{value:"https://backend-staging.memori.ai"},description:"",name:"apiURL",required:!1,type:{name:"string"}},engineURL:{defaultValue:{value:"https://engine-staging.memori.ai"},description:"",name:"engineURL",required:!1,type:{name:"string"}},initialContextVars:{defaultValue:null,description:"",name:"initialContextVars",required:!1,type:{name:"{ [key: string]: string; }"}},initialQuestion:{defaultValue:null,description:"",name:"initialQuestion",required:!1,type:{name:"string"}},ogImage:{defaultValue:null,description:"",name:"ogImage",required:!1,type:{name:"string"}},sessionID:{defaultValue:null,description:"",name:"sessionID",required:!1,type:{name:"string"}},tenant:{defaultValue:null,description:"",name:"tenant",required:!1,type:{name:"Tenant"}},personification:{defaultValue:null,description:"",name:"personification",required:!1,type:{name:"{ name?: string; tag: string; pin: string; }"}},ttsProvider:{defaultValue:null,description:"",name:"ttsProvider",required:!1,type:{name:"enum",value:[{value:'"azure"'},{value:'"openai"'}]}},enableAudio:{defaultValue:null,description:"",name:"enableAudio",required:!1,type:{name:"boolean"}},defaultSpeakerActive:{defaultValue:{value:"true"},description:"",name:"defaultSpeakerActive",required:!1,type:{name:"boolean"}},disableTextEnteredEvents:{defaultValue:{value:"false"},description:"",name:"disableTextEnteredEvents",required:!1,type:{name:"boolean"}},onStateChange:{defaultValue:null,description:"",name:"onStateChange",required:!1,type:{name:"((state?: DialogState) => void)"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"({ [key: string]: string; loginToken?: string; language?: string | undefined; referral?: string | undefined; timeZoneOffset?: string | undefined; } & { [key: string]: string; }) | undefined"}},customMediaRenderer:{defaultValue:null,description:"",name:"customMediaRenderer",required:!1,type:{name:"((mimeType: string) => Element | null)"}},additionalSettings:{defaultValue:null,description:"",name:"additionalSettings",required:!1,type:{name:"Element | null"}},userAvatar:{defaultValue:null,description:"",name:"userAvatar",required:!1,type:{name:"string | Element"}},useMathFormatting:{defaultValue:{value:"false"},description:"",name:"useMathFormatting",required:!1,type:{name:"boolean"}},autoStart:{defaultValue:{value:"false"},description:"",name:"autoStart",required:!1,type:{name:"boolean"}},applyVarsToRoot:{defaultValue:{value:"false"},description:"",name:"applyVarsToRoot",required:!1,type:{name:"boolean"}},showFunctionCache:{defaultValue:{value:"false"},description:"",name:"showFunctionCache",required:!1,type:{name:"boolean"}},authToken:{defaultValue:null,description:"",name:"authToken",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/MemoriWidget/MemoriWidget.tsx#MemoriWidget"]={docgenInfo:MemoriWidget.__docgenInfo,name:"MemoriWidget",path:"src/components/MemoriWidget/MemoriWidget.tsx#MemoriWidget"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/PositionDrawer/PositionDrawer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var _ui_Drawer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/components/ui/Drawer.tsx"),react_i18next__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),_VenueWidget_VenueWidget__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/VenueWidget/VenueWidget.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");const PositionDrawer=({memori,open,onClose,venue,setVenue})=>{const{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_2__.B)();return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_ui_Drawer__WEBPACK_IMPORTED_MODULE_1__.A,{className:"memori-position-drawer",open,onClose:()=>onClose(venue),title:t("widget.position")||"Position",animated:!1,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("p",{children:t("write_and_speak.requirePositionHelp",{name:memori.name})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_VenueWidget_VenueWidget__WEBPACK_IMPORTED_MODULE_3__.A,{venue,setVenue,showUncertainty:!1,saveAndClose:venue=>{setVenue(venue),onClose(venue)}})]})};PositionDrawer.displayName="PositionDrawer";const __WEBPACK_DEFAULT_EXPORT__=PositionDrawer;try{PositionDrawer.displayName="PositionDrawer",PositionDrawer.__docgenInfo={description:"",displayName:"PositionDrawer",props:{memori:{defaultValue:null,description:"",name:"memori",required:!0,type:{name:"Memori"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"(venue?: Venue | undefined) => void"}},venue:{defaultValue:null,description:"",name:"venue",required:!1,type:{name:"Venue"}},setVenue:{defaultValue:null,description:"",name:"setVenue",required:!0,type:{name:"(venue: Venue) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/PositionDrawer/PositionDrawer.tsx#PositionDrawer"]={docgenInfo:PositionDrawer.__docgenInfo,name:"PositionDrawer",path:"src/components/PositionDrawer/PositionDrawer.tsx#PositionDrawer"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/PoweredBy/PoweredBy.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/jsx-runtime.js");const PoweredBy=({tenant,userLang="en",integrationID,memoriHash})=>{const tenantId="memorytwin"===tenant?.theme?"memorytwin":"twincreator"===tenant?.theme?"twincreator":"aisuru";return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"memori--powered-by",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("img",{src:`https://aisuru.com/images/${tenantId}/logo.png`,alt:""}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("p",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"sr-only",children:"Powered by"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{href:`https://memori.ai/${"it"===userLang?.toLowerCase()?"it":"en"}${integrationID?`?integrationID=${integrationID}`:""}${memoriHash?`${integrationID?"&":"?"}memori=${memoriHash}`:""}`,target:"_blank",rel:"noopener noreferrer",children:"Memori.AI"})]})]})};PoweredBy.displayName="PoweredBy";const __WEBPACK_DEFAULT_EXPORT__=PoweredBy;try{PoweredBy.displayName="PoweredBy",PoweredBy.__docgenInfo={description:"",displayName:"PoweredBy",props:{tenant:{defaultValue:null,description:"",name:"tenant",required:!1,type:{name:"Tenant"}},userLang:{defaultValue:{value:"en"},description:"",name:"userLang",required:!1,type:{name:"string"}},integrationID:{defaultValue:null,description:"",name:"integrationID",required:!1,type:{name:"string"}},memoriHash:{defaultValue:null,description:"",name:"memoriHash",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/PoweredBy/PoweredBy.tsx#PoweredBy"]={docgenInfo:PoweredBy.__docgenInfo,name:"PoweredBy",path:"src/components/PoweredBy/PoweredBy.tsx#PoweredBy"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/VenueWidget/VenueWidget.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>VenueWidget_VenueWidget});var react=__webpack_require__("./node_modules/react/index.js"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js");const DEGREES_TO_RADIANS=Math.PI/180,getUncertaintyByViewport=bouningBox=>{const[minLat,maxLat,minLng,maxLng]="string"==typeof bouningBox[0]?bouningBox.map(parseFloat):bouningBox,phi1=minLat*DEGREES_TO_RADIANS,lambda1=minLng*DEGREES_TO_RADIANS,phi2=maxLat*DEGREES_TO_RADIANS,lambda2=maxLng*DEGREES_TO_RADIANS;return 6367.5*(2*Math.asin(Math.sqrt(Math.sin((phi2-phi1)/2)*Math.sin((phi2-phi1)/2)+Math.cos(phi1)*Math.cos(phi2)*Math.sin((lambda2-lambda1)/2)*Math.sin((lambda2-lambda1)/2))))};var hooks=__webpack_require__("./node_modules/react-leaflet/lib/hooks.js"),MapContainer=__webpack_require__("./node_modules/react-leaflet/lib/MapContainer.js"),TileLayer=__webpack_require__("./node_modules/react-leaflet/lib/TileLayer.js"),Marker=__webpack_require__("./node_modules/react-leaflet/lib/Marker.js"),Popup=__webpack_require__("./node_modules/react-leaflet/lib/Popup.js"),lib_context=__webpack_require__("./node_modules/@react-leaflet/core/lib/context.js"),leaflet_src=__webpack_require__("./node_modules/leaflet/dist/leaflet-src.js"),leaflet_src_default=__webpack_require__.n(leaflet_src),dist=__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs"),Button=__webpack_require__("./src/components/ui/Button.tsx"),utils=__webpack_require__("./src/helpers/utils.ts"),combobox=__webpack_require__("./node_modules/@headlessui/react/dist/components/combobox/combobox.js"),transition=__webpack_require__("./node_modules/@headlessui/react/dist/components/transitions/transition.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),Spin=__webpack_require__("./src/components/ui/Spin.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Circle=({center,size})=>{const context=(0,lib_context.U$)();return(0,react.useEffect)(()=>{const square=new(leaflet_src_default().Circle)(center,size),container=context.layerContainer||context.map;return container.addLayer(square),()=>{container.removeLayer(square)}}),null},CenterAndZoomUpdater=({center,uncertainty})=>{const[init,setInit]=(0,react.useState)(!1),map=(0,hooks.ko)(),updateView=(0,react.useCallback)(()=>{let zoom=void 0!==uncertainty?Math.round(Math.log2(1e7/uncertainty)):map.getZoom();map.setView(center,zoom)},[center,uncertainty,map]);return(0,react.useEffect)(()=>{init||(updateView(),setInit(!0))},[]),(0,react.useEffect)(()=>{updateView()},[center,uncertainty,updateView]),null};let DefaultIcon=leaflet_src_default().icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12.5,20.5],shadowAnchor:[12.5,20.5]});leaflet_src_default().Marker.prototype.options.icon=DefaultIcon;const getPlaceName=venue=>{let placeName="Position";return venue?.address?placeName=[venue.address.village||venue.address.suburb,venue.address.town||venue.address.city||venue.address.county||venue.address.state,venue.address.country].filter(Boolean).filter((v,i,a)=>a.indexOf(v)===i).join(", "):venue?.display_name&&(placeName=venue.display_name),placeName},VenueWidget=({venue,setVenue,showUncertainty=!1,showGpsButton=!0,saveAndClose})=>{const{t}=(0,useTranslation.B)(),[isClient,setIsClient]=(0,react.useState)(!1),[updatingPosition,setUpdatingPosition]=(0,react.useState)(!1),[fetching,setFetching]=(0,react.useState)(!1),[query,setQuery]=(0,react.useState)(""),[suggestions,setSuggestions]=(0,react.useState)([]),handleSearch=(0,utils.xD)(async value=>{setFetching(!0);try{let response=await fetch(`https://nominatim.openstreetmap.org/search?q=${value}&format=jsonv2&limit=5&addressdetails=1`),data=await response.json();setSuggestions(data)}catch(error){console.error(error)}finally{setFetching(!1)}},1e3);return(0,react.useEffect)(()=>{setIsClient(!0)},[]),(0,react.useEffect)(()=>{const leafletCSS=document.createElement("link");return leafletCSS.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",leafletCSS.rel="stylesheet",leafletCSS.integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=",leafletCSS.crossOrigin="",document.head.appendChild(leafletCSS),()=>{document.head.removeChild(leafletCSS)}},[]),(0,jsx_runtime.jsxs)("fieldset",{className:"memori--venue-widget",children:[(0,jsx_runtime.jsx)("legend",{className:"sr-only",children:"Venue"}),(0,jsx_runtime.jsxs)("div",{className:"memori--venue-widget__form-item",children:[(0,jsx_runtime.jsx)("div",{className:"memori--venue-widget__geosuggest",children:updatingPosition?(0,jsx_runtime.jsx)("p",{children:t("write_and_speak.updatingPosition")}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"memori--venue-widget-search",children:(0,jsx_runtime.jsxs)(combobox.G,{value:venue?.latitude&&venue?.longitude?{place_id:0,lat:venue?.latitude,lon:venue?.longitude,display_name:venue?.placeName}:void 0,onChange:value=>{console.log(value);const placeName=getPlaceName(value);setVenue({latitude:value.lat,longitude:value.lon,placeName,uncertainty:value?.boundingbox?getUncertaintyByViewport(value.boundingbox):2})},children:[(0,jsx_runtime.jsx)(combobox.G.Input,{className:"memori--venue-widget-search--input",displayValue:i=>i?getPlaceName(i):"",placeholder:t("searchVenue"),onChange:e=>{return value=e.target.value,setQuery(value),void handleSearch(value);var value}}),(fetching||suggestions.length>0||0===suggestions.length&&""!==query)&&(0,jsx_runtime.jsx)(transition.e,{as:react.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,jsx_runtime.jsx)(combobox.G.Options,{className:"memori--venue-widget-search--options",children:fetching?(0,jsx_runtime.jsx)(Spin.A,{spinning:!0,children:(0,jsx_runtime.jsxs)("div",{className:"memori--venue-widget-search--option memori--venue-widget-search--option-centered",children:[t("loading"),"..."]})}):0===suggestions.length&&""!==query?(0,jsx_runtime.jsx)("div",{className:"memori--venue-widget-search--option memori--venue-widget-search--option-centered",children:t("nothingFound")}):suggestions?.map(s=>(0,jsx_runtime.jsx)(combobox.G.Option,{as:react.Fragment,value:s,children:({active,selected})=>(0,jsx_runtime.jsx)("li",{className:classnames_default()("memori--venue-widget-search--option",{"memori--venue-widget-search--option-active":active,"memori--venue-widget-search--option-selected":selected}),children:s.display_name})},s.place_id))})})]})}),showGpsButton&&(0,jsx_runtime.jsx)(Button.A,{className:"memori--venue-widget__gps-button",primary:!0,loading:updatingPosition,onClick:()=>{setUpdatingPosition(!0),(async()=>{setUpdatingPosition(!0),navigator.geolocation.getCurrentPosition(async coords=>{let venue={latitude:coords.coords.latitude,longitude:coords.coords.longitude,placeName:"Position",uncertainty:coords.coords.accuracy/1e3};try{const result=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${coords.coords.latitude}&lon=${coords.coords.longitude}&format=jsonv2&addressdetails=1`),response=await result.json(),placeName=getPlaceName(response);venue={latitude:coords.coords.latitude,longitude:coords.coords.longitude,placeName,uncertainty:coords.coords.accuracy/1e3},setVenue(venue)}catch(e){let err=e;console.error("[POSITION ERROR]",err),err?.message&&dist.Ay.error(err.message),setVenue(venue)}finally{saveAndClose&&saveAndClose(venue)}setUpdatingPosition(!1)},err=>{console.error("[POSITION ERROR]",err),dist.Ay.error(err.message),setUpdatingPosition(!1)})})()},children:t("write_and_speak.useMyPosition")})]})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(Button.A,{outlined:!0,className:"memori--venue-widget__no-location-button",onClick:()=>{let venue={latitude:0,longitude:0,placeName:"Position",uncertainty:0};setVenue(venue),saveAndClose&&saveAndClose(venue)},children:t("write_and_speak.dontWantToProvidePosition")})}),showUncertainty&&(0,jsx_runtime.jsxs)("label",{className:"memori--venue-widget__select-label",children:[(0,jsx_runtime.jsxs)("span",{children:[t("uncertain"),": "]}),(0,jsx_runtime.jsxs)("select",{className:"memori-select--button memori--venue-widget__uncertainty",value:parseFloat((venue?.uncertainty??0).toFixed(2)),disabled:!(venue&&venue.placeName&&venue.latitude&&venue.longitude),onChange:e=>{setVenue({...venue,uncertainty:parseFloat(e.target.value)})},children:[venue?.uncertainty&&![0,1,2,5,10,20,50,100].includes(venue.uncertainty)&&(0,jsx_runtime.jsxs)("option",{value:venue.uncertainty,children:[venue.uncertainty," Km"]}),(0,jsx_runtime.jsx)("option",{value:0,children:t("exactPosition")}),(0,jsx_runtime.jsx)("option",{value:1,children:"1 km"}),(0,jsx_runtime.jsx)("option",{value:2,children:"2 km"}),(0,jsx_runtime.jsx)("option",{value:5,children:"5 km"}),(0,jsx_runtime.jsx)("option",{value:10,children:"10 km"}),(0,jsx_runtime.jsx)("option",{value:20,children:"20 km"}),(0,jsx_runtime.jsx)("option",{value:50,children:"50 km"}),(0,jsx_runtime.jsx)("option",{value:100,children:"100 km"})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"memori--venue-widget__form-item",children:[venue?.placeName&&"Position"!==venue.placeName&&(0,jsx_runtime.jsxs)("p",{className:"memori--venue--widget__place-name",children:[(0,jsx_runtime.jsx)("strong",{children:t("venue")}),": ",venue.placeName]}),(0,jsx_runtime.jsx)("div",{className:"memori--venue-widget__map",children:isClient&&(0,jsx_runtime.jsxs)(MapContainer.W,{className:"memori--venue-widget__map",center:venue?.latitude&&venue?.longitude?[venue.latitude,venue.longitude]:[44.66579,11.48823],zoom:13,scrollWheelZoom:!0,children:[(0,jsx_runtime.jsx)(TileLayer.e,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,jsx_runtime.jsx)(CenterAndZoomUpdater,{center:venue?.latitude&&venue?.longitude?[venue.latitude,venue.longitude]:[44.66579,11.48823],uncertainty:1e3*(venue?.uncertainty??0)}),venue?.latitude&&venue?.longitude&&(0,jsx_runtime.jsx)(Marker.p,{position:[venue.latitude,venue.longitude],icon:DefaultIcon,children:(0,jsx_runtime.jsx)(Popup.z,{children:venue.placeName??""})}),venue?.latitude&&venue?.longitude&&void 0!==venue?.uncertainty&&(0,jsx_runtime.jsx)(Circle,{center:[venue.latitude,venue.longitude],size:1e3*venue.uncertainty})]})})]})]})};VenueWidget.displayName="VenueWidget";const VenueWidget_VenueWidget=VenueWidget;try{VenueWidget.displayName="VenueWidget",VenueWidget.__docgenInfo={description:"",displayName:"VenueWidget",props:{venue:{defaultValue:null,description:"",name:"venue",required:!1,type:{name:"Venue"}},setVenue:{defaultValue:null,description:"",name:"setVenue",required:!0,type:{name:"(venue: Venue) => void"}},showUncertainty:{defaultValue:{value:"false"},description:"",name:"showUncertainty",required:!1,type:{name:"boolean"}},showGpsButton:{defaultValue:{value:"true"},description:"",name:"showGpsButton",required:!1,type:{name:"boolean"}},saveAndClose:{defaultValue:null,description:"",name:"saveAndClose",required:!1,type:{name:"((venue: Venue) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/VenueWidget/VenueWidget.tsx#VenueWidget"]={docgenInfo:VenueWidget.__docgenInfo,name:"VenueWidget",path:"src/components/VenueWidget/VenueWidget.tsx#VenueWidget"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/Delete.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Delete=({className,title})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("svg",{...title?{}:{"aria-hidden":"true"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",focusable:"false",role:"img",className,"aria-label":title,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"})});Delete.displayName="Delete";const __WEBPACK_DEFAULT_EXPORT__=Delete;try{Delete.displayName="Delete",Delete.__docgenInfo={description:"",displayName:"Delete",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Delete.tsx#Delete"]={docgenInfo:Delete.__docgenInfo,name:"Delete",path:"src/components/icons/Delete.tsx#Delete"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/Edit.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Edit=({className,title})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("svg",{...title?{}:{"aria-hidden":"true"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",focusable:"false",role:"img",className,"aria-label":title,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"})});Edit.displayName="Edit";const __WEBPACK_DEFAULT_EXPORT__=Edit;try{Edit.displayName="Edit",Edit.__docgenInfo={description:"",displayName:"Edit",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Edit.tsx#Edit"]={docgenInfo:Edit.__docgenInfo,name:"Edit",path:"src/components/icons/Edit.tsx#Edit"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/Eye.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Eye=({className,title})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("svg",{...title?{}:{"aria-hidden":"true"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",focusable:"false",role:"img",className,"aria-label":title,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"})});Eye.displayName="Eye";const __WEBPACK_DEFAULT_EXPORT__=Eye;try{Eye.displayName="Eye",Eye.__docgenInfo={description:"",displayName:"Eye",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Eye.tsx#Eye"]={docgenInfo:Eye.__docgenInfo,name:"Eye",path:"src/components/icons/Eye.tsx#Eye"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/EyeInvisible.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const EyeInvisible=({className,title})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("svg",{...title?{}:{"aria-hidden":"true"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",focusable:"false",role:"img",className,"aria-label":title,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M942.2 486.2Q889.47 375.11 816.7 305l-50.88 50.88C807.31 395.53 843.45 447.4 874.7 512 791.5 684.2 673.4 766 512 766q-72.67 0-133.87-22.38L323 798.75Q408 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 000-51.5zm-63.57-320.64L836 122.88a8 8 0 00-11.32 0L715.31 232.2Q624.86 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 000 51.5q56.69 119.4 136.5 191.41L112.48 835a8 8 0 000 11.31L155.17 889a8 8 0 0011.31 0l712.15-712.12a8 8 0 000-11.32zM149.3 512C232.6 339.8 350.7 258 512 258c54.54 0 104.13 9.36 149.12 28.39l-70.3 70.3a176 176 0 00-238.13 238.13l-83.42 83.42C223.1 637.49 183.3 582.28 149.3 512zm246.7 0a112.11 112.11 0 01146.2-106.69L401.31 546.2A112 112 0 01396 512z"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M508 624c-3.46 0-6.87-.16-10.25-.47l-52.82 52.82a176.09 176.09 0 00227.42-227.42l-52.82 52.82c.31 3.38.47 6.79.47 10.25a111.94 111.94 0 01-112 112z"})]});EyeInvisible.displayName="EyeInvisible";const __WEBPACK_DEFAULT_EXPORT__=EyeInvisible;try{EyeInvisible.displayName="EyeInvisible",EyeInvisible.__docgenInfo={description:"",displayName:"EyeInvisible",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/EyeInvisible.tsx#EyeInvisible"]={docgenInfo:EyeInvisible.__docgenInfo,name:"EyeInvisible",path:"src/components/icons/EyeInvisible.tsx#EyeInvisible"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/Plus.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Plus=({className,title})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("svg",{...title?{}:{"aria-hidden":"true"},focusable:"false",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",className,"aria-label":title,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z"})]});Plus.displayName="Plus";const __WEBPACK_DEFAULT_EXPORT__=Plus;try{Plus.displayName="Plus",Plus.__docgenInfo={description:"",displayName:"Plus",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Plus.tsx#Plus"]={docgenInfo:Plus.__docgenInfo,name:"Plus",path:"src/components/icons/Plus.tsx#Plus"})}catch(__react_docgen_typescript_loader_error){}}}]);