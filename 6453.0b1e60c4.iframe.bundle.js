"use strict";(self.webpackChunk_memori_ai_memori_react=self.webpackChunk_memori_ai_memori_react||[]).push([[6453],{"./src/components/Avatar/AvatarView/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ContainerAvatarView});var react=__webpack_require__("./node_modules/react/index.js"),react_three_fiber_esm=__webpack_require__("./node_modules/@react-three/fiber/dist/react-three-fiber.esm.js"),SpotLight=__webpack_require__("./node_modules/@react-three/drei/core/SpotLight.js"),Environment=__webpack_require__("./node_modules/@react-three/drei/core/Environment.js"),PerspectiveCamera=__webpack_require__("./node_modules/@react-three/drei/core/PerspectiveCamera.js"),OrbitControls=__webpack_require__("./node_modules/@react-three/drei/core/OrbitControls.js"),utils=__webpack_require__("./src/helpers/utils.ts"),lil_gui_esm=__webpack_require__("./node_modules/lil-gui/dist/lil-gui.esm.js");const components_controls=({onBaseActionChange,baseActions,modifyTimeScale,onMorphTargetInfluencesChange,onMorphTargetDictionaryChange,morphTargetDictionary,timeScale})=>{const guiRef=(0,react.useRef)(null),panelSettingsRef=(0,react.useRef)({"modify time scale":timeScale}),crossFadeControlsRef=(0,react.useRef)([]);return(0,react.useEffect)((()=>{const gui=new lil_gui_esm.ZP({width:310});guiRef.current=gui;const folder1=gui.addFolder("Base Actions"),folder2=gui.addFolder("Additive Action Weights"),folder3=gui.addFolder("General Speed");return["None",...Object.keys(baseActions)].forEach((name=>{baseActions[name];panelSettingsRef.current[name]=()=>{onBaseActionChange(name,"")};const control=folder1.add(panelSettingsRef.current,name);crossFadeControlsRef.current.push(control)})),Object.entries(morphTargetDictionary).forEach((([name,settings])=>{panelSettingsRef.current[name]=settings/100,folder2.add(panelSettingsRef.current,name,-1,1,.01).listen().onChange((weight=>{onMorphTargetInfluencesChange({[name]:weight})}))})),folder3.add(panelSettingsRef.current,"modify time scale",0,1.5,.01).onChange((value=>{modifyTimeScale(value)})),folder1.open(),folder2.open(),folder3.open(),()=>{gui.destroy()}}),[onBaseActionChange,onMorphTargetInfluencesChange,onMorphTargetDictionaryChange,modifyTimeScale,baseActions,morphTargetDictionary,timeScale]),null};try{controls.displayName="controls",controls.__docgenInfo={description:"",displayName:"controls",props:{baseActions:{defaultValue:null,description:"",name:"baseActions",required:!0,type:{name:"Record<string, BaseAction>"}},onBaseActionChange:{defaultValue:null,description:"",name:"onBaseActionChange",required:!0,type:{name:"(action: string, outputContent: string) => void"}},currentBaseAction:{defaultValue:null,description:"",name:"currentBaseAction",required:!0,type:{name:"{ action: string; weight: number; }"}},onMorphTargetInfluencesChange:{defaultValue:null,description:"",name:"onMorphTargetInfluencesChange",required:!0,type:{name:"(influences: { [key: string]: number; }) => void"}},onMorphTargetDictionaryChange:{defaultValue:null,description:"",name:"onMorphTargetDictionaryChange",required:!0,type:{name:"(dictionary: { [key: string]: number; }) => void"}},morphTargetDictionary:{defaultValue:null,description:"",name:"morphTargetDictionary",required:!0,type:{name:"{ [key: string]: number; }"}},modifyTimeScale:{defaultValue:null,description:"",name:"modifyTimeScale",required:!0,type:{name:"(value: number) => void"}},timeScale:{defaultValue:null,description:"",name:"timeScale",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/components/controls.tsx#controls"]={docgenInfo:controls.__docgenInfo,name:"controls",path:"src/components/Avatar/AvatarView/AvatarComponent/components/controls.tsx#controls"})}catch(__react_docgen_typescript_loader_error){}var three_module=__webpack_require__("./node_modules/three/build/three.module.js"),useGLTF=__webpack_require__("./node_modules/@react-three/drei/core/useGLTF.js"),useAnimations=__webpack_require__("./node_modules/@react-three/drei/core/useAnimations.js");let AnimationState=function(AnimationState){return AnimationState.LOADING="LOADING",AnimationState.EMOTION="EMOTION",AnimationState.IDLE="IDLE",AnimationState}({});const AVATAR_POSITION=new three_module.Vector3(0,-1,0),AVATAR_ROTATION=new three_module.Euler(.175,0,0),AVATAR_POSITION_ZOOMED=new three_module.Vector3(0,-1.45,0),SCALE_LERP_FACTOR=.1,BASE_ACTIONS={Gioia1:{weight:0},Gioia2:{weight:0},Gioia3:{weight:0},Idle1:{weight:1},Idle2:{weight:0},Idle3:{weight:0},Idle4:{weight:0},Idle5:{weight:0},Rabbia1:{weight:0},Rabbia2:{weight:0},Rabbia3:{weight:0},Sorpresa1:{weight:0},Sorpresa2:{weight:0},Sorpresa3:{weight:0},Timore1:{weight:0},Timore2:{weight:0},Timore3:{weight:0},Tristezza1:{weight:0},Tristezza2:{weight:0},Tristezza3:{weight:0},Loading1:{weight:0},Loading2:{weight:0},Loading3:{weight:0}},MAPPING_BLEND_SHAPE_TO_EMOTION_RPM={Rabbia:{browDownLeft:.5,browDownRight:.5,browOuterUpLeft:.5,browOuterUpRight:.5,mouthSmile:-.2},Timore:{browOuterUpLeft:-.5,browOuterUpRight:-.5,eyeWideLeft:-.5,eyeWideRight:-.5},Tristezza:{browDownLeft:-.5,browDownRight:-.5,eyeSquintLeft:.5,eyeSquintRight:.5,mouthSmile:-.6},Sorpresa:{browInnerUp:.5,browOuterUpLeft:.5,browOuterUpRight:.5,eyeWideLeft:.5,eyeWideRight:.5},Gioia:{browDownLeft:.5,browDownRight:.5,browInnerUp:.5,mouthSmile:.8}},MAPPING_BLEND_SHAPE_TO_EMOTION_CUSTOM_GLB={Gioia:"Joy",Rabbia:"Anger",Sorpresa:"Surprise",Tristezza:"Sadness",Timore:"Fear"},ANIMATION_URLS={MALE:"https://assets.memori.ai/api/v2/asset/2c5e88a4-cf62-408b-9ef0-518b099dfcb2.glb",FEMALE:"https://assets.memori.ai/api/v2/asset/2adc934b-24b2-45bd-94ad-ffec58d3cb32.glb"},BLINK_CONFIG_minInterval=1e3,BLINK_CONFIG_maxInterval=5e3,BLINK_CONFIG_blinkDuration=150,DEFAULT_CONFIG={fadeInDuration:.8,fadeOutDuration:.8,idleCount:5,timeScale:1};class AnimationController{currentState=AnimationState.LOADING;currentAction=null;lastIdleIndex=-1;isTransitioning=!1;currentIdleLoopCount=0;MAX_IDLE_LOOPS=5;lastAnimationTime=0;isChatAlreadyStarted=!1;constructor(mixer,actions,config=DEFAULT_CONFIG){this.mixer=mixer,this.actions=actions,this.config=config}checkForLoop(){if(!this.currentAction||this.currentState!==AnimationState.IDLE)return;this.currentAction.getClip();const currentTime=this.currentAction.time;currentTime<this.lastAnimationTime&&(this.currentIdleLoopCount++,this.currentIdleLoopCount>=this.MAX_IDLE_LOOPS&&this.forceIdleChange()),this.lastAnimationTime=currentTime}forceIdleChange(){this.currentIdleLoopCount=0,this.lastAnimationTime=0,this.transitionTo(AnimationState.IDLE)}getNextIdleAnimation(){let nextIndex;do{nextIndex=Math.floor(Math.random()*this.config.idleCount)+1}while(nextIndex===this.lastIdleIndex);this.isChatAlreadyStarted&&3===nextIndex&&(nextIndex=4!==this.lastIdleIndex?4:2),this.lastIdleIndex=nextIndex;const idleAction=this.actions[`Idle${nextIndex}`];if(!idleAction)throw new Error(`Idle animation ${nextIndex} not found`);return idleAction}transitionTo(state,emotionName){if(!this.isTransitioning){this.isTransitioning=!0;try{let nextAction=null;switch(state){case AnimationState.LOADING:nextAction=this.actions[emotionName||"Loading1"],this.currentIdleLoopCount=0,this.lastAnimationTime=0;break;case AnimationState.EMOTION:nextAction=this.actions[emotionName||"Timore1"],this.currentIdleLoopCount=0,this.lastAnimationTime=0;break;case AnimationState.IDLE:nextAction=this.getNextIdleAnimation(),this.currentState!==AnimationState.IDLE&&(this.currentIdleLoopCount=0,this.lastAnimationTime=0)}if(!nextAction)throw new Error(`No animation found for state: ${state}`);this.currentAction&&this.currentAction.fadeOut(this.config.fadeOutDuration),nextAction.reset().fadeIn(this.config.fadeInDuration).play(),nextAction.timeScale=this.config.timeScale,state!==AnimationState.IDLE?(nextAction.setLoop(three_module.LoopOnce,1),nextAction.clampWhenFinished=!0):nextAction.setLoop(1/0,1/0),this.currentAction=nextAction,this.currentState=state}catch(error){console.error("[AnimationController] Error during animation transition:",error),state!==AnimationState.IDLE&&this.transitionTo(AnimationState.IDLE)}finally{this.isTransitioning=!1}}}update(delta){this.currentAction&&(this.checkForLoop(),this.currentState!==AnimationState.IDLE&&this.currentAction.time>=.9*this.currentAction.getClip().duration&&this.transitionTo(AnimationState.IDLE),this.mixer.update(delta))}getCurrentState(){return this.currentState}getLoopCount(){return this.currentIdleLoopCount}setTimeScale(timeScale){this.config.timeScale=timeScale,this.currentAction&&(this.currentAction.timeScale=timeScale)}updateIsChatAlreadyStarted(isChatAlreadyStarted){this.isChatAlreadyStarted=isChatAlreadyStarted}getDebugInfo(){return{currentState:this.currentState,currentIdleIndex:this.lastIdleIndex,loopCount:this.currentIdleLoopCount,currentTime:this.currentAction?.time||0,lastTime:this.lastAnimationTime,isTransitioning:this.isTransitioning,isChatAlreadyStarted:this.isChatAlreadyStarted}}}class MorphTargetController{currentEmotionValues={};previousEmotionKeys=new Set;constructor(headMesh){this.headMesh=headMesh}updateMorphTargets(currentTime,emotionMorphTargets,currentViseme,eyeBlink,blinkState){if(!this.headMesh.morphTargetDictionary||!this.headMesh.morphTargetInfluences)return void console.error("[MorphTargetController] Missing morphTargetDictionary or morphTargetInfluences");const blinkValue=this.calculateBlinkValue(currentTime,blinkState,eyeBlink),currentEmotionKeys=new Set(Object.keys(emotionMorphTargets));Object.entries(this.headMesh.morphTargetDictionary).forEach((([key,index])=>{if("number"!=typeof index)return;let targetValue=0;if(currentEmotionKeys.has(key)){const targetEmotionValue=emotionMorphTargets[key],currentEmotionValue=this.currentEmotionValues[key]||0,newEmotionValue=three_module.MathUtils.lerp(currentEmotionValue,3*targetEmotionValue,.3);console.log(`[MorphTargetController] Emotion ${key}: current=${currentEmotionValue}, target=${targetEmotionValue}, new=${newEmotionValue}`),this.currentEmotionValues[key]=newEmotionValue,targetValue+=newEmotionValue}if(currentViseme&&key===currentViseme.name&&(targetValue+=currentViseme.weight),"eyesClosed"===key&&eyeBlink&&(targetValue+=blinkValue),targetValue=three_module.MathUtils.clamp(targetValue,0,1),this.headMesh.morphTargetInfluences){const finalValue=three_module.MathUtils.lerp(this.headMesh.morphTargetInfluences[index]||0,targetValue,.5);this.headMesh.morphTargetInfluences[index]=finalValue}})),this.previousEmotionKeys=currentEmotionKeys}calculateBlinkValue(currentTime,blinkState,eyeBlink){if(!eyeBlink)return 0;let blinkValue=0;if(currentTime>=blinkState.nextBlinkTime&&!blinkState.isBlinking&&(blinkState.isBlinking=!0,blinkState.blinkStartTime=currentTime,blinkState.lastBlinkTime=currentTime,blinkState.nextBlinkTime=currentTime+Math.random()*(BLINK_CONFIG_maxInterval-BLINK_CONFIG_minInterval)+BLINK_CONFIG_minInterval),blinkState.isBlinking){const blinkProgress=(currentTime-blinkState.blinkStartTime)/BLINK_CONFIG_blinkDuration;blinkProgress<=.5?blinkValue=2*blinkProgress:blinkProgress<=1?blinkValue=2-2*blinkProgress:(blinkState.isBlinking=!1,blinkValue=0)}return blinkValue}}class AvatarPositionController{constructor(defaultPosition=AVATAR_POSITION.clone(),zoomedPosition=AVATAR_POSITION_ZOOMED.clone(),initialCameraZ=.6){this.defaultPosition=defaultPosition,this.zoomedPosition=zoomedPosition,this.currentScale=new three_module.Vector3(1,1,1),this.targetScale=new three_module.Vector3(1,1,1),this.currentPosition=defaultPosition.clone(),this.basePosition=defaultPosition.clone(),this.initialCameraPosition=new three_module.Vector3(0,0,initialCameraZ)}mapHeightToScale(sliderValue,isHalfBody){return isHalfBody?three_module.MathUtils.lerp(1.4,2.1,sliderValue/100):three_module.MathUtils.lerp(.5,1.5,sliderValue/100)}mapDepthToCamera(depthValue,isHalfBody){const baseZ=this.initialCameraPosition.z;return three_module.MathUtils.lerp(baseZ,baseZ+3,depthValue/100)}updateHeight(heightValue,isHalfBody){const heightScale=this.mapHeightToScale(heightValue,isHalfBody);this.targetScale.set(heightScale,heightScale,heightScale)}updateDepth(depthValue,isHalfBody){return this.mapDepthToCamera(depthValue,isHalfBody)}updateBasePosition(isZoomed){const newPosition=isZoomed?this.zoomedPosition:this.defaultPosition;this.basePosition.copy(newPosition),this.currentPosition.copy(newPosition)}updateScale(lerpFactor){return this.currentScale.lerp(this.targetScale,lerpFactor),this.currentScale}getPosition(){return this.currentPosition}reset(){this.currentScale.set(1,1,1),this.targetScale.set(1,1,1),this.currentPosition.copy(this.defaultPosition),this.basePosition.copy(this.defaultPosition)}}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function FullbodyAvatar({url,sex,setIsRpm,currentBaseAction,timeScale,eyeBlink,updateCurrentViseme,setMorphTargetDictionary,setMorphTargetInfluences,emotionMorphTargets,avatarHeight=50,avatarDepth=0,onCameraZChange}){const{scene}=(0,useGLTF.L)(url),{animations}=(0,useGLTF.L)(ANIMATION_URLS[sex]),{actions}=(0,useAnimations.v)(animations,scene),animationControllerRef=(0,react.useRef)(),morphTargetControllerRef=(0,react.useRef)(),positionControllerRef=(0,react.useRef)(),blinkStateRef=(0,react.useRef)({isBlinking:!1,lastBlinkTime:0,nextBlinkTime:0,blinkStartTime:0});(0,react.useEffect)((()=>{if(positionControllerRef.current||(positionControllerRef.current=new AvatarPositionController(AVATAR_POSITION)),!actions||!scene)return;const mixer=new three_module.AnimationMixer(scene);if(animationControllerRef.current=new AnimationController(mixer,actions,{...DEFAULT_CONFIG}),headMesh&&(morphTargetControllerRef.current=new MorphTargetController(headMesh),headMesh.morphTargetDictionary&&headMesh.morphTargetInfluences)){setMorphTargetDictionary(headMesh.morphTargetDictionary);const initialInfluences=Object.keys(headMesh.morphTargetDictionary).reduce(((acc,key)=>({...acc,[key]:0})),{});setMorphTargetInfluences(initialInfluences)}}),[actions,scene]),(0,react.useEffect)((()=>{positionControllerRef.current&&positionControllerRef.current.updateHeight(avatarHeight,!1)}),[avatarHeight]),(0,react.useEffect)((()=>{if(positionControllerRef.current&&onCameraZChange){const newCameraZ=positionControllerRef.current.updateDepth(avatarDepth,!1);onCameraZChange(newCameraZ)}}),[avatarDepth,onCameraZChange]);const headMesh=(0,react.useMemo)((()=>{let foundMesh;return scene?.traverse((object=>{object instanceof three_module.SkinnedMesh&&("GBNL__Head"===object.name||"Wolf3D_Avatar"===object.name)&&("GBNL__Head"===object.name?setIsRpm(!1):setIsRpm(!0),foundMesh=object)})),foundMesh}),[scene]);(0,react.useEffect)((()=>{if(!actions||!headMesh)return;const mixer=new three_module.AnimationMixer(scene);if(animationControllerRef.current=new AnimationController(mixer,actions,{...DEFAULT_CONFIG}),morphTargetControllerRef.current=new MorphTargetController(headMesh),headMesh.morphTargetDictionary&&headMesh.morphTargetInfluences){setMorphTargetDictionary(headMesh.morphTargetDictionary);const initialInfluences=Object.keys(headMesh.morphTargetDictionary).reduce(((acc,key)=>({...acc,[key]:0})),{});setMorphTargetInfluences(initialInfluences)}}),[actions,headMesh,scene,setMorphTargetDictionary,setMorphTargetInfluences,timeScale]),(0,react.useEffect)((()=>{animationControllerRef.current&&(currentBaseAction.action.startsWith("Loading")?(animationControllerRef.current.updateIsChatAlreadyStarted(!0),animationControllerRef.current.transitionTo(AnimationState.LOADING,currentBaseAction.action)):currentBaseAction.action.startsWith("Idle")?animationControllerRef.current.transitionTo(AnimationState.IDLE):animationControllerRef.current.transitionTo(AnimationState.EMOTION,currentBaseAction.action))}),[currentBaseAction]),(0,react.useEffect)((()=>{animationControllerRef.current?.setTimeScale(timeScale)}),[timeScale]),(0,react_three_fiber_esm.xQ)(((state,delta)=>{const currentTime=1e3*state.clock.elapsedTime;if(animationControllerRef.current?.update(delta),morphTargetControllerRef.current){const currentViseme=updateCurrentViseme(currentTime/1e3);morphTargetControllerRef.current.updateMorphTargets(currentTime,emotionMorphTargets,currentViseme,eyeBlink||!1,blinkStateRef.current)}if(scene&&positionControllerRef.current){const newScale=positionControllerRef.current.updateScale(SCALE_LERP_FACTOR);scene.scale.copy(newScale)}}));const position=positionControllerRef.current?.getPosition()||AVATAR_POSITION;return(0,jsx_runtime.jsx)("group",{position,rotation:AVATAR_ROTATION,children:(0,jsx_runtime.jsx)("primitive",{object:scene})})}FullbodyAvatar.displayName="FullbodyAvatar";try{FullbodyAvatar.displayName="FullbodyAvatar",FullbodyAvatar.__docgenInfo={description:"",displayName:"FullbodyAvatar",props:{url:{defaultValue:null,description:"",name:"url",required:!0,type:{name:"string"}},sex:{defaultValue:null,description:"",name:"sex",required:!0,type:{name:"enum",value:[{value:'"MALE"'},{value:'"FEMALE"'}]}},setIsRpm:{defaultValue:null,description:"",name:"setIsRpm",required:!0,type:{name:"(value: boolean) => void"}},onLoaded:{defaultValue:null,description:"",name:"onLoaded",required:!1,type:{name:"(() => void)"}},currentBaseAction:{defaultValue:null,description:"",name:"currentBaseAction",required:!0,type:{name:"{ action: string; weight: number; }"}},timeScale:{defaultValue:null,description:"",name:"timeScale",required:!0,type:{name:"number"}},onCameraZChange:{defaultValue:null,description:"",name:"onCameraZChange",required:!0,type:{name:"(value: number) => void"}},eyeBlink:{defaultValue:null,description:"",name:"eyeBlink",required:!1,type:{name:"boolean"}},avatarDepth:{defaultValue:{value:"0"},description:"",name:"avatarDepth",required:!1,type:{name:"number"}},avatarHeight:{defaultValue:{value:"50"},description:"",name:"avatarHeight",required:!1,type:{name:"number"}},stopProcessing:{defaultValue:null,description:"",name:"stopProcessing",required:!0,type:{name:"() => void"}},resetVisemeQueue:{defaultValue:null,description:"",name:"resetVisemeQueue",required:!0,type:{name:"() => void"}},updateCurrentViseme:{defaultValue:null,description:"",name:"updateCurrentViseme",required:!0,type:{name:"(currentTime: number) => { name: string; weight: number; } | null"}},smoothMorphTarget:{defaultValue:null,description:"",name:"smoothMorphTarget",required:!1,type:{name:"boolean"}},morphTargetSmoothing:{defaultValue:null,description:"",name:"morphTargetSmoothing",required:!1,type:{name:"number"}},morphTargetInfluences:{defaultValue:null,description:"",name:"morphTargetInfluences",required:!0,type:{name:"Record<string, number>"}},setMorphTargetDictionary:{defaultValue:null,description:"",name:"setMorphTargetDictionary",required:!0,type:{name:"(morphTargetDictionary: Record<string, number>) => void"}},setMorphTargetInfluences:{defaultValue:null,description:"",name:"setMorphTargetInfluences",required:!0,type:{name:"(morphTargetInfluences: Record<string, number>) => void"}},emotionMorphTargets:{defaultValue:null,description:"",name:"emotionMorphTargets",required:!0,type:{name:"Record<string, number>"}},halfBody:{defaultValue:null,description:"",name:"halfBody",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/components/FullbodyAvatar/fullbodyAvatar.tsx#FullbodyAvatar"]={docgenInfo:FullbodyAvatar.__docgenInfo,name:"FullbodyAvatar",path:"src/components/Avatar/AvatarView/AvatarComponent/components/FullbodyAvatar/fullbodyAvatar.tsx#FullbodyAvatar"})}catch(__react_docgen_typescript_loader_error){}const lerp=(start,end,time=.05)=>start*(1-time)+end*time,mapRange=(value,inMin,inMax,outMin,outMax)=>((value=((value,min,max)=>Math.min(Math.max(value,min),max))(value,inMin,inMax))-inMin)*(outMax-outMin)/(inMax-inMin)+outMin,rad=Math.PI/180;let timeout,useHeadMovement_reset=!1;const targetPos=new three_module.Vector2(0,0),currentPos=new three_module.Vector2(0,0),setResetTrue=()=>{timeout=setTimeout((()=>{useHeadMovement_reset=!0}),1e3)},setResetFalse=()=>{clearTimeout(timeout),useHeadMovement_reset=!1};function HalfBodyAvatar({url,setMorphTargetInfluences,setMorphTargetDictionary,updateCurrentViseme,eyeBlink=!1,avatarHeight=50,avatarDepth=0,headMovement=!1,onLoaded,onCameraZChange}){const{scene}=(0,useGLTF.L)(url),{nodes,materials}=(0,react_three_fiber_esm.n4)(scene),{camera}=(0,react_three_fiber_esm.Ky)(),morphTargetControllerRef=(0,react.useRef)(),positionControllerRef=(0,react.useRef)();(0,react.useRef)(camera.position.z);!function useHeadMovement(enabled,nodes){const{gl}=(0,react_three_fiber_esm.Ky)();(0,react.useEffect)((()=>{if(enabled)return gl.domElement.addEventListener("mouseleave",setResetTrue),gl.domElement.addEventListener("mouseenter",setResetFalse),()=>{gl.domElement.removeEventListener("mouseleave",setResetTrue),gl.domElement.removeEventListener("mouseenter",setResetFalse)}}),[gl.domElement,enabled]),(0,react_three_fiber_esm.xQ)((state=>{if(!enabled||!nodes?.Neck||!nodes?.Head)return;const cameraRotation=Math.abs(state.camera.rotation.z);!useHeadMovement_reset&&cameraRotation<.2?(targetPos.x=mapRange(state.mouse.y,-1,1,5*rad,-5*rad),targetPos.y=mapRange(state.mouse.x,-1,1,-10*rad,10*rad)):targetPos.set(0,0),currentPos.x=lerp(currentPos.x,targetPos.x),currentPos.y=lerp(currentPos.y,targetPos.y),nodes.Neck.rotation.x=currentPos.x+.1,nodes.Neck.rotation.y=currentPos.y,nodes.Head.rotation.x=2*currentPos.x,nodes.Head.rotation.y=2*currentPos.y}))}(headMovement,nodes);const blinkStateRef=(0,react.useRef)({isBlinking:!1,lastBlinkTime:0,nextBlinkTime:0,blinkStartTime:0}),headMesh=(0,react.useMemo)((()=>{let foundMesh;return scene?.traverse((object=>{object instanceof three_module.SkinnedMesh&&("GBNL__Head"===object.name||"Wolf3D_Avatar"===object.name)&&(foundMesh=object)})),foundMesh}),[scene]);(0,react.useEffect)((()=>{if(positionControllerRef.current||(positionControllerRef.current=new AvatarPositionController(AVATAR_POSITION,AVATAR_POSITION_ZOOMED)),headMesh&&(morphTargetControllerRef.current=new MorphTargetController(headMesh),headMesh.morphTargetDictionary&&headMesh.morphTargetInfluences)){setMorphTargetDictionary(headMesh.morphTargetDictionary);const initialInfluences=Object.keys(headMesh.morphTargetDictionary).reduce(((acc,key)=>({...acc,[key]:0})),{});setMorphTargetInfluences(initialInfluences)}return(0,utils.lc)(materials),onLoaded?.(),(nodes=>{nodes.Wolf3D_Hands&&(nodes.Wolf3D_Hands.visible=!1),nodes.RightHand&&nodes.LeftHand&&(nodes.RightHand.position.set(0,-2,0),nodes.LeftHand.position.set(0,-2,0))})(nodes),()=>{Object.values(materials).forEach((material=>material.dispose())),Object.values(nodes).filter(utils.Av).forEach((mesh=>mesh.geometry.dispose()))}}),[materials,nodes,url,onLoaded,scene,headMesh]),(0,react.useEffect)((()=>{positionControllerRef.current&&positionControllerRef.current.updateHeight(avatarHeight,!0)}),[avatarHeight]),(0,react.useEffect)((()=>{if(positionControllerRef.current&&onCameraZChange){const newCameraZ=positionControllerRef.current.updateDepth(avatarDepth,!0);onCameraZChange(newCameraZ)}}),[avatarDepth,onCameraZChange]),(0,react_three_fiber_esm.xQ)((state=>{const currentTime=1e3*state.clock.elapsedTime;if(morphTargetControllerRef.current){const currentViseme=updateCurrentViseme(currentTime/1e3);morphTargetControllerRef.current.updateMorphTargets(currentTime,{},currentViseme,eyeBlink,blinkStateRef.current)}if(scene&&positionControllerRef.current){const newScale=positionControllerRef.current.updateScale(SCALE_LERP_FACTOR);scene.scale.copy(newScale)}}));const position=positionControllerRef.current?.getPosition()||AVATAR_POSITION;return(0,jsx_runtime.jsx)("group",{position,children:(0,jsx_runtime.jsx)("primitive",{object:scene})})}HalfBodyAvatar.displayName="HalfBodyAvatar";try{halfbodyAvatar.displayName="halfbodyAvatar",halfbodyAvatar.__docgenInfo={description:"",displayName:"halfbodyAvatar",props:{url:{defaultValue:null,description:"",name:"url",required:!0,type:{name:"string"}},setMorphTargetInfluences:{defaultValue:null,description:"",name:"setMorphTargetInfluences",required:!0,type:{name:"(morphTargetInfluences: any) => void"}},setMorphTargetDictionary:{defaultValue:null,description:"",name:"setMorphTargetDictionary",required:!0,type:{name:"(morphTargetDictionary: any) => void"}},updateCurrentViseme:{defaultValue:null,description:"",name:"updateCurrentViseme",required:!0,type:{name:"(currentTime: number) => any"}},eyeBlink:{defaultValue:{value:"false"},description:"",name:"eyeBlink",required:!1,type:{name:"boolean"}},heightValue:{defaultValue:null,description:"",name:"heightValue",required:!1,type:{name:"number"}},avatarHeight:{defaultValue:{value:"50"},description:"",name:"avatarHeight",required:!1,type:{name:"number"}},avatarDepth:{defaultValue:{value:"0"},description:"",name:"avatarDepth",required:!1,type:{name:"number"}},onLoaded:{defaultValue:null,description:"",name:"onLoaded",required:!1,type:{name:"(() => void)"}},onCameraZChange:{defaultValue:null,description:"",name:"onCameraZChange",required:!0,type:{name:"(value: number) => void"}},headMovement:{defaultValue:{value:"false"},description:"",name:"headMovement",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/components/halfbodyAvatar.tsx#halfbodyAvatar"]={docgenInfo:halfbodyAvatar.__docgenInfo,name:"halfbodyAvatar",path:"src/components/Avatar/AvatarView/AvatarComponent/components/halfbodyAvatar.tsx#halfbodyAvatar"})}catch(__react_docgen_typescript_loader_error){}const avatarComponent_AvatarView=({stopProcessing,chatEmission,showControls,animation,url,sex,eyeBlink,headMovement,halfBody,loading,avatarHeight=50,avatarDepth=-50,updateCurrentViseme,resetVisemeQueue,setCameraZ})=>{const[currentBaseAction,setCurrentBaseAction]=(0,react.useState)({action:animation||"Idle1",weight:1}),[morphTargetInfluences,setMorphTargetInfluences]=(0,react.useState)({}),[morphTargetDictionary,setMorphTargetDictionary]=(0,react.useState)({}),[emotionMorphTargets,setEmotionMorphTargets]=(0,react.useState)({}),[isRPM,setIsRPM]=(0,react.useState)(!1),[timeScale,setTimeScale]=(0,react.useState)(.8),emotionMap={Joy:{Joy:1},Anger:{Anger:1},Surprise:{Surprise:1},Sadness:{Sadness:1},Fear:{Fear:1}},handleRPMBlendShape=(0,react.useCallback)((outputContent=>MAPPING_BLEND_SHAPE_TO_EMOTION_RPM[outputContent]),[]),handleCustomGLBBlendShape=(0,react.useCallback)((outputContent=>MAPPING_BLEND_SHAPE_TO_EMOTION_CUSTOM_GLB[outputContent]),[]),setEmotionMorphTargetInfluences=(0,react.useCallback)(((action,outputContent)=>{if(action.startsWith("Loading"))return;const defaultEmotions=Object.keys(emotionMap).reduce(((acc,key)=>({...acc,[key]:0})),{});if("default"!==outputContent)if(isRPM){const emotion=handleRPMBlendShape(outputContent);setEmotionMorphTargets((_=>({...defaultEmotions,...emotion})))}else{const emotion=handleCustomGLBBlendShape(outputContent),emotionValues="default"===emotion?defaultEmotions:emotionMap[emotion];setEmotionMorphTargets((_=>({...defaultEmotions,...emotionValues})))}else setEmotionMorphTargets(defaultEmotions)}),[isRPM,handleRPMBlendShape,handleCustomGLBBlendShape]),onBaseActionChange=(0,react.useCallback)(((action,outputContent)=>{setEmotionMorphTargetInfluences(action,outputContent),setCurrentBaseAction({action,weight:1})}),[setEmotionMorphTargetInfluences]),onMorphTargetInfluencesChange=(0,react.useCallback)((influences=>{setMorphTargetInfluences((prev=>({...prev,...influences})))}),[]),onMorphTargetDictionaryChange=(0,react.useCallback)((dictionary=>{setMorphTargetDictionary(dictionary)}),[]);(0,react.useEffect)((()=>{if(loading){const randomNumber=Math.floor(3*Math.random())+1;return void onBaseActionChange(`Loading${randomNumber}`,"")}const hasOutputTag=chatEmission?.includes('<output class="memori-emotion">'),outputContent=hasOutputTag?chatEmission?.split('<output class="memori-emotion">')[1]?.split("</output>")[0]?.trim():null;if(outputContent){const randomNumber=Math.floor(3*Math.random())+1;onBaseActionChange(`${outputContent}${randomNumber}`,outputContent)}else{const randomNumber=Math.floor(5*Math.random())+1;onBaseActionChange(`Idle${3===randomNumber?4:randomNumber}`,"")}}),[chatEmission,loading,onBaseActionChange]);const commonAvatarProps={url,onCameraZChange:setCameraZ,setMorphTargetInfluences,setMorphTargetDictionary,updateCurrentViseme,avatarHeight,avatarDepth};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[showControls&&(0,jsx_runtime.jsx)(components_controls,{timeScale,morphTargetDictionary,onBaseActionChange,onMorphTargetInfluencesChange,onMorphTargetDictionaryChange,baseActions:BASE_ACTIONS,currentBaseAction,modifyTimeScale:setTimeScale}),halfBody?(0,jsx_runtime.jsx)(HalfBodyAvatar,{...commonAvatarProps,headMovement}):(0,jsx_runtime.jsx)(FullbodyAvatar,{...commonAvatarProps,sex,setIsRpm:setIsRPM,resetVisemeQueue,eyeBlink,currentBaseAction,timeScale,morphTargetInfluences,stopProcessing,emotionMorphTargets,halfBody})]})};try{avatarComponent_AvatarView.displayName="AvatarView",avatarComponent_AvatarView.__docgenInfo={description:"AvatarView Component\nRenders either a full body or half body 3D avatar with animations and morphing capabilities",displayName:"AvatarView",props:{showControls:{defaultValue:null,description:"",name:"showControls",required:!0,type:{name:"boolean"}},animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:"string"}},loading:{defaultValue:null,description:"",name:"loading",required:!0,type:{name:"boolean"}},url:{defaultValue:null,description:"",name:"url",required:!0,type:{name:"string"}},sex:{defaultValue:null,description:"",name:"sex",required:!0,type:{name:"enum",value:[{value:'"MALE"'},{value:'"FEMALE"'}]}},eyeBlink:{defaultValue:null,description:"",name:"eyeBlink",required:!0,type:{name:"boolean"}},headMovement:{defaultValue:null,description:"",name:"headMovement",required:!0,type:{name:"boolean"}},speaking:{defaultValue:null,description:"",name:"speaking",required:!0,type:{name:"boolean"}},isZoomed:{defaultValue:null,description:"",name:"isZoomed",required:!0,type:{name:"boolean"}},chatEmission:{defaultValue:null,description:"",name:"chatEmission",required:!0,type:{name:"any"}},avatarHeight:{defaultValue:{value:"50"},description:"",name:"avatarHeight",required:!1,type:{name:"number"}},avatarDepth:{defaultValue:{value:"-50"},description:"",name:"avatarDepth",required:!1,type:{name:"number"}},stopProcessing:{defaultValue:null,description:"",name:"stopProcessing",required:!0,type:{name:"() => void"}},resetVisemeQueue:{defaultValue:null,description:"",name:"resetVisemeQueue",required:!0,type:{name:"() => void"}},updateCurrentViseme:{defaultValue:null,description:"",name:"updateCurrentViseme",required:!0,type:{name:"(currentTime: number) => { name: string; weight: number; } | null"}},setCameraZ:{defaultValue:null,description:"",name:"setCameraZ",required:!0,type:{name:"(value: number) => void"}},halfBody:{defaultValue:null,description:"",name:"halfBody",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/avatarComponent.tsx#AvatarView"]={docgenInfo:avatarComponent_AvatarView.__docgenInfo,name:"AvatarView",path:"src/components/Avatar/AvatarView/AvatarComponent/avatarComponent.tsx#AvatarView"})}catch(__react_docgen_typescript_loader_error){}var configuration=__webpack_require__("./src/helpers/configuration.ts"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),Slider=__webpack_require__("./src/components/ui/Slider.tsx"),Button=__webpack_require__("./src/components/ui/Button.tsx"),Close=__webpack_require__("./src/components/icons/Close.tsx");const PositionControls=({avatarHeight,avatarDepth,setAvatarHeight,setAvatarDepth,halfBody,setEnablePositionControls})=>{const normalPosition=halfBody?{height:80,depth:50}:{height:25,depth:25},zoomedPosition=halfBody?{height:55,depth:10}:{height:15,depth:5},farPosition=halfBody?{height:100,depth:80}:{height:65,depth:100},settingsRef=(0,react.useRef)({height:avatarHeight,depth:avatarDepth,zoomed:!1,normal:!1,far:!1}),{t}=(0,useTranslation.$)();return(0,react.useEffect)((()=>{settingsRef.current.height=avatarHeight,settingsRef.current.depth=avatarDepth}),[avatarHeight,avatarDepth]),(0,react.useEffect)((()=>{const handleKeyDown=event=>{if("-"===event.key||"_"===event.key&&settingsRef.current.depth<100){const newValue=Math.min(settingsRef.current.depth+10,100);setAvatarDepth(newValue),(0,configuration.A2)("avatarDepth",newValue)}else if(("+"===event.key||"="===event.key)&&settingsRef.current.depth>-100){const newValue=Math.max(settingsRef.current.depth-10,-100);setAvatarDepth(newValue),(0,configuration.A2)("avatarDepth",newValue)}};return window.addEventListener("keydown",handleKeyDown),()=>{window.removeEventListener("keydown",handleKeyDown)}}),[setAvatarDepth]),(0,react.useEffect)((()=>{const handleArrowUp=event=>{if("ArrowUp"===event.key&&settingsRef.current.height<100){const newValue=settingsRef.current.height+5;setAvatarHeight(newValue),(0,configuration.A2)("avatarHeight",newValue)}},handleArrowDown=event=>{if("ArrowDown"===event.key&&settingsRef.current.height>0){const newValue=settingsRef.current.height-5;setAvatarHeight(newValue),(0,configuration.A2)("avatarHeight",newValue)}};return window.addEventListener("keydown",handleArrowUp),window.addEventListener("keydown",handleArrowDown),()=>{window.removeEventListener("keydown",handleArrowUp),window.removeEventListener("keydown",handleArrowDown)}}),[setAvatarHeight]),(0,jsx_runtime.jsxs)("div",{className:"memori--position-controls",children:[(0,jsx_runtime.jsx)("div",{className:"memori--position-controls-close",children:(0,jsx_runtime.jsx)(Button.Z,{ghost:!0,icon:(0,jsx_runtime.jsx)(Close.default,{}),outlined:!0,danger:!0,shape:"circle",className:"memori--position-controls-close-button",onClick:()=>{setEnablePositionControls(!1)}})}),(0,jsx_runtime.jsx)("div",{className:"memori--slider-container",children:(0,jsx_runtime.jsx)(Slider.Z,{defaultValue:settingsRef.current.height,min:.5,max:100,label:(0,jsx_runtime.jsx)("label",{className:"memori--slider-label",children:t("write_and_speak.height")}),step:1,onChange:value=>{setAvatarHeight(value),(0,configuration.A2)("avatarHeight",value)}})}),(0,jsx_runtime.jsx)("div",{className:"memori--slider-container",children:(0,jsx_runtime.jsx)(Slider.Z,{defaultValue:settingsRef.current.depth,min:.5,max:100,step:5,label:(0,jsx_runtime.jsx)("label",{className:"memori--slider-label",children:t("write_and_speak.depth")}),onChange:value=>{setAvatarDepth(value),(0,configuration.A2)("avatarDepth",value)}})}),(0,jsx_runtime.jsxs)("div",{className:"memori--preset-buttons",children:[(0,jsx_runtime.jsx)(Button.Z,{outlined:!0,isActive:avatarHeight===(halfBody?zoomedPosition.height:normalPosition.height)&&avatarDepth===(halfBody?zoomedPosition.depth:normalPosition.depth),onClick:()=>{setAvatarHeight(zoomedPosition.height),setAvatarDepth(zoomedPosition.depth),(0,configuration.A2)("avatarHeight",zoomedPosition.height),(0,configuration.A2)("avatarDepth",zoomedPosition.depth)},children:t("write_and_speak.zoomed")}),(0,jsx_runtime.jsx)(Button.Z,{outlined:!0,isActive:avatarHeight===(halfBody?normalPosition.height:zoomedPosition.height)&&avatarDepth===(halfBody?normalPosition.depth:zoomedPosition.depth),onClick:()=>{setAvatarHeight(normalPosition.height),setAvatarDepth(normalPosition.depth),(0,configuration.A2)("avatarHeight",normalPosition.height),(0,configuration.A2)("avatarDepth",normalPosition.depth)},children:t("write_and_speak.normal")}),(0,jsx_runtime.jsx)(Button.Z,{outlined:!0,isActive:avatarHeight===(halfBody?farPosition.height:normalPosition.height)&&avatarDepth===(halfBody?farPosition.depth:normalPosition.depth),onClick:()=>{setAvatarHeight(farPosition.height),setAvatarDepth(farPosition.depth),(0,configuration.A2)("avatarHeight",farPosition.height),(0,configuration.A2)("avatarDepth",farPosition.depth)},children:t("write_and_speak.far")})]})]})};PositionControls.displayName="PositionControls";const positionControls_positionControls=PositionControls;try{positionControls.displayName="positionControls",positionControls.__docgenInfo={description:"",displayName:"positionControls",props:{avatarHeight:{defaultValue:null,description:"",name:"avatarHeight",required:!0,type:{name:"number"}},avatarDepth:{defaultValue:null,description:"",name:"avatarDepth",required:!0,type:{name:"number"}},halfBody:{defaultValue:null,description:"",name:"halfBody",required:!0,type:{name:"boolean"}},setAvatarHeight:{defaultValue:null,description:"",name:"setAvatarHeight",required:!0,type:{name:"(value: number) => void"}},setAvatarDepth:{defaultValue:null,description:"",name:"setAvatarDepth",required:!0,type:{name:"(value: number) => void"}},setEnablePositionControls:{defaultValue:null,description:"",name:"setEnablePositionControls",required:!0,type:{name:"(value: boolean) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/positionControls/positionControls.tsx#positionControls"]={docgenInfo:positionControls.__docgenInfo,name:"positionControls",path:"src/components/Avatar/AvatarView/AvatarComponent/positionControls/positionControls.tsx#positionControls"})}catch(__react_docgen_typescript_loader_error){}var useProgress=__webpack_require__("./node_modules/@react-three/drei/core/useProgress.js"),Html=__webpack_require__("./node_modules/@react-three/drei/web/Html.js"),Spin=__webpack_require__("./src/components/ui/Spin.tsx");const Loader=({fallbackImg})=>{const{progress}=(0,useProgress.S)();return(0,jsx_runtime.jsx)(Html.V,{center:!0,className:"avatar-loader",children:(0,jsx_runtime.jsx)(Spin.Z,{spinning:!0,children:fallbackImg?(0,jsx_runtime.jsxs)("figure",{children:[(0,jsx_runtime.jsx)("img",{src:fallbackImg,alt:`${Math.round(progress)}% loaded`,title:`${Math.round(progress)}% loaded`}),(0,jsx_runtime.jsx)("figcaption",{children:`${Math.round(progress)}%`})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Math.round(progress)," % loaded"]})})})};Loader.displayName="Loader";const components_loader=Loader;try{loader.displayName="loader",loader.__docgenInfo={description:"",displayName:"loader",props:{fallbackImg:{defaultValue:null,description:"",name:"fallbackImg",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/components/loader.tsx#loader"]={docgenInfo:loader.__docgenInfo,name:"loader",path:"src/components/Avatar/AvatarView/AvatarComponent/components/loader.tsx#loader"})}catch(__react_docgen_typescript_loader_error){}const defaultStyles={halfBody:{width:"100%",height:"100%",minHeight:"500px",backgroundColor:"white",borderRadius:"100%"},fullBody:{width:"500px",height:"500px",backgroundColor:"white"}},getLightingComponent=()=>(0,utils.Dt)()||(0,utils.Tt)()?(0,jsx_runtime.jsx)(SpotLight.P,{distance:100,position:[-.3,.2,1.25],angle:Math.PI/2,attenuation:5,anglePower:5}):(0,jsx_runtime.jsx)(Environment.qA,{files:"https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/venice_sunset_1k.hdr"}),getCameraSettings=(halfBody,isZoomed)=>({fov:isZoomed?44:40,position:[0,0,halfBody?.6:3],target:[0,0,0]});function ContainerAvatarView({url,sex,style,rotateAvatar,eyeBlink,headMovement,speaking,fallback,fallbackImg,halfBody=!0,loading,animation,showControls=!1,isZoomed,chatEmission,stopProcessing,resetVisemeQueue,updateCurrentViseme,enablePositionControls,setEnablePositionControls,isTotem=!1}){const[cameraZ,setCameraZ]=(0,react.useState)((()=>getCameraSettings(halfBody,isZoomed||!1).position[2])),[avatarHeight,setAvatarHeight]=(0,react.useState)((()=>{if(isTotem){return(0,configuration.wm)("avatarHeight",50)}return halfBody?80:isZoomed?16:65})()),[avatarDepth,setAvatarDepth]=(0,react.useState)((()=>{if(isTotem){return(0,configuration.wm)("avatarDepth",50)}return halfBody?50:isZoomed?5:100})());return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[enablePositionControls&&(0,jsx_runtime.jsx)(positionControls_positionControls,{avatarHeight,avatarDepth,halfBody,setAvatarHeight,setAvatarDepth,setEnablePositionControls}),(0,jsx_runtime.jsxs)(react_three_fiber_esm.Xz,{style:style||defaultStyles.fullBody,children:[(0,jsx_runtime.jsx)(PerspectiveCamera.c,{makeDefault:!0,position:[0,0,cameraZ],fov:getCameraSettings(halfBody,isZoomed||!1).fov}),rotateAvatar&&(0,jsx_runtime.jsx)(OrbitControls.z,{enablePan:!1,enableZoom:!1,target:[0,0,0]}),(0,jsx_runtime.jsxs)(react.Suspense,{fallback:fallback||(0,jsx_runtime.jsx)(components_loader,{fallbackImg}),children:[getLightingComponent(),(0,jsx_runtime.jsx)(avatarComponent_AvatarView,{url,sex,showControls,loading:loading||!1,animation,isZoomed:isZoomed||!1,eyeBlink:eyeBlink||!1,headMovement:headMovement||!1,speaking:speaking||!1,halfBody,chatEmission,updateCurrentViseme,stopProcessing,resetVisemeQueue,setCameraZ,avatarHeight,avatarDepth})]})]})]})}try{AvatarView.displayName="AvatarView",AvatarView.__docgenInfo={description:"",displayName:"AvatarView",props:{url:{defaultValue:null,description:"",name:"url",required:!0,type:{name:"string"}},sex:{defaultValue:null,description:"",name:"sex",required:!0,type:{name:"enum",value:[{value:'"MALE"'},{value:'"FEMALE"'}]}},fallbackImg:{defaultValue:null,description:"",name:"fallbackImg",required:!1,type:{name:"string"}},eyeBlink:{defaultValue:null,description:"",name:"eyeBlink",required:!1,type:{name:"boolean"}},headMovement:{defaultValue:null,description:"",name:"headMovement",required:!1,type:{name:"boolean"}},rotateAvatar:{defaultValue:null,description:"",name:"rotateAvatar",required:!1,type:{name:"boolean"}},speaking:{defaultValue:null,description:"",name:"speaking",required:!1,type:{name:"boolean"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},fallback:{defaultValue:null,description:"",name:"fallback",required:!1,type:{name:"ReactNode"}},halfBody:{defaultValue:{value:"true"},description:"",name:"halfBody",required:!1,type:{name:"boolean"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:"string"}},showControls:{defaultValue:{value:"false"},description:"",name:"showControls",required:!1,type:{name:"boolean"}},isZoomed:{defaultValue:null,description:"",name:"isZoomed",required:!1,type:{name:"boolean"}},chatEmission:{defaultValue:null,description:"",name:"chatEmission",required:!1,type:{name:"any"}},enablePositionControls:{defaultValue:null,description:"",name:"enablePositionControls",required:!1,type:{name:"boolean"}},setEnablePositionControls:{defaultValue:null,description:"",name:"setEnablePositionControls",required:!0,type:{name:"(value: boolean) => void"}},isTotem:{defaultValue:{value:"false"},description:"",name:"isTotem",required:!1,type:{name:"boolean"}},setMeshRef:{defaultValue:null,description:"",name:"setMeshRef",required:!1,type:{name:"any"}},stopProcessing:{defaultValue:null,description:"",name:"stopProcessing",required:!0,type:{name:"() => void"}},resetVisemeQueue:{defaultValue:null,description:"",name:"resetVisemeQueue",required:!0,type:{name:"() => void"}},updateCurrentViseme:{defaultValue:null,description:"",name:"updateCurrentViseme",required:!0,type:{name:"(currentTime: number) => { name: string; weight: number; } | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/index.tsx#AvatarView"]={docgenInfo:AvatarView.__docgenInfo,name:"AvatarView",path:"src/components/Avatar/AvatarView/index.tsx#AvatarView"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/ui/Slider.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_headlessui_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@headlessui/react/dist/components/listbox/listbox.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const CustomSlider=({min=0,max=100,step=1,defaultValue=50,label,onChange,disabled=!1})=>{const[value,setValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultValue),[isDragging,setIsDragging]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),sliderRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),percentage=(value-min)/(max-min)*100,marks=[];for(let i=min;i<=max;i+=(max-min)/4)marks.push(Math.round(i));const calculateNewValue=clientX=>{if(!sliderRef.current)return value;const bounds=sliderRef.current.getBoundingClientRect(),position=clientX-bounds.left,sliderWidth=bounds.width,percentage=Math.max(0,Math.min(100,position/sliderWidth*100)),newValue=Math.round(percentage/100*(max-min)+min),steppedValue=Math.round(newValue/step)*step;return Math.min(Math.max(steppedValue,min),max)},handleInteractionStart=clientX=>{if(disabled)return;setIsDragging(!0);const newValue=calculateNewValue(clientX);setValue(newValue),onChange?.(newValue)},handleInteractionMove=clientX=>{if(!isDragging||disabled)return;const newValue=calculateNewValue(clientX);setValue(newValue),onChange?.(newValue)};return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{const handleTouchMove=e=>{isDragging&&(e.preventDefault(),handleInteractionMove(e.touches[0].clientX))},handleMouseMove=e=>{handleInteractionMove(e.clientX)},handleEndInteraction=()=>{setIsDragging(!1)};return isDragging&&(window.addEventListener("touchmove",handleTouchMove,{passive:!1}),window.addEventListener("mousemove",handleMouseMove),window.addEventListener("touchend",handleEndInteraction),window.addEventListener("mouseup",handleEndInteraction)),()=>{window.removeEventListener("touchmove",handleTouchMove),window.removeEventListener("mousemove",handleMouseMove),window.removeEventListener("touchend",handleEndInteraction),window.removeEventListener("mouseup",handleEndInteraction)}}),[isDragging]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{setValue(defaultValue)}),[defaultValue]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("memori--slider-container",{"memori--slider-disabled":disabled}),style:{"--percentage":`${percentage}%`},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{className:"memori--slider-header",children:[label&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"memori--slider-label",children:label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"memori--slider-value",children:value})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{ref:sliderRef,className:"memori--slider-track-container",onMouseDown:e=>handleInteractionStart(e.clientX),onTouchStart:e=>handleInteractionStart(e.touches[0].clientX),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"memori--slider-track",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"memori--slider-track-fill"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"memori--slider-marks",children:marks.map((mark=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{className:"memori--slider-mark",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"memori--slider-mark-line"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("span",{className:"memori--slider-mark-value",children:mark})]},mark)))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_3__.R,{value,onChange:setValue,disabled,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"memori--slider-thumb",role:"slider","aria-valuemin":min,"aria-valuemax":max,"aria-valuenow":value,tabIndex:disabled?-1:0})})]})]})};CustomSlider.displayName="CustomSlider";const __WEBPACK_DEFAULT_EXPORT__=CustomSlider;try{Slider.displayName="Slider",Slider.__docgenInfo={description:"",displayName:"Slider",props:{min:{defaultValue:{value:"0"},description:"",name:"min",required:!1,type:{name:"number"}},max:{defaultValue:{value:"100"},description:"",name:"max",required:!1,type:{name:"number"}},step:{defaultValue:{value:"1"},description:"",name:"step",required:!1,type:{name:"number"}},defaultValue:{defaultValue:{value:"50"},description:"",name:"defaultValue",required:!1,type:{name:"number"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"ReactNode"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((value: number) => void)"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ui/Slider.tsx#Slider"]={docgenInfo:Slider.__docgenInfo,name:"Slider",path:"src/components/ui/Slider.tsx#Slider"})}catch(__react_docgen_typescript_loader_error){}},"./src/context/visemeContext.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{LG:()=>useViseme,jc:()=>VisemeProvider});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const VisemeContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(void 0),VISEME_MAP={0:"viseme_sil",1:"viseme_PP",2:"viseme_FF",3:"viseme_TH",4:"viseme_DD",5:"viseme_kk",6:"viseme_CH",7:"viseme_SS",8:"viseme_nn",9:"viseme_RR",10:"viseme_aa",11:"viseme_E",12:"viseme_I",13:"viseme_O",14:"viseme_U",15:"viseme_kk",16:"viseme_CH",17:"viseme_SS",18:"viseme_TH",19:"viseme_RR",20:"viseme_kk",21:"viseme_PP"},{DEFAULT_VISEME_DURATION,VISEME_OVERLAP,SMOOTHING_FACTOR,LOG_INTERVAL,PRELOAD,WEIGHT_MULTIPLIER}={DEFAULT_VISEME_DURATION:.1,VISEME_OVERLAP:.02,SMOOTHING_FACTOR:.4,LOG_INTERVAL:60,PRELOAD:.5,WEIGHT_MULTIPLIER:.8},timing_isExpired=(viseme,currentTime)=>viseme.endTime<currentTime-VISEME_OVERLAP,timing_calculateWeight=progress=>Math.sin(Math.PI*Math.min(progress,1))*WEIGHT_MULTIPLIER,timing_smoothWeight=(currentWeight,targetWeight)=>currentWeight+(targetWeight-currentWeight)*SMOOTHING_FACTOR,createLogger=type=>(event,data)=>{console.log(`%c[VisemeContext] ${event}`,{event:"color: #4CAF50; font-weight: bold;",error:"color: #f44336; font-weight: bold;",debug:"color: #2196F3; font-weight: bold;"}[type],data)},logVisemeEvent=createLogger("event"),logVisemeError=createLogger("error"),logVisemeDebug=createLogger("debug"),VisemeProvider=({children})=>{const visemeQueueRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)([]),audioContextRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),audioStartTimeRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),[isProcessing,setIsProcessing]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[visemeState,setVisemeState]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)("idle"),lastVisemeRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),frameCountRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(0),firstVisemeTimeRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),setAudioContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((ctx=>{audioContextRef.current=ctx,ctx.onstatechange=()=>{switch(logVisemeEvent("Audio Context State Change",{state:ctx.state,currentTime:ctx.currentTime}),ctx.state){case"running":setVisemeState("active");break;case"suspended":setVisemeState("paused");break;case"closed":setVisemeState("finished"),stopProcessing()}}}),[]),addViseme=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(((visemeId,audioOffset)=>{if("finished"===visemeState)return;const visemeName=VISEME_MAP[visemeId]||"viseme_sil",startTime=audioOffset/1e7;null===firstVisemeTimeRef.current&&(firstVisemeTimeRef.current=startTime);const relativeStartTime=startTime-(firstVisemeTimeRef.current||0),newViseme={name:visemeName,weight:0,startTime:relativeStartTime,endTime:relativeStartTime+DEFAULT_VISEME_DURATION};visemeQueueRef.current.push(newViseme),"idle"===visemeState&&setVisemeState("preparing")}),[visemeState]),startProcessing=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((audioCtx=>{audioCtx?(audioContextRef.current=audioCtx,audioStartTimeRef.current=audioCtx.currentTime,frameCountRef.current=0,setIsProcessing(!0),setVisemeState("active"),logVisemeEvent("Started Processing",{audioTime:audioCtx.currentTime,queueLength:visemeQueueRef.current.length,state:visemeState})):logVisemeError("No audio context provided",{state:visemeState})}),[]),stopProcessing=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((()=>{setIsProcessing(!1),setVisemeState("finished"),audioStartTimeRef.current=null,lastVisemeRef.current=null,frameCountRef.current=0,audioContextRef.current=null,logVisemeEvent("Stopped Processing",{queueLength:visemeQueueRef.current.length,state:visemeState})}),[]),updateCurrentViseme=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((_=>{if(!isProcessing||!audioContextRef.current)return null;const audioTime=audioContextRef.current.currentTime-(audioStartTimeRef.current||0)+PRELOAD;visemeQueueRef.current=visemeQueueRef.current.filter((v=>!timing_isExpired(v,audioTime)));const currentViseme=visemeQueueRef.current.find((v=>v.startTime<=audioTime&&v.endTime>audioTime-VISEME_OVERLAP));if(frameCountRef.current%LOG_INTERVAL==60&&logVisemeDebug("Current Viseme",{currentViseme,audioTime,visemeQueue:visemeQueueRef.current}),currentViseme){const progress=(audioTime-currentViseme.startTime)/(currentViseme.endTime-currentViseme.startTime),targetWeight=timing_calculateWeight(progress),smoothedWeight=lastVisemeRef.current?timing_smoothWeight(lastVisemeRef.current.weight,targetWeight):targetWeight,updatedViseme={...currentViseme,weight:smoothedWeight};return lastVisemeRef.current=updatedViseme,updatedViseme}if(lastVisemeRef.current){const reducedWeight=lastVisemeRef.current.weight*(1-SMOOTHING_FACTOR);lastVisemeRef.current={...lastVisemeRef.current,weight:reducedWeight}}return lastVisemeRef.current=null,null}),[isProcessing]),resetVisemeQueue=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((()=>{visemeQueueRef.current=[],lastVisemeRef.current=null,audioStartTimeRef.current=null,firstVisemeTimeRef.current=null,frameCountRef.current=0,setVisemeState("idle"),logVisemeEvent("Reset Viseme Queue",{previousState:visemeState})}),[visemeState]),resetAndStartProcessing=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((audioCtx=>{logVisemeEvent("Reset And Start Processing",{previousState:visemeState,queueLength:visemeQueueRef.current.length}),stopProcessing(),resetVisemeQueue(),startProcessing(audioCtx)}),[stopProcessing,resetVisemeQueue,startProcessing,visemeState]),contextValue=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>({addViseme,updateCurrentViseme,startProcessing,stopProcessing,resetAndStartProcessing,resetVisemeQueue,isProcessing,setAudioContext})),[addViseme,updateCurrentViseme,startProcessing,stopProcessing,resetAndStartProcessing,resetVisemeQueue,isProcessing,setAudioContext]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(VisemeContext.Provider,{value:contextValue,children})};VisemeProvider.displayName="VisemeProvider";const useViseme=()=>{const context=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(VisemeContext);if(!context)throw new Error("useVisemeContext must be used within a VisemeProvider");return context};try{VisemeProvider.displayName="VisemeProvider",VisemeProvider.__docgenInfo={description:"",displayName:"VisemeProvider",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/context/visemeContext.tsx#VisemeProvider"]={docgenInfo:VisemeProvider.__docgenInfo,name:"VisemeProvider",path:"src/context/visemeContext.tsx#VisemeProvider"})}catch(__react_docgen_typescript_loader_error){}},"./src/helpers/configuration.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A2:()=>setLocalConfig,gj:()=>removeLocalConfig,wm:()=>getLocalConfig});const keys={muteSpeaker:"@memori:muteSpeaker",microphoneMode:"@memori:microphoneMode",continuousSpeechTimeout:"@memori:continuousSpeechTimeout",birthDate:"@memori:birthDate",controlsPosition:"@memori:controlsPosition",hideEmissions:"@memori:hideEmissions",loginToken:"@memori:loginToken",location:"@memori:location"},getLocalConfig=(key,defaultValue)=>{try{const value=window.localStorage.getItem(keys[key]??key);if(!value)return defaultValue;try{return JSON.parse(value)}catch{return value}}catch(error){return console.error("error",error),defaultValue}},setLocalConfig=(key,value)=>{try{window.localStorage.setItem(keys[key]??key,value.toString())}catch(error){console.error("error",error)}},removeLocalConfig=key=>{try{window.localStorage.removeItem(keys[key]??key)}catch(error){console.error("error",error)}}},"./src/helpers/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Av:()=>isSkinnedMesh,Cb:()=>stripHTML,DI:()=>useDebounceFn,Dt:()=>isAndroid,LV:()=>stripMarkdown,SP:()=>pwdRegEx,Tt:()=>isiOS,WO:()=>installMathJax,bw:()=>cleanUrl,cm:()=>usernameRegEx,h:()=>stripEmojis,hs:()=>mailRegEx,kh:()=>stripOutputTags,lc:()=>correctMaterials,r:()=>escapeHTML,vw:()=>stripDuplicates,xZ:()=>hasTouchscreen});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),three__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/three/build/three.module.js");const hasTouchscreen=()=>{let hasTouchScreen=!1;if("maxTouchPoints"in navigator)hasTouchScreen=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator)hasTouchScreen=navigator.msMaxTouchPoints>0;else{const mQ=window&&"matchMedia"in window&&matchMedia("(pointer:coarse)");if(mQ&&"(pointer:coarse)"===mQ.media)hasTouchScreen=!!mQ.matches;else if("orientation"in window)hasTouchScreen=!0;else{var UA=navigator?.userAgent;hasTouchScreen=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(UA)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(UA)}}return hasTouchScreen},isiOS=()=>{let platform=navigator?.userAgentData?.platform||navigator?.platform||"unknown",userAgent=navigator?.userAgent||"unknown";return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(platform)||userAgent.includes("Mac")&&"ontouchend"in document},isAndroid=()=>"android"===(navigator?.userAgentData?.platform||navigator?.platform||"unknown").toLowerCase()||navigator.userAgent.includes("Android"),pwdRegEx=/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$_:;|,~+=\{\}\[\]%^&*-]).{8,}$/,mailRegEx=/^\w+([.-]?[+]?\w+)*@\w+([.-]?\w+)*(\.\w{2,})+$/,usernameRegEx=/^(?!.*\.\.)(?!.*\.$)[^\W][\w.+-]{2,32}$/;function useDebounceFn(fn,delay){const timeoutId=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(),originalFn=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>(originalFn.current=fn,()=>{originalFn.current=null})),[fn]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>()=>{clearTimeout(timeoutId.current)}),[]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>(...args)=>{clearTimeout(timeoutId.current),timeoutId.current=window.setTimeout((()=>{originalFn.current&&originalFn.current(...args)}),delay)}),[delay])}const stripDuplicates=text=>text.slice(0,text.length/2).trim().toLowerCase()===text.slice(text.length/2+1).trim().toLowerCase()?text.slice(0,text.length/2):text,stripEmojis=text=>text.replaceAll(/[^\p{L}\p{N}\p{P}\p{Z}^$\n]/gu,"").trim(),stripMarkdown=text=>text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=text.replaceAll(/```*?```/g,"")).replaceAll(/```[\s\S]*?```/g,"")).replaceAll(/`[^`]*`/g,"")).replaceAll(/!\[[^\]]*\]\([^)]*\)/g,"")).replaceAll(/\[([^\]]*)\]\([^)]*\)/g,"$1")).replaceAll(/^> /gm,"")).replaceAll(/^#+ /gm,"")).replaceAll(/[*_]/g,"")).replaceAll(/---/g,"")).replaceAll(/~~/g,"")).replaceAll(/^\s*[-*+] /gm,"")).replaceAll(/^\s*\d+\.\s+/gm,"")).replaceAll(/^\|.*\|$/gm,"")).replaceAll(/\$\$[\s\S]*?\$\$/g,"")).replaceAll(/\$[\s\S]*?\$/g,"")).replaceAll(/\\\([\s\S]*?\\\)/g,"")).replaceAll(/\\\[[\s\S]*?\\\]/g,"")).replaceAll(/\s+/g," ").trim(),stripOutputTags=text=>{const outputTagRegex=/<output.*?<\/output>/gs;if(!outputTagRegex.test(text))return text;const strippedText=text.replace(outputTagRegex,"");return stripOutputTags(strippedText)},stripHTML=text=>{const el=document.createElement("div");return el.innerHTML=text,el.textContent||""},escapeHTML=text=>{const el=document.createElement("textarea");return el.textContent=text,el.innerHTML};function cleanUrl(href){try{href=encodeURI(href).replace(/%25/g,"%")}catch(e){return null}return href}const mathJaxConfig={startup:{elements:[".memori-chat--bubble-content"]},options:{processHtmlClass:"memori-chat--bubble-content"},tex:{inlineMath:[["$","$"],["\\$","\\$"]],displayMath:[["$$","$$"]],processEscapes:!0},asciimath:{fixphi:!0,displaystyle:!0,decimalsign:"."},skipStartupTypeset:!0,chtml:{displayAlign:"left"},svg:{fontCache:"global"}},installMathJax=()=>{window.MathJax=mathJaxConfig,(()=>{const script=document.createElement("script");script.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",script.async=!0,script.id="mathjax-script",document.head.appendChild(script)})()};function correctMaterials(materials){Object.values(materials).forEach((material=>{material instanceof three__WEBPACK_IMPORTED_MODULE_1__.MeshStandardMaterial&&(material.roughness=.8,material.metalness=.1,material.shadowSide=2,material.map&&(material.map.anisotropy=16))}))}function isSkinnedMesh(object){return!0===object.isSkinnedMesh}}}]);