"use strict";(self.webpackChunk_memori_ai_memori_react=self.webpackChunk_memori_ai_memori_react||[]).push([[6820],{"./src/components/Avatar/AvatarView/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ContainerAvatarView});var react=__webpack_require__("./node_modules/react/index.js"),react_three_fiber_esm=__webpack_require__("./node_modules/@react-three/fiber/dist/react-three-fiber.esm.js"),SpotLight=__webpack_require__("./node_modules/@react-three/drei/core/SpotLight.js"),Environment=__webpack_require__("./node_modules/@react-three/drei/core/Environment.js"),OrbitControls=__webpack_require__("./node_modules/@react-three/drei/core/OrbitControls.js"),utils=__webpack_require__("./src/helpers/utils.ts"),lil_gui_esm=__webpack_require__("./node_modules/lil-gui/dist/lil-gui.esm.js");const components_controls=({onBaseActionChange,baseActions,modifyTimeScale,onMorphTargetInfluencesChange,onMorphTargetDictionaryChange,morphTargetDictionary,timeScale})=>{const guiRef=(0,react.useRef)(null),panelSettingsRef=(0,react.useRef)({"modify time scale":timeScale}),crossFadeControlsRef=(0,react.useRef)([]);return(0,react.useEffect)((()=>{const gui=new lil_gui_esm.ZP({width:310});guiRef.current=gui;const folder1=gui.addFolder("Base Actions"),folder2=gui.addFolder("Additive Action Weights"),folder3=gui.addFolder("General Speed");return["None",...Object.keys(baseActions)].forEach((name=>{baseActions[name];panelSettingsRef.current[name]=()=>{onBaseActionChange(name)};const control=folder1.add(panelSettingsRef.current,name);crossFadeControlsRef.current.push(control)})),Object.entries(morphTargetDictionary).forEach((([name,settings])=>{panelSettingsRef.current[name]=settings/100,folder2.add(panelSettingsRef.current,name,-1,1,.01).listen().onChange((weight=>{onMorphTargetInfluencesChange({[name]:weight})}))})),folder3.add(panelSettingsRef.current,"modify time scale",0,1.5,.01).onChange((value=>{modifyTimeScale(value)})),folder1.open(),folder2.open(),folder3.open(),()=>{gui.destroy()}}),[onBaseActionChange,onMorphTargetInfluencesChange,onMorphTargetDictionaryChange,modifyTimeScale,baseActions,morphTargetDictionary,timeScale]),null};try{controls.displayName="controls",controls.__docgenInfo={description:"",displayName:"controls",props:{baseActions:{defaultValue:null,description:"",name:"baseActions",required:!0,type:{name:"Record<string, BaseAction>"}},onBaseActionChange:{defaultValue:null,description:"",name:"onBaseActionChange",required:!0,type:{name:"(action: string) => void"}},currentBaseAction:{defaultValue:null,description:"",name:"currentBaseAction",required:!0,type:{name:"{ action: string; weight: number; }"}},onMorphTargetInfluencesChange:{defaultValue:null,description:"",name:"onMorphTargetInfluencesChange",required:!0,type:{name:"(influences: { [key: string]: number; }) => void"}},onMorphTargetDictionaryChange:{defaultValue:null,description:"",name:"onMorphTargetDictionaryChange",required:!0,type:{name:"(dictionary: { [key: string]: number; }) => void"}},morphTargetDictionary:{defaultValue:null,description:"",name:"morphTargetDictionary",required:!0,type:{name:"{ [key: string]: number; }"}},modifyTimeScale:{defaultValue:null,description:"",name:"modifyTimeScale",required:!0,type:{name:"(value: number) => void"}},timeScale:{defaultValue:null,description:"",name:"timeScale",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/components/controls.tsx#controls"]={docgenInfo:controls.__docgenInfo,name:"controls",path:"src/components/Avatar/AvatarView/AvatarComponent/components/controls.tsx#controls"})}catch(__react_docgen_typescript_loader_error){}var three_module=__webpack_require__("./node_modules/three/build/three.module.js"),useGLTF=__webpack_require__("./node_modules/@react-three/drei/core/useGLTF.js"),useAnimations=__webpack_require__("./node_modules/@react-three/drei/core/useAnimations.js");const DEFAULT_BLINK_CONFIG={minInterval:1e3,maxInterval:5e3,blinkDuration:150};function useAvatarBlink({enabled,setMorphTargetInfluences,config={}}){const blinkTimeoutRef=(0,react.useRef)(),isBlinkingRef=(0,react.useRef)(!1),lastBlinkTime=(0,react.useRef)(0),blinkConfig={...DEFAULT_BLINK_CONFIG,...config},blink=(0,react.useCallback)((()=>{enabled&&!isBlinkingRef.current&&(isBlinkingRef.current=!0,setMorphTargetInfluences((prev=>({...prev,eyesClosed:1}))),setTimeout((()=>{setMorphTargetInfluences((prev=>({...prev,eyesClosed:0}))),isBlinkingRef.current=!1,lastBlinkTime.current=Date.now(),scheduleNextBlink()}),blinkConfig.blinkDuration))}),[enabled,blinkConfig.blinkDuration,setMorphTargetInfluences]),scheduleNextBlink=(0,react.useCallback)((()=>{blinkTimeoutRef.current&&clearTimeout(blinkTimeoutRef.current);const nextBlinkDelay=Math.random()*(blinkConfig.maxInterval-blinkConfig.minInterval)+blinkConfig.minInterval;blinkTimeoutRef.current=setTimeout(blink,nextBlinkDelay)}),[blink,blinkConfig.maxInterval,blinkConfig.minInterval]);return(0,react.useEffect)((()=>(enabled?scheduleNextBlink():(blinkTimeoutRef.current&&clearTimeout(blinkTimeoutRef.current),setMorphTargetInfluences((prevInfluences=>({...prevInfluences,eyesClosed:0})))),()=>{blinkTimeoutRef.current&&clearTimeout(blinkTimeoutRef.current)})),[enabled,scheduleNextBlink,setMorphTargetInfluences]),{isBlinking:isBlinkingRef.current,lastBlinkTime:lastBlinkTime.current,triggerBlink:blink}}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const AVATAR_POSITION=new three_module.Vector3(0,-1,0),AVATAR_ROTATION=new three_module.Euler(.175,0,0),AVATAR_POSITION_ZOOMED=new three_module.Vector3(0,-1.45,0),ANIMATION_URLS={MALE:"https://assets.memori.ai/api/v2/asset/1c350a21-97d8-4add-82cc-9dc10767a26b.glb",FEMALE:"https://assets.memori.ai/api/v2/asset/a1908dbf-8ce8-438d-90df-acf9dc2604ad.glb"};function FullbodyAvatar({url,sex,onLoaded,currentBaseAction,timeScale,isZoomed,setMorphTargetInfluences,setMorphTargetDictionary,morphTargetInfluences,eyeBlink}){const{scene}=(0,useGLTF.L)(url),{animations}=(0,useGLTF.L)(ANIMATION_URLS[sex]),{nodes,materials}=(0,react_three_fiber_esm.n4)(scene),{actions}=(0,useAnimations.v)(animations,scene),[mixer]=(0,react.useState)((()=>new three_module.AnimationMixer(scene))),avatarMeshRef=(0,react.useRef)();return useAvatarBlink({enabled:eyeBlink||!1,setMorphTargetInfluences,config:{minInterval:1500,maxInterval:4e3,blinkDuration:120}}),(0,react.useEffect)((()=>((0,utils.lc)(materials),scene.traverse((object=>{if(object instanceof three_module.SkinnedMesh&&"Wolf3D_Avatar020"===object.name&&(avatarMeshRef.current=object,object.morphTargetDictionary&&object.morphTargetInfluences)){setMorphTargetDictionary(object.morphTargetDictionary);const initialInfluences=Object.keys(object.morphTargetDictionary).reduce(((acc,key)=>({...acc,[key]:0})),{});setMorphTargetInfluences(initialInfluences)}})),onLoaded?.(),()=>{Object.values(materials).forEach(react_three_fiber_esm.B9),Object.values(nodes).filter(utils.Av).forEach(react_three_fiber_esm.B9)})),[materials,nodes,url,onLoaded,setMorphTargetDictionary,setMorphTargetInfluences]),(0,react.useEffect)((()=>{if(!actions||!currentBaseAction.action)return;const newAction=actions[currentBaseAction.action];if(!newAction)return void console.warn(`Animation "${currentBaseAction.action}" not found in actions.`);return newAction.timeScale=timeScale,newAction.reset().fadeIn(.8).play(),()=>{newAction.fadeOut(.8)}}),[currentBaseAction,timeScale,actions]),(0,react_three_fiber_esm.xQ)(((_,delta)=>{avatarMeshRef.current&&avatarMeshRef.current.morphTargetDictionary&&Object.entries(morphTargetInfluences).forEach((([key,value])=>{const index=avatarMeshRef.current.morphTargetDictionary[key];if("number"==typeof index&&avatarMeshRef.current.morphTargetInfluences){const currentValue=avatarMeshRef.current.morphTargetInfluences[index],smoothValue=currentValue*(1-(alpha=.1))+value*alpha;avatarMeshRef.current.morphTargetInfluences[index]=smoothValue}var alpha})),mixer.update(.001*delta)})),(0,jsx_runtime.jsx)("group",{position:isZoomed?AVATAR_POSITION_ZOOMED:AVATAR_POSITION,rotation:AVATAR_ROTATION,children:(0,jsx_runtime.jsx)("primitive",{object:scene})})}FullbodyAvatar.displayName="FullbodyAvatar";try{fullbodyAvatar.displayName="fullbodyAvatar",fullbodyAvatar.__docgenInfo={description:"",displayName:"fullbodyAvatar",props:{url:{defaultValue:null,description:"",name:"url",required:!0,type:{name:"string"}},sex:{defaultValue:null,description:"",name:"sex",required:!0,type:{name:"enum",value:[{value:'"MALE"'},{value:'"FEMALE"'}]}},onLoaded:{defaultValue:null,description:"",name:"onLoaded",required:!1,type:{name:"(() => void)"}},currentBaseAction:{defaultValue:null,description:"",name:"currentBaseAction",required:!0,type:{name:"{ action: string; weight: number; }"}},timeScale:{defaultValue:null,description:"",name:"timeScale",required:!0,type:{name:"number"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},speaking:{defaultValue:null,description:"",name:"speaking",required:!1,type:{name:"boolean"}},isZoomed:{defaultValue:null,description:"",name:"isZoomed",required:!1,type:{name:"boolean"}},setMorphTargetInfluences:{defaultValue:null,description:"",name:"setMorphTargetInfluences",required:!0,type:{name:"(influences: { [key: string]: number; }) => void"}},setMorphTargetDictionary:{defaultValue:null,description:"",name:"setMorphTargetDictionary",required:!0,type:{name:"(dictionary: { [key: string]: number; }) => void"}},morphTargetInfluences:{defaultValue:null,description:"",name:"morphTargetInfluences",required:!0,type:{name:"{ [key: string]: number; }"}},morphTargetDictionary:{defaultValue:null,description:"",name:"morphTargetDictionary",required:!0,type:{name:"{ [key: string]: number; }"}},eyeBlink:{defaultValue:null,description:"",name:"eyeBlink",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/components/fullbodyAvatar.tsx#fullbodyAvatar"]={docgenInfo:fullbodyAvatar.__docgenInfo,name:"fullbodyAvatar",path:"src/components/Avatar/AvatarView/AvatarComponent/components/fullbodyAvatar.tsx#fullbodyAvatar"})}catch(__react_docgen_typescript_loader_error){}const utils_lerp=(start,end,time=.05)=>start*(1-time)+end*time,mapRange=(value,inMin,inMax,outMin,outMax)=>((value=((value,min,max)=>Math.min(Math.max(value,min),max))(value,inMin,inMax))-inMin)*(outMax-outMin)/(inMax-inMin)+outMin,rad=Math.PI/180;let timeout,useHeadMovement_reset=!1;const targetPos=new three_module.Vector2(0,0),currentPos=new three_module.Vector2(0,0),setResetTrue=()=>{timeout=setTimeout((()=>{useHeadMovement_reset=!0}),1e3)},setResetFalse=()=>{clearTimeout(timeout),useHeadMovement_reset=!1};const MOUTH_MOVE_DURATION=2,MOUTH_MOVE_INTERVAL_MIN=100,MOUTH_MOVE_INTERVAL_MAX=500;function resetMouthShape(mesh,morphIndices){mesh?.morphTargetInfluences&&(mesh.morphTargetInfluences[morphIndices.open]=0,mesh.morphTargetInfluences[morphIndices.smile]=0,mesh.morphTargetInfluences[morphIndices.funner]=0,mesh.morphTargetInfluences[morphIndices.pucker]=0)}const halfbodyAvatar_AVATAR_POSITION=new three_module.Vector3(0,-.6,0);function HalfBodyAvatar({url,setMorphTargetInfluences,headMovement,speaking,onLoaded}){const{scene}=(0,useGLTF.L)(url),{nodes,materials}=(0,react_three_fiber_esm.n4)(scene);useAvatarBlink({enabled:!0,setMorphTargetInfluences,config:{minInterval:1500,maxInterval:4e3,blinkDuration:120}}),function useHeadMovement(enabled,nodes){const{gl}=(0,react_three_fiber_esm.Ky)();(0,react.useEffect)((()=>{if(enabled)return gl.domElement.addEventListener("mouseleave",setResetTrue),gl.domElement.addEventListener("mouseenter",setResetFalse),()=>{gl.domElement.removeEventListener("mouseleave",setResetTrue),gl.domElement.removeEventListener("mouseenter",setResetFalse)}}),[gl.domElement,enabled]),(0,react_three_fiber_esm.xQ)((state=>{if(!enabled||!nodes?.Neck||!nodes?.Head)return;const cameraRotation=Math.abs(state.camera.rotation.z);!useHeadMovement_reset&&cameraRotation<.2?(targetPos.x=mapRange(state.mouse.y,-1,1,5*rad,-5*rad),targetPos.y=mapRange(state.mouse.x,-1,1,-10*rad,10*rad)):targetPos.set(0,0),currentPos.x=utils_lerp(currentPos.x,targetPos.x),currentPos.y=utils_lerp(currentPos.y,targetPos.y),nodes.Neck.rotation.x=currentPos.x+.1,nodes.Neck.rotation.y=currentPos.y,nodes.Head.rotation.x=2*currentPos.x,nodes.Head.rotation.y=2*currentPos.y}))}(headMovement,nodes),function useMouthSpeaking(speaking,nodes){const mouthStateRef=(0,react.useRef)({moveTime:999,mesh:null,morphIndices:{open:0,smile:0,funner:0,pucker:0}}),setNextMouthMove=(0,react.useCallback)((()=>{mouthStateRef.current.moveTime=0;const nextMoveDelay=Math.random()*(MOUTH_MOVE_INTERVAL_MAX-MOUTH_MOVE_INTERVAL_MIN)+MOUTH_MOVE_INTERVAL_MIN;setTimeout(setNextMouthMove,nextMoveDelay)}),[]);(0,react.useEffect)((()=>{if(!speaking)return;const mouthMesh=nodes.Wolf3D_Head||nodes.Wolf3D_Avatar020||nodes.Wolf3D_Avatar001;mouthStateRef.current.mesh=mouthMesh,mouthMesh?.morphTargetDictionary&&mouthMesh?.morphTargetInfluences&&(mouthStateRef.current.morphIndices={open:mouthMesh.morphTargetDictionary.mouthOpen,smile:mouthMesh.morphTargetDictionary.mouthSmile,funner:mouthMesh.morphTargetDictionary.mouthFunner,pucker:mouthMesh.morphTargetDictionary.mouthPucker});const initialMoveDelay=setTimeout(setNextMouthMove,200);return()=>{clearTimeout(initialMoveDelay)}}),[nodes,speaking,setNextMouthMove]),(0,react_three_fiber_esm.xQ)(((_,delta)=>{const{moveTime,mesh,morphIndices}=mouthStateRef.current;if(speaking&&mesh?.morphTargetInfluences)if(moveTime<MOUTH_MOVE_DURATION){const value=Math.abs(Math.sin(moveTime*Math.PI/2));mouthStateRef.current.moveTime+=10*delta,function updateMouthShape(mesh,morphIndices,value){mesh.morphTargetInfluences[morphIndices.open]=value/3,mesh.morphTargetInfluences[morphIndices.smile]=value/10,mesh.morphTargetInfluences[morphIndices.funner]=value/7,mesh.morphTargetInfluences[morphIndices.pucker]=value/5}(mesh,morphIndices,value)}else resetMouthShape(mesh,morphIndices);else resetMouthShape(mesh,morphIndices)}))}(!!speaking,nodes),(0,react.useEffect)((()=>((nodes=>{nodes.Wolf3D_Hands&&(nodes.Wolf3D_Hands.visible=!1),nodes.RightHand&&nodes.LeftHand&&(nodes.RightHand.position.set(0,-2,0),nodes.LeftHand.position.set(0,-2,0))})(nodes),(0,utils.lc)(materials),onLoaded?.(),()=>{Object.values(materials).forEach(react_three_fiber_esm.B9),Object.values(nodes).filter(utils.Av).forEach(react_three_fiber_esm.B9)})),[materials,nodes,url,onLoaded]);const skinnedMeshes=(0,react.useMemo)((()=>Object.values(nodes).filter(utils.Av)),[nodes]);return(0,jsx_runtime.jsxs)("group",{position:halfbodyAvatar_AVATAR_POSITION,children:[nodes.Hips&&(0,jsx_runtime.jsx)("primitive",{object:nodes.Hips},"armature"),skinnedMeshes.map((node=>node&&(0,jsx_runtime.jsx)("primitive",{object:node,receiveShadow:!0,castShadow:!0},node.name)))]})}HalfBodyAvatar.displayName="HalfBodyAvatar";try{halfbodyAvatar.displayName="halfbodyAvatar",halfbodyAvatar.__docgenInfo={description:"",displayName:"halfbodyAvatar",props:{url:{defaultValue:null,description:"",name:"url",required:!0,type:{name:"string"}},setMorphTargetInfluences:{defaultValue:null,description:"",name:"setMorphTargetInfluences",required:!0,type:{name:"(morphTargetInfluences: any) => void"}},headMovement:{defaultValue:null,description:"",name:"headMovement",required:!1,type:{name:"boolean"}},speaking:{defaultValue:null,description:"",name:"speaking",required:!1,type:{name:"boolean"}},onLoaded:{defaultValue:null,description:"",name:"onLoaded",required:!1,type:{name:"(() => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/components/halfbodyAvatar.tsx#halfbodyAvatar"]={docgenInfo:halfbodyAvatar.__docgenInfo,name:"halfbodyAvatar",path:"src/components/Avatar/AvatarView/AvatarComponent/components/halfbodyAvatar.tsx#halfbodyAvatar"})}catch(__react_docgen_typescript_loader_error){}const useViseme=()=>{const[currentVisemes,setCurrentVisemes]=(0,react.useState)([]),visemeMap={A:"viseme_aa",E:"viseme_E",I:"viseme_I",O:"viseme_O",U:"viseme_U",PP:"viseme_PP",FF:"viseme_FF",TH:"viseme_TH",DD:"viseme_DD",kk:"viseme_kk",CH:"viseme_CH",SS:"viseme_SS",nn:"viseme_nn",RR:"viseme_RR",sil:"viseme_sil"};return{currentVisemes,createVisemeSequence:(0,react.useCallback)(((text,durationPerPhoneme=.1)=>{const sequence=[];return text.split("").forEach((char=>{if(""===char.trim())return void sequence.push({name:visemeMap.sil,duration:durationPerPhoneme/2,weight:1});const visemeName=(char=>(char=char.toUpperCase(),"AEIOU".includes(char)?visemeMap[char]:"BP".includes(char)?visemeMap.PP:"FV".includes(char)?visemeMap.FF:"TD".includes(char)?visemeMap.DD:"KG".includes(char)?visemeMap.kk:"CS".includes(char)?visemeMap.SS:"NM".includes(char)?visemeMap.nn:"R"===char?visemeMap.RR:"L"===char?visemeMap.TH:visemeMap.sil))(char);sequence.push({name:visemeName,duration:durationPerPhoneme,weight:1})})),setCurrentVisemes(sequence),sequence}),[]),clearVisemes:(0,react.useCallback)((()=>{setCurrentVisemes([])}),[])}},baseActions={Gioia1:{weight:0},Gioia2:{weight:0},Gioia3:{weight:0},Idle1:{weight:1},Idle2:{weight:0},Idle3:{weight:0},Idle4:{weight:0},Idle5:{weight:0},Rabbia1:{weight:0},Rabbia2:{weight:0},Rabbia3:{weight:0},Sorpresa1:{weight:0},Sorpresa2:{weight:0},Sorpresa3:{weight:0},Timore1:{weight:0},Timore2:{weight:0},Timore3:{weight:0},Tristezza1:{weight:0},Tristezza2:{weight:0},Tristezza3:{weight:0}},avatarComponent_AvatarView=({chatEmission,showControls,animation,loading,url,sex,eyeBlink,headMovement,speaking,halfBody,isZoomed})=>{const[currentBaseAction,setCurrentBaseAction]=(0,react.useState)({action:animation||"Idle1",weight:1}),[morphTargetInfluences,setMorphTargetInfluences]=(0,react.useState)({}),[morphTargetDictionary,setMorphTargetDictionary]=(0,react.useState)({}),[timeScale,setTimeScale]=(0,react.useState)(.8),{createVisemeSequence,currentVisemes,clearVisemes}=useViseme(),setEmotion=(0,react.useCallback)((action=>{const emotionMap={Gioia:{eyesClosed:.5,mouthSmile:1},Rabbia:{eyesClosed:1,mouthSmile:-.5},Sorpresa:{mouthSmile:.5,eyesClosed:-.2},Tristezza:{mouthSmile:-.6,eyesClosed:.5},Timore:{mouthSmile:-.5,eyesClosed:1},default:{mouthSmile:0,eyesClosed:0}},emotion=Object.keys(emotionMap).find((key=>action.startsWith(key)))||"default";setMorphTargetInfluences(emotionMap[emotion])}),[]),onBaseActionChange=(0,react.useCallback)((action=>{setEmotion(action),setCurrentBaseAction({action,weight:1})}),[]),onMorphTargetInfluencesChange=(0,react.useCallback)((influences=>{setMorphTargetInfluences((prevInfluences=>({...prevInfluences,...influences})))}),[]),onMorphTargetDictionaryChange=(0,react.useCallback)((dictionary=>{setMorphTargetDictionary(dictionary)}),[]),modifyTimeScale=(0,react.useCallback)((value=>{setTimeScale(value)}),[]);return(0,react.useEffect)((()=>{chatEmission&&createVisemeSequence(chatEmission);const hasOutputTag=chatEmission?.includes('<output class="memori-emotion">'),outputContent=hasOutputTag?chatEmission?.split('<output class="memori-emotion">')[1]?.split("</output>")[0]?.trim():null;if(outputContent){const randomNumber=Math.floor(3*Math.random())+1;setEmotion(`${outputContent}${randomNumber}`)}}),[chatEmission]),(0,react.useEffect)((()=>{loading&&setCurrentBaseAction({action:"Idle1",weight:1})}),[loading]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[showControls&&(0,jsx_runtime.jsx)(components_controls,{timeScale,morphTargetDictionary,onBaseActionChange,onMorphTargetInfluencesChange,onMorphTargetDictionaryChange,baseActions,currentBaseAction,modifyTimeScale}),halfBody?(0,jsx_runtime.jsx)(HalfBodyAvatar,{url,setMorphTargetInfluences,headMovement,speaking}):(0,jsx_runtime.jsx)(FullbodyAvatar,{url,sex,eyeBlink,speaking,currentBaseAction,timeScale,setMorphTargetInfluences,setMorphTargetDictionary,morphTargetInfluences,morphTargetDictionary,isZoomed,currentVisemes})]})};try{avatarComponent_AvatarView.displayName="AvatarView",avatarComponent_AvatarView.__docgenInfo={description:"",displayName:"AvatarView",props:{showControls:{defaultValue:null,description:"",name:"showControls",required:!0,type:{name:"boolean"}},animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:"string"}},loading:{defaultValue:null,description:"",name:"loading",required:!0,type:{name:"boolean"}},url:{defaultValue:null,description:"",name:"url",required:!0,type:{name:"string"}},sex:{defaultValue:null,description:"",name:"sex",required:!0,type:{name:"enum",value:[{value:'"MALE"'},{value:'"FEMALE"'}]}},eyeBlink:{defaultValue:null,description:"",name:"eyeBlink",required:!0,type:{name:"boolean"}},headMovement:{defaultValue:null,description:"",name:"headMovement",required:!0,type:{name:"boolean"}},speaking:{defaultValue:null,description:"",name:"speaking",required:!0,type:{name:"boolean"}},isZoomed:{defaultValue:null,description:"",name:"isZoomed",required:!0,type:{name:"boolean"}},chatEmission:{defaultValue:null,description:"",name:"chatEmission",required:!0,type:{name:"any"}},halfBody:{defaultValue:null,description:"",name:"halfBody",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/avatarComponent.tsx#AvatarView"]={docgenInfo:avatarComponent_AvatarView.__docgenInfo,name:"AvatarView",path:"src/components/Avatar/AvatarView/AvatarComponent/avatarComponent.tsx#AvatarView"})}catch(__react_docgen_typescript_loader_error){}var useProgress=__webpack_require__("./node_modules/@react-three/drei/core/useProgress.js"),Html=__webpack_require__("./node_modules/@react-three/drei/web/Html.js"),Spin=__webpack_require__("./src/components/ui/Spin.tsx");const Loader=({fallbackImg})=>{const{progress}=(0,useProgress.S)();return(0,jsx_runtime.jsx)(Html.V,{center:!0,className:"avatar-loader",children:(0,jsx_runtime.jsx)(Spin.Z,{spinning:!0,children:fallbackImg?(0,jsx_runtime.jsxs)("figure",{children:[(0,jsx_runtime.jsx)("img",{src:fallbackImg,alt:`${Math.round(progress)}% loaded`,title:`${Math.round(progress)}% loaded`}),(0,jsx_runtime.jsx)("figcaption",{children:`${Math.round(progress)}%`})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Math.round(progress)," % loaded"]})})})};Loader.displayName="Loader";const components_loader=Loader;try{loader.displayName="loader",loader.__docgenInfo={description:"",displayName:"loader",props:{fallbackImg:{defaultValue:null,description:"",name:"fallbackImg",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/AvatarComponent/components/loader.tsx#loader"]={docgenInfo:loader.__docgenInfo,name:"loader",path:"src/components/Avatar/AvatarView/AvatarComponent/components/loader.tsx#loader"})}catch(__react_docgen_typescript_loader_error){}const defaultStyles={halfBody:{width:"100%",height:"100%",minHeight:"500px",backgroundColor:"white",borderRadius:"100%"},fullBody:{width:"500px",height:"500px",backgroundColor:"white"}},getCameraSettings=(halfBody,isZoomed)=>halfBody?{fov:40,position:[0,0,.6]}:!halfBody&&isZoomed?{fov:44,position:[0,0,1.25]}:{fov:40,position:[0,175e-7,3]},getLightingComponent=()=>(0,utils.Dt)()||(0,utils.Tt)()?(0,jsx_runtime.jsx)(SpotLight.P,{distance:100,position:[-.3,.2,1.25],angle:Math.PI/2,attenuation:5,anglePower:5}):(0,jsx_runtime.jsx)(Environment.qA,{files:"https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/venice_sunset_1k.hdr"});function ContainerAvatarView({url,sex,style,rotateAvatar,eyeBlink,headMovement,speaking,fallback,fallbackImg,halfBody=!0,loading,animation,showControls=!0,isZoomed,chatEmission}){return(0,jsx_runtime.jsx)(react_three_fiber_esm.Xz,{style:style||(halfBody?defaultStyles.halfBody:defaultStyles.fullBody),camera:getCameraSettings(halfBody,isZoomed),children:(0,jsx_runtime.jsxs)(react.Suspense,{fallback:fallback||(0,jsx_runtime.jsx)(components_loader,{fallbackImg}),children:[getLightingComponent(),rotateAvatar&&(0,jsx_runtime.jsx)(OrbitControls.z,{enablePan:!1,enableZoom:!1}),(0,jsx_runtime.jsx)(avatarComponent_AvatarView,{url,sex,showControls,loading:loading||!1,animation,isZoomed:isZoomed||!1,eyeBlink:eyeBlink||!1,headMovement:headMovement||!1,speaking:speaking||!1,halfBody:halfBody||!1,chatEmission})]})})}ContainerAvatarView.displayName="ContainerAvatarView";try{AvatarView.displayName="AvatarView",AvatarView.__docgenInfo={description:"",displayName:"AvatarView",props:{url:{defaultValue:null,description:"",name:"url",required:!0,type:{name:"string"}},sex:{defaultValue:null,description:"",name:"sex",required:!0,type:{name:"enum",value:[{value:'"MALE"'},{value:'"FEMALE"'}]}},fallbackImg:{defaultValue:null,description:"",name:"fallbackImg",required:!1,type:{name:"string"}},eyeBlink:{defaultValue:null,description:"",name:"eyeBlink",required:!1,type:{name:"boolean"}},headMovement:{defaultValue:null,description:"",name:"headMovement",required:!1,type:{name:"boolean"}},rotateAvatar:{defaultValue:null,description:"",name:"rotateAvatar",required:!1,type:{name:"boolean"}},speaking:{defaultValue:null,description:"",name:"speaking",required:!1,type:{name:"boolean"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},fallback:{defaultValue:null,description:"",name:"fallback",required:!1,type:{name:"ReactNode"}},halfBody:{defaultValue:{value:"true"},description:"",name:"halfBody",required:!1,type:{name:"boolean"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:"string"}},showControls:{defaultValue:{value:"true"},description:"",name:"showControls",required:!1,type:{name:"boolean"}},isZoomed:{defaultValue:null,description:"",name:"isZoomed",required:!1,type:{name:"boolean"}},chatEmission:{defaultValue:null,description:"",name:"chatEmission",required:!1,type:{name:"any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Avatar/AvatarView/index.tsx#AvatarView"]={docgenInfo:AvatarView.__docgenInfo,name:"AvatarView",path:"src/components/Avatar/AvatarView/index.tsx#AvatarView"})}catch(__react_docgen_typescript_loader_error){}}}]);