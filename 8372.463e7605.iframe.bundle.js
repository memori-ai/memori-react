"use strict";(self.webpackChunk_memori_ai_memori_react=self.webpackChunk_memori_ai_memori_react||[]).push([[8372],{"./src/components/LoginDrawer/LoginDrawer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>LoginDrawer_LoginDrawer});var react=__webpack_require__("./node_modules/react/index.js"),Button=__webpack_require__("./src/components/ui/Button.tsx"),Drawer=__webpack_require__("./src/components/ui/Drawer.tsx"),dist=__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),helpers_error=__webpack_require__("./src/helpers/error.ts"),utils=__webpack_require__("./src/helpers/utils.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const reservedUserNames=["memori","private","public","api","404","500","it","en","account","auth","logout","privacy_and_cookie","unauthorized","users","virtual_spaces"],SignupForm=({tenant,apiClient,onLogin,goToLogin,__TEST__waitingForOtp=!1})=>{const{t,i18n}=(0,useTranslation.B)(),lang="it"===i18n.language?"it":"en",{userSignUp,userConfirmSignUp,resendVerificationCode}=apiClient.backend,[email,setEmail]=(0,react.useState)(),[username,setUsername]=(0,react.useState)(),[password,setPassword]=(0,react.useState)(),[confirmPassword,setConfirmPassword]=(0,react.useState)(),pwdAcceptable=!password||password&&utils.pF.test(password),pwdGreen=pwdAcceptable&&password&&password.length>=24,pwdEmpty=!password||0===password.length,pwdMeterValue=!pwdAcceptable||pwdEmpty?0:password.length<8?15:password.length>=32?100:(password.length-8)*(50/24)+50,[loading,setLoading]=(0,react.useState)(!1),[loadingOtp,setLoadingOtp]=(0,react.useState)(!1),[waitingForOtp,setWaitingForOtp]=(0,react.useState)(__TEST__waitingForOtp),[error,setError]=(0,react.useState)(null),[referral,setReferral]=(0,react.useState)();(0,react.useEffect)(()=>{setReferral(window.location.href)},[]);return waitingForOtp?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("form",{className:"memori--login-drawer--form",onSubmit:async e=>{e.preventDefault();const form=e.currentTarget,tenantID=form.tenant.value??tenant.name,userName=form.userName.value??username,pwd=form.password.value??password,verificationCode=form.verificationCode.value;setLoading(!0),setError(null);try{const{user,token,...resp}=await userConfirmSignUp({tenant:tenantID,userName,password:pwd,verificationCode});0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode)))):user&&token&&(dist.Ay.success(t("success")),onLogin(user,token))}catch(e){let err=e;console.error("[validate otp]",err),err?.message&&dist.Ay.error(err.message)}finally{setLoading(!1)}},children:[(0,jsx_runtime.jsx)("input",{type:"hidden",name:"userName",value:username}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"password",value:password}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"tenant",value:tenant.name}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#verificationCode",children:[t("login.otpCode"),(0,jsx_runtime.jsx)("input",{id:"verificationCode",name:"verificationCode",type:"text",required:!0,autoComplete:"one-time-code",placeholder:t("login.otpCode")||"OTP"})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)(Button.A,{outlined:!0,onClick:async e=>{if(e.preventDefault(),username){setLoadingOtp(!0);try{const resp=await resendVerificationCode({tenant:tenant?.name,userName:username});0===resp.resultCode?dist.Ay.success(t("resentVerificationCode")):(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode))))}catch(e){let err=e;console.error("[resend otp]",err),err?.message&&dist.Ay.error(err.message)}finally{setLoadingOtp(!1)}}},loading:loadingOtp,children:t("login.resendVerificationCode")})}),(0,jsx_runtime.jsx)(Button.A,{htmlType:"submit",primary:!0,loading,children:t("confirm")})]}),error&&(0,jsx_runtime.jsx)("p",{role:"alert",className:"memori--login-drawer--error",children:error})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("form",{className:"memori--login-drawer--form",onSubmit:async e=>{e.preventDefault();const form=e.currentTarget,tenantID=form.tenant.value??tenant.name,eMail=(form.eMail.value??email).toLowerCase(),userName=form.userName.value??username,password=form.password.value,birthDate=new Date(form.birthDate?.value).toISOString(),tnCAndPPAccepted=form.tnCAndPPAccepted?.checked,pAndCUAccepted=form.pAndCUAccepted?.checked,referral=form.referral?.value;if(!(eMail&&userName&&password&&birthDate&&tnCAndPPAccepted))return void setError(t("missingData"));setLoading(!0),setError(null);if(((new Date).getTime()-new Date(birthDate).getTime())/1e3/60/60/24/365<14)return dist.Ay.error(t("login.underage",{age:14})),void setError(t("login.underage",{age:14}));try{const{user,...resp}=await userSignUp({tenant:tenantID,eMail,userName,password,birthDate,tnCAndPPAccepted,tnCAndPPAcceptanceDate:(new Date).toISOString(),pAndCUAccepted,pAndCUAcceptanceDate:(new Date).toISOString(),referral});0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode)))):user&&(dist.Ay.success(t("success")),setWaitingForOtp(!0))}catch(e){let err=e;console.error("[signup]",err),err?.message&&dist.Ay.error(err.message)}finally{setLoading(!1)}},children:[(0,jsx_runtime.jsx)("input",{type:"hidden",name:"tenant",value:tenant.name}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"referral",value:referral}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#eMail",children:[t("login.email"),(0,jsx_runtime.jsx)("input",{type:"email",name:"eMail",id:"eMail",required:!0,autoComplete:"email",placeholder:t("login.email")||"Email",onChange:e=>setEmail(e.target.value),"aria-invalid":!!email?.length&&!utils.Lr.test(email)})]}),!!email?.length&&!utils.Lr.test(email)&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.emailFormatError")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"userName",children:[t("login.username"),(0,jsx_runtime.jsx)("input",{type:"text",name:"userName",id:"userName",required:!0,autoComplete:"username",placeholder:t("login.username")||"Username",onFocus:()=>{if(!username?.length&&email?.length){let username=(email=>email.split("@")[0].replace(/[^a-zA-Z0-9]/g,""))(email);const field=document.getElementById("userName");field&&(field.value=username,setUsername(username))}},onChange:e=>setUsername(e.target.value),"aria-invalid":!!username?.length&&(reservedUserNames.includes(username.toLowerCase())||!utils.KW.test(username))})]}),!!username?.length&&reservedUserNames.includes(username.toLowerCase())&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.usernameContainsReservedWord")}),!!username?.length&&!utils.KW.test(username)&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.usernameFormatError")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#birthDate",children:[t("login.birthDate"),(0,jsx_runtime.jsx)("input",{id:"birthDate",name:"birthDate",type:"date",required:!0,autoComplete:"bday"})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.birthDateHelper")})}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#password",children:[t("login.password"),(0,jsx_runtime.jsx)("input",{id:"password",name:"password",type:"password",required:!0,autoComplete:"new-password",placeholder:t("login.password")||"Password",onChange:e=>setPassword(e.target.value),"aria-invalid":!pwdAcceptable})]}),!pwdAcceptable&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.passwordFormatError")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#confirm-password",children:[t("login.confirmPassword"),(0,jsx_runtime.jsx)("input",{id:"confirm-password",name:"confirmPassword",type:"password",required:!0,autoComplete:"new-password",placeholder:t("login.confirmPassword")||"Password",onChange:e=>setConfirmPassword(e.target.value),"aria-invalid":!!password?.length&&!!confirmPassword?.length&&password!==confirmPassword})]}),!!password?.length&&!!confirmPassword?.length&&password!==confirmPassword&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.passwordMatchingError")}),(0,jsx_runtime.jsx)("meter",{className:"memori--login-drawer--password-meter",min:0,low:33,high:66,optimum:80,max:100,value:pwdMeterValue,id:"password-strength-meter"}),(0,jsx_runtime.jsx)("small",{children:t("login.pwd"+(pwdGreen?"Strong":pwdAcceptable?"Acceptable":"Weak"))}),(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"tnCAndPPAccepted",required:!0,className:"memori-checkbox--input"}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.privacyLabel")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/privacy_and_cookie`,target:"_blank",rel:"noopener noreferrer",children:t("login.privacyAndCookiePolicy")})," ",t("login.and")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/tos`,target:"_blank",rel:"noopener noreferrer",children:t("login.termsOfService")})]})]}),(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"pAndCUAccepted",className:"memori-checkbox--input"}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.pAndCUAccepted")," ",(0,jsx_runtime.jsx)("small",{children:(0,jsx_runtime.jsxs)("em",{children:["(",t("login.optional"),")"]})})]})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.deepThoughtExplaination")})}),(0,jsx_runtime.jsx)(Button.A,{htmlType:"submit",primary:!0,loading,children:t("login.signUp")}),(0,jsx_runtime.jsxs)("p",{className:"memori--login-drawer--signup",children:[t("login.alreadyHaveAnAccount")," ",(0,jsx_runtime.jsx)(Button.A,{outlined:!0,onClick:goToLogin,children:t("login.backToLogin")})]})]}),error&&(0,jsx_runtime.jsx)("p",{role:"alert",className:"memori--login-drawer--error",children:error})]})},SignupForm_SignupForm=SignupForm;try{SignupForm.displayName="SignupForm",SignupForm.__docgenInfo={description:"",displayName:"SignupForm",props:{tenant:{defaultValue:null,description:"",name:"tenant",required:!0,type:{name:"Tenant"}},apiClient:{defaultValue:null,description:"",name:"apiClient",required:!0,type:{name:'{ constants: { BACKEND_URL: string; ENGINE_URL: string; allowedMediaTypes: string[]; anonTag: "👤"; }; asset: { getResourceUrl: ({ type, resourceURI, sessionID, baseURL, }: ResourceURLParams) => string; }; getAllFunctions: (sessionId: string) => Promise<...>; ... 137 more ...; backend: { ...; }; }'}},onLogin:{defaultValue:null,description:"",name:"onLogin",required:!0,type:{name:"(user: User, token: string) => void"}},goToLogin:{defaultValue:null,description:"",name:"goToLogin",required:!0,type:{name:"() => void"}},__TEST__waitingForOtp:{defaultValue:{value:"false"},description:"",name:"__TEST__waitingForOtp",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/SignupForm/SignupForm.tsx#SignupForm"]={docgenInfo:SignupForm.__docgenInfo,name:"SignupForm",path:"src/components/SignupForm/SignupForm.tsx#SignupForm"})}catch(__react_docgen_typescript_loader_error){}var Tooltip=__webpack_require__("./src/components/ui/Tooltip.tsx");const imgMimeTypes=["image/jpeg","image/png","image/jpg","image/gif"],AccountForm=({user,loginToken,apiClient,onUserUpdate})=>{const{t,i18n}=(0,useTranslation.B)(),lang="it"===i18n.language?"it":"en",{updateUser,uploadAsset}=apiClient.backend,[email,setEmail]=(0,react.useState)(),[password,setPassword]=(0,react.useState)(),[confirmPassword,setConfirmPassword]=(0,react.useState)(),pwdAcceptable=!password||password&&utils.pF.test(password),pwdGreen=pwdAcceptable&&password&&password.length>=24,pwdEmpty=!password||0===password.length,pwdMeterValue=!pwdAcceptable||pwdEmpty?0:password.length<8?15:password.length>=32?100:(password.length-8)*(50/24)+50,[loading,setLoading]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null),sendUserUpdate=async(userID,user)=>{try{const{user:updatedUser,...resp}=await updateUser(loginToken,userID,user);0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode)))):updatedUser&&(dist.Ay.success(t("success")),onUserUpdate(updatedUser))}catch(e){let err=e;console.error("[signup]",err),err?.message&&dist.Ay.error(err.message)}finally{setLoading(!1)}};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"memori--login-drawer--edit-account-title",children:t("login.editAccount")}),(0,jsx_runtime.jsxs)("form",{className:"memori--login-drawer--form memori--login-drawer--account-form",onSubmit:async e=>{if(e.preventDefault(),!user.userID)return;const userID=user.userID,form=e.currentTarget,eMail=form.eMail.value??email,newPassword=form.newPassword.value??password,currentPassword=form.password.value,confirmPassword=form.confirmPassword.value,pAndCUAccepted=form.pAndCUAccepted?.checked,avatar=form.avatar?.files?.[0];if(setLoading(!0),setError(null),newPassword?.length&&newPassword!==confirmPassword)return setError(t("login.passwordMatchingError")),void setLoading(!1);let patchedUser={...eMail?.length&&eMail!==user.eMail?{eMail}:{},...newPassword?{password:currentPassword,newPassword}:{},...void 0!==pAndCUAccepted&&pAndCUAccepted!==user.pAndCUAccepted?{pAndCUAccepted,pAndCUAcceptanceDate:(new Date).toISOString()}:{}};if(0===Object.values(patchedUser).length&&!avatar)return console.debug("No changes to submit"),void setLoading(!1);if(avatar){const reader=new FileReader;reader.onload=async e=>{try{const{asset:avatarAsset,...resp}=await uploadAsset(avatar.name??"avatar",e.target?.result,loginToken);0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode)))):avatarAsset&&(patchedUser.avatarURL=avatarAsset.assetURL,await sendUserUpdate(userID,patchedUser))}catch(e){let err=e;console.error("[avatar upload]",err),err?.message&&dist.Ay.error(err.message)}},reader.readAsDataURL(avatar)}else await sendUserUpdate(userID,patchedUser)},children:[(0,jsx_runtime.jsxs)("details",{className:"memori--details",children:[(0,jsx_runtime.jsx)("summary",{children:t("login.emailChange")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#eMail",children:[t("login.email"),(0,jsx_runtime.jsx)("input",{type:"email",name:"eMail",id:"eMail",autoComplete:"email",placeholder:user.eMail,onChange:e=>setEmail(e.target.value),"aria-invalid":!!email?.length&&!utils.Lr.test(email)})]}),!!email?.length&&!utils.Lr.test(email)&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.emailFormatError")})]}),(0,jsx_runtime.jsxs)("details",{className:"memori--details",children:[(0,jsx_runtime.jsx)("summary",{children:t("login.passwordChange")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#password",children:[t("login.currentPassword"),(0,jsx_runtime.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"password",placeholder:t("login.currentPassword")||"Password"})]}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#newPassword",children:[t("login.newPassword"),(0,jsx_runtime.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",autoComplete:"new-password",placeholder:t("login.password")||"Password",onChange:e=>setPassword(e.target.value),"aria-invalid":!pwdAcceptable})]}),!pwdAcceptable&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.passwordFormatError")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#confirm-password",children:[t("login.confirmPassword"),(0,jsx_runtime.jsx)("input",{id:"confirm-password",name:"confirmPassword",type:"password",autoComplete:"new-password",placeholder:t("login.confirmPassword")||"Password",onChange:e=>setConfirmPassword(e.target.value),"aria-invalid":!!password?.length&&!!confirmPassword?.length&&password!==confirmPassword})]}),!!password?.length&&!!confirmPassword?.length&&password!==confirmPassword&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.passwordMatchingError")}),(0,jsx_runtime.jsx)("meter",{className:"memori--login-drawer--password-meter",min:0,low:33,high:66,optimum:80,max:100,value:pwdMeterValue,id:"password-strength-meter"}),(0,jsx_runtime.jsx)("small",{children:t("login.pwd"+(pwdGreen?"Strong":pwdAcceptable?"Acceptable":"Weak"))})]}),(0,jsx_runtime.jsxs)("details",{className:"memori--details",children:[(0,jsx_runtime.jsx)("summary",{children:t("login.avatarChange")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#avatar",children:["Avatar",(0,jsx_runtime.jsx)("input",{type:"file",name:"avatar",id:"avatar",accept:imgMimeTypes.join(", "),placeholder:user.avatarURL})]})]}),(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox memori-checkbox--disabled",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"tnCAndPPAccepted",disabled:!0,defaultChecked:user.tnCAndPPAccepted,checked:user.tnCAndPPAccepted,className:"memori-checkbox--input"}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.privacyLabel")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/privacy_and_cookie`,target:"_blank",rel:"noopener noreferrer",children:t("login.privacyAndCookiePolicy")})," ",t("login.and")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/tos`,target:"_blank",rel:"noopener noreferrer",children:t("login.termsOfService")})]})]}),(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"pAndCUAccepted",className:"memori-checkbox--input",defaultChecked:user.pAndCUAccepted}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsx)(Tooltip.A,{align:"left",content:t("login.deepThoughtExplaination"),children:(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.pAndCUAccepted")," ",(0,jsx_runtime.jsx)("small",{children:(0,jsx_runtime.jsxs)("em",{children:["(",t("login.optional"),")"]})})]})})]}),(0,jsx_runtime.jsx)(Button.A,{htmlType:"submit",primary:!0,loading,children:t("login.save")})]}),error&&(0,jsx_runtime.jsx)("p",{role:"alert",className:"memori--login-drawer--error",children:error})]})},AccountForm_AccountForm=AccountForm;try{AccountForm.displayName="AccountForm",AccountForm.__docgenInfo={description:"",displayName:"AccountForm",props:{user:{defaultValue:null,description:"",name:"user",required:!0,type:{name:"User"}},loginToken:{defaultValue:null,description:"",name:"loginToken",required:!0,type:{name:"string"}},apiClient:{defaultValue:null,description:"",name:"apiClient",required:!0,type:{name:'{ constants: { BACKEND_URL: string; ENGINE_URL: string; allowedMediaTypes: string[]; anonTag: "👤"; }; asset: { getResourceUrl: ({ type, resourceURI, sessionID, baseURL, }: ResourceURLParams) => string; }; getAllFunctions: (sessionId: string) => Promise<...>; ... 137 more ...; backend: { ...; }; }'}},onUserUpdate:{defaultValue:null,description:"",name:"onUserUpdate",required:!0,type:{name:"(user: User) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/AccountForm/AccountForm.tsx#AccountForm"]={docgenInfo:AccountForm.__docgenInfo,name:"AccountForm",path:"src/components/AccountForm/AccountForm.tsx#AccountForm"})}catch(__react_docgen_typescript_loader_error){}const LoginDrawer=({open=!1,onClose,onLogin,onLogout,user,loginToken,tenant,apiClient,baseURL,__TEST__signup=!1,__TEST__needMissingData=!1,__TEST__waitingForOtp=!1,__TEST__changePwd=!1})=>{const{t,i18n}=(0,useTranslation.B)(),lang="it"===i18n.language?"it":"en",{userLogin,updateUser}=apiClient.backend,isUserLoggedIn=user?.userID&&loginToken,[loading,setLoading]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null),[otpCode,setOtpCode]=(0,react.useState)(""),[otpUserName,setOtpUserName]=(0,react.useState)(""),[otpError,setOtpError]=(0,react.useState)(null),[showOtpForm,setShowOtpForm]=(0,react.useState)(!1),[otpTimer,setOtpTimer]=(0,react.useState)(null),[showSignup,setShowSignup]=(0,react.useState)(__TEST__signup),[userMustChangePwd,setUserMustChangePwd]=(0,react.useState)(__TEST__changePwd?{flowID:"flowID",tenant:tenant.name,eMail:"email",userName:"username",password:"password"}:void 0),[needsMissingData,setNeedsMissingData]=(0,react.useState)(__TEST__needMissingData?{token:"token",birthDate:!0,tnCAndPPAccepted:!0}:{});(0,react.useEffect)(()=>{let interval;return otpTimer&&otpTimer>0&&(interval=setInterval(()=>{setOtpTimer(prev=>prev&&prev>0?prev-1:0)},1e3)),()=>{interval&&clearInterval(interval)}},[otpTimer]);const handleOtpChange=value=>{const numericValue=value.replace(/\D/g,"").slice(0,4);setOtpCode(numericValue),setOtpError(null),4===numericValue.length&&otpUserName.trim().length>0&&(async otp=>{if(otp&&4===otp.length)if(otpUserName&&0!==otpUserName.trim().length){setLoading(!0),setOtpError(null);try{const response=await fetch(`${baseURL}/api/validate-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({otp,userName:otpUserName.trim()})}),data=await response.json();200==response.status&&data.user&&data.loginToken?(dist.Ay.success(t("login.otpSuccess")),setShowOtpForm(!1),setOtpCode(""),setOtpUserName(""),data.user?.tnCAndPPAccepted&&data.user?.birthDate?onLogin(data.user,data.loginToken):setNeedsMissingData({token:data.loginToken,birthDate:!data.user.birthDate,tnCAndPPAccepted:!data.user.tnCAndPPAccepted})):setOtpError(data.resultMessage||t("login.otpInvalid"))}catch(err){console.error("[OTP VALIDATION]",err),setOtpError(t("login.otpError"))}finally{setLoading(!1)}}else setOtpError(t("login.userNameRequired"));else setOtpError(t("login.otpInvalidFormat"))})(numericValue)},startOtpTimer=()=>{setOtpTimer(60)},[password,setPassword]=(0,react.useState)(),[confirmPassword,setConfirmPassword]=(0,react.useState)(),pwdAcceptable=!password||password&&utils.pF.test(password),pwdGreen=pwdAcceptable&&password&&password.length>=24,pwdEmpty=!password||0===password.length,pwdMeterValue=!pwdAcceptable||pwdEmpty?0:password.length<8?15:password.length>=32?100:(password.length-8)*(50/24)+50;return(0,jsx_runtime.jsx)(Drawer.A,{open,onClose,className:classnames_default()("memori--login-drawer",{"memori--login-drawer--logged":isUserLoggedIn,"memori--login-drawer--signup":showSignup}),title:(0,jsx_runtime.jsx)("span",{className:"memori--login-drawer--title",children:isUserLoggedIn?t("login.loggedDrawerTitle",{name:user.userName}):t(showSignup?"login.signupDrawerTitle":"login.loginDrawerTitle")}),children:isUserLoggedIn?(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--logged",children:[user.avatarURL&&(0,jsx_runtime.jsx)("figure",{className:"memori--login-drawer--avatar",children:(0,jsx_runtime.jsx)("img",{src:user.avatarURL,alt:user.userName})}),(0,jsx_runtime.jsx)(Button.A,{primary:!0,onClick:()=>{onLogout()},children:t("login.logout")}),(0,jsx_runtime.jsx)(AccountForm_AccountForm,{user,loginToken,apiClient,onUserUpdate:user=>onLogin(user,loginToken)})]}):needsMissingData?.token?.length?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{children:t("login.missingData")}),(0,jsx_runtime.jsx)("p",{children:t("login.missingDataHelper")}),(0,jsx_runtime.jsxs)("form",{className:"memori--login-drawer--form",onSubmit:async e=>{e.preventDefault();const form=e.currentTarget,birthDate=form.birthDate?.value,tnCAndPPAccepted=form.tnCAndPPAccepted?.checked,pAndCUAccepted=form.pAndCUAccepted?.checked;if(!user?.userID||!needsMissingData?.token)return;if(!birthDate||!tnCAndPPAccepted)return void setError(t("missingData"));let newUser={userID:user.userID,birthDate:user?.birthDate||!needsMissingData.birthDate?void 0:birthDate,tnCAndPPAccepted:tnCAndPPAccepted||user?.tnCAndPPAccepted,tnCAndPPAcceptanceDate:tnCAndPPAccepted?(new Date).toISOString():void 0,pAndCUAccepted:pAndCUAccepted||user?.pAndCUAccepted,pAndCUAcceptanceDate:pAndCUAccepted?(new Date).toISOString():void 0};const{user:patchedUser,...resp}=await updateUser(needsMissingData.token,user.userID,newUser);0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode))),setError(resp.resultMessage)):(dist.Ay.success(t("success")),onLogin(patchedUser||newUser,needsMissingData.token))},children:[needsMissingData.birthDate&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("label",{htmlFor:"#birthDate",children:[t("login.birthDate"),(0,jsx_runtime.jsx)("input",{id:"birthDate",name:"birthDate",type:"date",required:!0,autoComplete:"bday"})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.birthDateHelper")})})]}),needsMissingData?.tnCAndPPAccepted&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"tnCAndPPAccepted",className:"memori-checkbox--input"}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.privacyLabel")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/privacy_and_cookie`,target:"_blank",rel:"noopener noreferrer",children:t("login.privacyAndCookiePolicy")})," ",t("login.and")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/tos`,target:"_blank",rel:"noopener noreferrer",children:t("login.termsOfService")})]})]}),(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"pAndCUAccepted",defaultChecked:user?.pAndCUAccepted,className:"memori-checkbox--input"}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.pAndCUAccepted")," ",(0,jsx_runtime.jsx)("small",{children:(0,jsx_runtime.jsxs)("em",{children:["(",t("login.optional"),")"]})})]})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.goToAccountToChangeYourPreferences")})}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.deepThoughtExplaination")})})]}),(0,jsx_runtime.jsx)(Button.A,{htmlType:"submit",primary:!0,loading,children:t("login.save")})]})]}):userMustChangePwd?.flowID?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("p",{children:t("login.mustChangePassword")}),(0,jsx_runtime.jsxs)("form",{className:"memori--login-drawer--form",onSubmit:async e=>{e.preventDefault();const form=e.currentTarget,tenantID=form.tenant.value??tenant.name,flowID=form.flowID.value??userMustChangePwd?.flowID,eMail=form.eMail.value??userMustChangePwd?.eMail,userName=form.userName.value??userMustChangePwd?.userName,password=form.password.value??userMustChangePwd?.password,newPassword=form.newPassword.value;if(!newPassword?.length||!pwdAcceptable)return void setError(t("login.passwordFormatError"));setLoading(!0);const user={tenant:tenantID,flowID,eMail,userName,password,newPassword};try{const{user:patchedUser,token,...resp}=await userLogin(user);0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode))),setError(resp.resultMessage)):patchedUser&&token&&(dist.Ay.success(t("success")),onLogin(patchedUser||user,token))}catch(e){let err=e;console.error("[LOGIN/CHANGE PWD]",err),err.message&&(dist.Ay.error(err.message),setError(err.message))}finally{setLoading(!1)}},children:[(0,jsx_runtime.jsx)("input",{type:"hidden",name:"tenant",value:userMustChangePwd.tenant??tenant?.name}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"flowID",value:userMustChangePwd.flowID}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"eMail",value:userMustChangePwd.eMail}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"userName",value:userMustChangePwd.userName}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"password",value:userMustChangePwd.password}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#newPassword",children:[t("login.password"),(0,jsx_runtime.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",required:!0,autoComplete:"new-password",placeholder:t("login.password")||"Password",onChange:e=>setPassword(e.target.value),"aria-invalid":!pwdAcceptable})]}),!pwdAcceptable&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.passwordFormatError")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#confirm-password",children:[t("login.confirmPassword"),(0,jsx_runtime.jsx)("input",{id:"confirm-password",name:"confirmPassword",type:"password",required:!0,autoComplete:"new-password",placeholder:t("login.confirmPassword")||"Password",onChange:e=>setConfirmPassword(e.target.value),"aria-invalid":!!password?.length&&!!confirmPassword?.length&&password!==confirmPassword})]}),!!password?.length&&!!confirmPassword?.length&&password!==confirmPassword&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.passwordMatchingError")}),(0,jsx_runtime.jsx)("meter",{className:"memori--login-drawer--password-meter",min:0,low:33,high:66,optimum:80,max:100,value:pwdMeterValue,id:"password-strength-meter"}),(0,jsx_runtime.jsx)("small",{children:t("login.pwd"+(pwdGreen?"Strong":pwdAcceptable?"Acceptable":"Weak"))}),(0,jsx_runtime.jsx)(Button.A,{htmlType:"submit",primary:!0,loading,children:t("confirm")})]})]}):showSignup?(0,jsx_runtime.jsx)(SignupForm_SignupForm,{tenant,apiClient,onLogin:(_user,token)=>{setNeedsMissingData({token,birthDate:!0,tnCAndPPAccepted:!0})},goToLogin:()=>setShowSignup(!1),__TEST__waitingForOtp}):showOtpForm?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-container",children:[(0,jsx_runtime.jsx)("h3",{children:t("login.otpTitle")}),(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--otp-description",children:t("login.otpDescription")}),(0,jsx_runtime.jsxs)("div",{className:classnames_default()("memori--login-drawer--otp-form",{loading}),children:[(0,jsx_runtime.jsxs)("label",{htmlFor:"otp-username",children:[(0,jsx_runtime.jsx)("span",{children:t("login.userName")}),(0,jsx_runtime.jsx)("input",{id:"otp-username",type:"text",className:"memori--login-drawer--otp-username-input",value:otpUserName,onChange:e=>{return value=e.target.value,setOtpUserName(value),void setOtpError(null);var value},placeholder:t("login.userName")||"Username",required:!0,autoComplete:"username",disabled:loading})]}),(0,jsx_runtime.jsxs)("label",{htmlFor:"otp-code",children:[(0,jsx_runtime.jsx)("span",{children:t("login.otpCode")}),(0,jsx_runtime.jsx)("input",{id:"otp-code",type:"text",className:classnames_default()("memori--login-drawer--otp-input",{success:4===otpCode.length&&!otpError}),value:otpCode,onChange:e=>handleOtpChange(e.target.value),placeholder:"0000",maxLength:4,autoComplete:"one-time-code",required:!0,disabled:loading})]})]}),otpTimer&&otpTimer>0&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--otp-timer",children:t("login.otpTimer",{seconds:otpTimer})}),(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-actions",children:[(0,jsx_runtime.jsx)(Button.A,{outlined:!0,onClick:()=>{setShowOtpForm(!1),setOtpCode(""),setOtpUserName(""),setOtpError(null)},children:t("login.backToLogin")}),(0,jsx_runtime.jsx)(Button.A,{primary:!0,onClick:()=>{window.open("http://localhost:3000/it/account?t=account","_blank"),startOtpTimer()},children:t("login.generateOtp")})]}),otpError&&(0,jsx_runtime.jsx)("p",{role:"alert",className:"memori--login-drawer--otp-error",children:otpError})]})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--welcome",children:[(0,jsx_runtime.jsx)("h3",{children:t("login.welcomeTitle")}),(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--welcome-description",children:t("login.welcomeDescription")}),(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-info",children:[(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-info-item",children:[(0,jsx_runtime.jsx)("span",{className:"memori--login-drawer--otp-info-number",children:"1"}),(0,jsx_runtime.jsx)("span",{children:t("login.otpStep1")})]}),(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-info-item",children:[(0,jsx_runtime.jsx)("span",{className:"memori--login-drawer--otp-info-number",children:"2"}),(0,jsx_runtime.jsx)("span",{children:t("login.otpStep2")})]}),(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-info-item",children:[(0,jsx_runtime.jsx)("span",{className:"memori--login-drawer--otp-info-number",children:"3"}),(0,jsx_runtime.jsx)("span",{children:t("login.otpStep3")})]})]}),(0,jsx_runtime.jsx)(Button.A,{primary:!0,onClick:()=>{setShowOtpForm(!0),startOtpTimer()},className:"memori--login-drawer--start-otp-button",children:t("login.startOtpLogin")})]}),error&&(0,jsx_runtime.jsx)("p",{role:"alert",className:"memori--login-drawer--error",children:error})]})})};LoginDrawer.displayName="LoginDrawer";const LoginDrawer_LoginDrawer=LoginDrawer;try{LoginDrawer.displayName="LoginDrawer",LoginDrawer.__docgenInfo={description:"",displayName:"LoginDrawer",props:{open:{defaultValue:{value:"false"},description:"",name:"open",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},user:{defaultValue:null,description:"",name:"user",required:!1,type:{name:"User"}},loginToken:{defaultValue:null,description:"",name:"loginToken",required:!1,type:{name:"string"}},onLogin:{defaultValue:null,description:"",name:"onLogin",required:!0,type:{name:"(user: User, token: string) => void"}},onLogout:{defaultValue:null,description:"",name:"onLogout",required:!0,type:{name:"() => void"}},tenant:{defaultValue:null,description:"",name:"tenant",required:!0,type:{name:"Tenant"}},apiClient:{defaultValue:null,description:"",name:"apiClient",required:!0,type:{name:'{ constants: { BACKEND_URL: string; ENGINE_URL: string; allowedMediaTypes: string[]; anonTag: "👤"; }; asset: { getResourceUrl: ({ type, resourceURI, sessionID, baseURL, }: ResourceURLParams) => string; }; getAllFunctions: (sessionId: string) => Promise<...>; ... 137 more ...; backend: { ...; }; }'}},baseURL:{defaultValue:null,description:"",name:"baseURL",required:!1,type:{name:"string"}},__TEST__signup:{defaultValue:{value:"false"},description:"",name:"__TEST__signup",required:!1,type:{name:"boolean"}},__TEST__needMissingData:{defaultValue:{value:"false"},description:"",name:"__TEST__needMissingData",required:!1,type:{name:"boolean"}},__TEST__waitingForOtp:{defaultValue:{value:"false"},description:"",name:"__TEST__waitingForOtp",required:!1,type:{name:"boolean"}},__TEST__changePwd:{defaultValue:{value:"false"},description:"",name:"__TEST__changePwd",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/LoginDrawer/LoginDrawer.tsx#LoginDrawer"]={docgenInfo:LoginDrawer.__docgenInfo,name:"LoginDrawer",path:"src/components/LoginDrawer/LoginDrawer.tsx#LoginDrawer"})}catch(__react_docgen_typescript_loader_error){}}}]);