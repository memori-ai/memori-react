"use strict";(self.webpackChunk_memori_ai_memori_react=self.webpackChunk_memori_ai_memori_react||[]).push([[5268],{"./src/components/FilePreview/FilePreview.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_icons_Document__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/components/icons/Document.tsx"),_icons_Close__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/icons/Close.tsx"),_ui_Button__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/ui/Button.tsx"),_ui_Modal__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/components/ui/Modal.tsx"),_helpers_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/helpers/utils.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");const FilePreview=({previewFiles,removeFile,allowRemove=!0,isMessagePreview=!1})=>{const[selectedFile,setSelectedFile]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null),[hoveredId,setHoveredId]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null),getFileType=(filename,type)=>{if("image"===type){const extension=filename.split(".").pop()?.toLowerCase();switch(extension){case"jpg":case"jpeg":return"JPEG";case"png":return"PNG";default:return"Image"}}const extension=filename.split(".").pop()?.toLowerCase();switch(extension){case"pdf":return"PDF";case"txt":return"Text";case"json":return"JSON";case"xlsx":return"Excel";case"csv":return"CSV";case"jpg":case"jpeg":return"JPEG";case"png":return"PNG";default:return"Document"}},isImageContent=(content,type)=>{if("image"===type)return!0;const hasImageExtension=/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(content);return content.startsWith("http")&&(content.includes("/image/")||content.includes("/img/")||hasImageExtension)||hasImageExtension};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[previewFiles.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"memori--preview-container  "+(isMessagePreview?"memori--message-preview":"memori--absolute-preview"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"memori--preview-list",children:previewFiles.map((file=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"memori--preview-item "+(isImageContent(file.content,file.type)?"memori--preview-item--image":"memori--preview-item--document"),onMouseEnter:()=>setHoveredId(file.id),onMouseLeave:()=>setHoveredId(null),onClick:()=>setSelectedFile(file),children:[isImageContent(file.content,file.type)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"memori--preview-thumbnail",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("img",{src:file.content,alt:file.name})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_icons_Document__WEBPACK_IMPORTED_MODULE_1__.DocumentIcon,{className:"memori--preview-icon"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"memori--preview-file-info",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"memori--preview-filename",children:file.name}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"memori--preview-filetype",children:getFileType(file.name,file.type)})]}),allowRemove&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_3__.Z,{shape:"rounded",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_icons_Close__WEBPACK_IMPORTED_MODULE_2__.default,{}),danger:!0,className:"memori--remove-button "+(hoveredId===file.id?"visible":""),onClick:e=>{e.stopPropagation(),removeFile(file.id,file?.mediumID)}})]},file.id)))})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_4__.Z,{width:"80%",widthMd:"80%",open:!!selectedFile,className:"memori--modal-preview-file",onClose:()=>setSelectedFile(null),closable:!0,title:selectedFile?.name,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"memori--preview-content",style:{maxHeight:"70vh",overflowY:"auto",textAlign:"center",whiteSpace:selectedFile&&!isImageContent(selectedFile.content,selectedFile.type)?"pre-wrap":"normal"},children:selectedFile&&isImageContent(selectedFile.content,selectedFile.type)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("img",{src:selectedFile.content,alt:selectedFile.name,style:{maxWidth:"100%",maxHeight:"60vh"}}):(0,_helpers_utils__WEBPACK_IMPORTED_MODULE_5__.Cb)(selectedFile?.content||"")})})]})},__WEBPACK_DEFAULT_EXPORT__=FilePreview;try{FilePreview.displayName="FilePreview",FilePreview.__docgenInfo={description:"",displayName:"FilePreview",props:{previewFiles:{defaultValue:null,description:"",name:"previewFiles",required:!0,type:{name:"any"}},removeFile:{defaultValue:null,description:"",name:"removeFile",required:!0,type:{name:"(id: string, mediumID: string | undefined) => void"}},allowRemove:{defaultValue:{value:"true"},description:"",name:"allowRemove",required:!1,type:{name:"boolean"}},isMessagePreview:{defaultValue:{value:"false"},description:"",name:"isMessagePreview",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/FilePreview/FilePreview.tsx#FilePreview"]={docgenInfo:FilePreview.__docgenInfo,name:"FilePreview",path:"src/components/FilePreview/FilePreview.tsx#FilePreview"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/UploadButton/UploadButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>UploadButton_UploadButton});var react=__webpack_require__("./node_modules/react/index.js"),Document=__webpack_require__("./src/components/icons/Document.tsx"),Image=__webpack_require__("./src/components/icons/Image.tsx"),Upload=__webpack_require__("./src/components/icons/Upload.tsx"),Spin=__webpack_require__("./src/components/ui/Spin.tsx"),Alert=__webpack_require__("./src/components/ui/Alert.tsx"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),Modal=__webpack_require__("./src/components/ui/Modal.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const UploadDocuments=({setDocumentPreviewFiles})=>{const[isLoading,setIsLoading]=(0,react.useState)(!1),[errors,setErrors]=(0,react.useState)([]),[previewFiles,setPreviewFiles]=(0,react.useState)([]),[selectedFile,setSelectedFile]=(0,react.useState)(null),documentInputRef=(0,react.useRef)(null),removeError=errorMessage=>{setErrors((prev=>prev.filter((e=>e.message!==errorMessage))))},addError=error=>{setErrors((prev=>[...prev,error])),setTimeout((()=>removeError(error.message)),5e3)},processDocumentFile=async file=>{const fileExt=file.name.split(".").pop()?.toLowerCase()||"";try{let text=null;return"pdf"===fileExt?text=await(async file=>{try{window.pdfjsLib||await new Promise(((resolve,reject)=>{const script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",script.onload=()=>{window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",resolve(!0)},script.onerror=reject,document.head.appendChild(script)}));const arrayBuffer=await file.arrayBuffer(),pdf=await window.pdfjsLib.getDocument({data:arrayBuffer}).promise;let text="";for(let i=1;i<=pdf.numPages;i++){const page=await pdf.getPage(i);text+=(await page.getTextContent()).items.filter((item=>item.str&&"string"==typeof item.str)).map((item=>item.str)).join(" ")+"\n"}return text}catch(error){throw new Error(`PDF extraction failed: ${error instanceof Error?error.message:"Unknown error"}`)}})(file):["txt","md","json","csv"].includes(fileExt)?text=await file.text():"xlsx"===fileExt&&(text=await(async file=>{try{window.XLSX||await new Promise(((resolve,reject)=>{const script=document.createElement("script");script.src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js",script.onload=resolve,script.onerror=reject,document.head.appendChild(script)}));const arrayBuffer=await file.arrayBuffer(),workbook=window.XLSX.read(arrayBuffer,{type:"array",cellFormula:!0,cellNF:!0,cellText:!0,cellDates:!0});let text="";for(const sheetName of workbook.SheetNames){const worksheet=workbook.Sheets[sheetName],data=window.XLSX.utils.sheet_to_json(worksheet,{header:1,raw:!1}),colWidths=data.reduce(((widths,row)=>(row.forEach(((cell,i)=>{const cellWidth=(cell||"").toString().length;widths[i]=Math.max(widths[i]||0,cellWidth)})),widths)),[]),formattedText=data.map((row=>row.map(((cell,i)=>(cell||"").toString().padEnd(colWidths[i]+2))).join("|").trim()));if(formattedText.length>0){const separator=colWidths.map((w=>"-".repeat(w+2))).join("+");formattedText.splice(1,0,separator)}text+=`Sheet: ${sheetName}\n${formattedText.join("\n")}\n\n`}return text}catch(error){throw new Error(`XLSX extraction failed: ${error instanceof Error?error.message:"Unknown error"}`)}})(file)),text&&text.length>1e5&&(addError({message:`File "${file.name}" content exceeds 100000 characters and was truncated`,severity:"warning",fileId:file.name}),text=text.substring(0,1e5)+"\n\n[Content truncated due to size limits]"),text}catch(error){throw new Error(`Failed to process "${file.name}": ${error instanceof Error?error.message:"Unknown error"}`)}};return(0,jsx_runtime.jsxs)("div",{className:"memori--document-upload-wrapper",children:[(0,jsx_runtime.jsx)("input",{ref:documentInputRef,type:"file",accept:".pdf,.txt,.md,.json,.xlsx,.csv",className:"memori--upload-file-input",onChange:async e=>{const files=Array.from(e.target.files||[]);if(0===files.length)return;const file=files[0];if(setIsLoading(!0),setErrors([]),!(file=>{const fileExt=`.${file.name.split(".").pop()?.toLowerCase()}`,ALLOWED_FILE_TYPES=[".pdf",".txt",".json",".xlsx",".csv",".md"];return ALLOWED_FILE_TYPES.includes(fileExt)?!(file.size>10485760&&(addError({message:`File "${file.name}" exceeds 10MB limit`,severity:"error",fileId:file.name}),1)):(addError({message:`File type "${fileExt}" is not supported. Please use: ${ALLOWED_FILE_TYPES.join(", ")}`,severity:"error",fileId:file.name}),!1)})(file))return setIsLoading(!1),void(documentInputRef.current&&(documentInputRef.current.value=""));const fileId=Math.random().toString(36).substr(2,9);try{const text=await processDocumentFile(file);if(text){const newPreviewFile={name:file.name,id:fileId,content:text,type:"document"};setPreviewFiles([newPreviewFile]),setDocumentPreviewFiles([{name:file.name,id:fileId,content:text}])}}catch(error){addError({message:`${error instanceof Error?error.message:"Unknown error"}`,severity:"error",fileId:file.name})}setIsLoading(!1),documentInputRef.current&&(documentInputRef.current.value="")}}),(0,jsx_runtime.jsx)("button",{className:classnames_default()("memori-button","memori-button--circle","memori-button--icon-only","memori-share-button--button","memori--conversation-button","memori--document-upload-button",{"memori--error":errors.length>0}),onClick:()=>documentInputRef.current?.click(),disabled:isLoading,title:"Upload documents",children:isLoading?(0,jsx_runtime.jsx)(Spin.Z,{spinning:!0,className:"memori--upload-icon"}):(0,jsx_runtime.jsx)(react.Fragment,{children:(0,jsx_runtime.jsx)(Document.DocumentIcon,{className:"memori--upload-icon"})})}),(0,jsx_runtime.jsx)(Modal.Z,{width:"80%",widthMd:"80%",open:!!selectedFile,className:"memori--modal-preview-file",onClose:()=>setSelectedFile(null),closable:!0,title:selectedFile?.name,children:(0,jsx_runtime.jsx)("div",{className:"memori--preview-content",style:{maxHeight:"70vh",overflowY:"auto",textAlign:"center",whiteSpace:"pre-wrap"},children:selectedFile?.content})}),(0,jsx_runtime.jsx)("div",{className:"memori--error-message-container",children:errors.map(((error,index)=>(0,jsx_runtime.jsx)(Alert.Z,{open:!0,type:error.severity,title:"Upload notification",description:error.message,onClose:()=>removeError(error.message),width:"350px"},`${error.message}-${index}`)))})]})};UploadDocuments.displayName="UploadDocuments";const UploadDocuments_UploadDocuments=UploadDocuments;try{UploadDocuments.displayName="UploadDocuments",UploadDocuments.__docgenInfo={description:"",displayName:"UploadDocuments",props:{setDocumentPreviewFiles:{defaultValue:null,description:"",name:"setDocumentPreviewFiles",required:!0,type:{name:"(files: { name: string; id: string; content: string; }[]) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/UploadButton/UploadDocuments/UploadDocuments.tsx#UploadDocuments"]={docgenInfo:UploadDocuments.__docgenInfo,name:"UploadDocuments",path:"src/components/UploadButton/UploadDocuments/UploadDocuments.tsx#UploadDocuments"})}catch(__react_docgen_typescript_loader_error){}var esm=__webpack_require__("./node_modules/@memori.ai/memori-api-client/esm/index.js");const ALLOWED_FILE_TYPES=[".jpg",".jpeg",".png"],UploadImages=({authToken="",apiUrl="",sessionID="",isMediaAccepted=!1,setDocumentPreviewFiles,documentPreviewFiles,onLoadingChange})=>{const client=apiUrl?(0,esm.Z)(apiUrl):null,{backend,dialog}=client||{backend:{uploadAsset:null},dialog:{postMediumSelectedEvent:null,postMediumDeselectedEvent:null}},[isLoading,setIsLoading]=(0,react.useState)(!1),[errors,setErrors]=(0,react.useState)([]),[previewFiles,setPreviewFiles]=(0,react.useState)([]),[selectedFile,setSelectedFile]=(0,react.useState)(null),[hoveredId,setHoveredId]=(0,react.useState)(null),[imageFiles,setImageFiles]=(0,react.useState)([]),imageInputRef=(0,react.useRef)(null);(0,react.useEffect)((()=>{onLoadingChange&&onLoadingChange(isLoading)}),[isLoading,onLoadingChange]);const removeError=errorMessage=>{setErrors((prev=>prev.filter((e=>e.message!==errorMessage))))},addError=error=>{setErrors((prev=>[...prev,error])),setTimeout((()=>removeError(error.message)),5e3)},validateImageFile=file=>{const fileExt=`.${file.name.split(".").pop()?.toLowerCase()}`;return ALLOWED_FILE_TYPES.includes(fileExt)||file.type.startsWith("image/")?!(file.size>10485760)||(addError({message:`File "${file.name}" exceeds 10MB limit`,severity:"error",fileId:file.name}),!1):(addError({message:`File type "${fileExt}" is not supported. Please use: ${ALLOWED_FILE_TYPES.join(", ")}`,severity:"error",fileId:file.name}),!1)};return(0,jsx_runtime.jsxs)("div",{className:"memori--image-upload-wrapper",children:[(0,jsx_runtime.jsx)("input",{ref:imageInputRef,type:"file",accept:ALLOWED_FILE_TYPES.join(","),className:"memori--upload-file-input",onChange:async e=>{const files=Array.from(e.target.files||[]);if(0!==files.length){setIsLoading(!0),setErrors([]);for(const file of files){if(!validateImageFile(file))continue;const fileId=Math.random().toString(36).substr(2,9),previewUrl=URL.createObjectURL(file);setPreviewFiles((prev=>[...prev,{name:file.name,id:fileId,content:"",type:"image",previewUrl,uploaded:!1}]));try{const reader=new FileReader;reader.onload=async e=>{const fileDataUrl=e.target?.result;if(backend?.uploadAsset&&authToken)try{const{asset,...resp}=await backend.uploadAsset(file.name,fileDataUrl,authToken);if(0!==resp.resultCode)throw new Error(resp.resultMessage||"Upload failed");const newImageFile={name:file.name||"",id:fileId,content:asset.assetURL||"",type:"image"};setPreviewFiles((prev=>prev.map((item=>item.id===fileId?{...item,content:asset.assetURL,uploaded:!0}:item)))),setImageFiles((prev=>[...prev,newImageFile]));let finalMediumID,medium=null;if(dialog?.postMediumSelectedEvent&&sessionID&&(medium=await dialog.postMediumSelectedEvent(sessionID,{url:asset.assetURL,mimeType:asset.mimeType}),console.log("medium",medium)),medium?.currentState?.currentMedia){const existingMediumIDs=new Set(documentPreviewFiles.map((file=>file.mediumID)));finalMediumID=medium.currentState.currentMedia.find((media=>!existingMediumIDs.has(media.mediumID)))?.mediumID,console.log("finalMediumID",finalMediumID)}setDocumentPreviewFiles((prevFiles=>[...prevFiles,{name:file.name,id:fileId,content:asset.assetURL,type:"image",mediumID:finalMediumID}]))}catch(error){setPreviewFiles((prev=>prev.map((item=>item.id===fileId?{...item,error:!0}:item)))),addError({message:`Upload failed: ${error instanceof Error?error.message:"Unknown error"}`,severity:"error",fileId:file.name})}else addError({message:"API client not configured properly for media upload",severity:"warning"})},reader.onerror=()=>{addError({message:"File reading failed",severity:"error",fileId:file.name})},reader.readAsDataURL(file)}catch(error){addError({message:`Upload failed: ${error instanceof Error?error.message:"Unknown error"}`,severity:"error",fileId:file.name})}}setIsLoading(!1),imageInputRef.current&&(imageInputRef.current.value="")}},disabled:!isMediaAccepted||!authToken,multiple:!0}),(0,jsx_runtime.jsx)("button",{className:classnames_default()("memori-button","memori-button--circle","memori-button--icon-only","memori-share-button--button","memori--conversation-button","memori--image-upload-button",{"memori--error":errors.length>0}),onClick:()=>isMediaAccepted&&authToken&&imageInputRef.current?.click(),disabled:isLoading||!isMediaAccepted||!authToken,title:authToken?"Upload image":"Please login to upload images",children:isLoading?(0,jsx_runtime.jsx)(Spin.Z,{spinning:!0,className:"memori--upload-icon"}):(0,jsx_runtime.jsx)(Image.ImageIcon,{className:"memori--upload-icon"})}),(0,jsx_runtime.jsx)(Modal.Z,{width:"80%",widthMd:"80%",open:!!selectedFile,className:"memori--modal-preview-file",onClose:()=>setSelectedFile(null),closable:!0,title:selectedFile?.name,children:(0,jsx_runtime.jsxs)("div",{className:"memori--preview-content",style:{maxHeight:"70vh",overflowY:"auto",textAlign:"center"},children:[selectedFile?.previewUrl?(0,jsx_runtime.jsx)("img",{src:selectedFile.previewUrl,alt:selectedFile.name,style:{maxWidth:"100%",maxHeight:"60vh"}}):null,selectedFile?.uploaded&&(0,jsx_runtime.jsxs)("div",{className:"memori--asset-info",children:[(0,jsx_runtime.jsx)("p",{children:"Uploaded successfully"}),selectedFile.content&&(0,jsx_runtime.jsxs)("p",{className:"memori--asset-url",children:["Asset URL: ",selectedFile.content]})]})]})}),(0,jsx_runtime.jsx)("div",{className:"memori--error-message-container",children:errors.map(((error,index)=>(0,jsx_runtime.jsx)(Alert.Z,{open:!0,type:error.severity,title:"Upload notification",description:error.message,onClose:()=>removeError(error.message),width:"350px"},`${error.message}-${index}`)))}),!authToken&&(0,jsx_runtime.jsx)("div",{className:"memori--login-tip",children:(0,jsx_runtime.jsx)(Alert.Z,{type:"info",title:"Login Required",description:"Please login to upload images",width:"350px",onClose:()=>{}})})]})};UploadImages.displayName="UploadImages";const UploadImages_UploadImages=UploadImages;try{UploadImages.displayName="UploadImages",UploadImages.__docgenInfo={description:"",displayName:"UploadImages",props:{authToken:{defaultValue:{value:""},description:"",name:"authToken",required:!1,type:{name:"string"}},apiUrl:{defaultValue:{value:""},description:"",name:"apiUrl",required:!1,type:{name:"string"}},sessionID:{defaultValue:{value:""},description:"",name:"sessionID",required:!1,type:{name:"string"}},isMediaAccepted:{defaultValue:{value:"false"},description:"",name:"isMediaAccepted",required:!1,type:{name:"boolean"}},setDocumentPreviewFiles:{defaultValue:null,description:"",name:"setDocumentPreviewFiles",required:!0,type:{name:"any"}},documentPreviewFiles:{defaultValue:null,description:"",name:"documentPreviewFiles",required:!0,type:{name:"any"}},onLoadingChange:{defaultValue:null,description:"",name:"onLoadingChange",required:!1,type:{name:"((loading: boolean) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/UploadButton/UploadImages/UploadImages.tsx#UploadImages"]={docgenInfo:UploadImages.__docgenInfo,name:"UploadImages",path:"src/components/UploadButton/UploadImages/UploadImages.tsx#UploadImages"})}catch(__react_docgen_typescript_loader_error){}const UploadButton=({authToken="",apiUrl="",sessionID="",isMediaAccepted=!1,setDocumentPreviewFiles,documentPreviewFiles})=>{const[isLoading,setIsLoading]=(0,react.useState)(!1),[menuOpen,setMenuOpen]=(0,react.useState)(!1),[errors,setErrors]=(0,react.useState)([]),menuRef=(0,react.useRef)(null),buttonRef=(0,react.useRef)(null),documentRef=(0,react.useRef)(null),imageRef=(0,react.useRef)(null),removeError=errorMessage=>{setErrors((prev=>prev.filter((e=>e.message!==errorMessage))))},closeMenu=()=>{setMenuOpen(!1)};(0,react.useEffect)((()=>{const handleClickOutside=event=>{menuRef.current&&buttonRef.current&&!menuRef.current.contains(event.target)&&!buttonRef.current.contains(event.target)&&closeMenu()};return document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}}),[]),(0,react.useEffect)((()=>{const handleClickOutside=event=>{menuRef.current&&buttonRef.current&&!menuRef.current.contains(event.target)&&!buttonRef.current.contains(event.target)&&closeMenu()};return document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}}),[]);return(0,jsx_runtime.jsxs)("div",{className:"memori--unified-upload-wrapper",children:[(0,jsx_runtime.jsx)("button",{ref:buttonRef,className:classnames_default()("memori-button","memori-button--circle","memori-button--icon-only","memori-share-button--button","memori--conversation-button","memori--unified-upload-button",{"memori--error":errors.length>0}),onClick:()=>{setMenuOpen((prev=>!prev))},disabled:isLoading,title:"Upload files",children:isLoading?(0,jsx_runtime.jsx)(Spin.Z,{spinning:!0,className:"memori--upload-icon"}):(0,jsx_runtime.jsx)(Upload.UploadIcon,{className:"memori--upload-icon"})}),menuOpen&&(0,jsx_runtime.jsxs)("div",{className:"memori--upload-menu",ref:menuRef,children:[(0,jsx_runtime.jsxs)("div",{className:"memori--upload-menu-item",onClick:()=>{const documentButtonElement=documentRef.current?.querySelector("button");documentButtonElement&&documentButtonElement.click(),closeMenu()},children:[(0,jsx_runtime.jsx)(Document.DocumentIcon,{className:"memori--upload-menu-icon"}),(0,jsx_runtime.jsxs)("span",{children:["Upload Document",documentPreviewFiles.length>0?" (Replace)":""]})]}),(0,jsx_runtime.jsxs)("div",{className:classnames_default()("memori--upload-menu-item",{"memori--upload-menu-item--disabled":!isMediaAccepted||!authToken}),onClick:()=>{if(isMediaAccepted&&authToken){const imageButtonElement=imageRef.current?.querySelector("button");imageButtonElement&&imageButtonElement.click()}else authToken||(error={message:"Please login to upload images",severity:"info"},setErrors((prev=>[...prev,error])),setTimeout((()=>removeError(error.message)),5e3));var error;closeMenu()},title:authToken?"Upload image":"Please login to upload images",children:[(0,jsx_runtime.jsx)(Image.ImageIcon,{className:"memori--upload-menu-icon-image"}),(0,jsx_runtime.jsx)("span",{children:"Upload Image"})]})]}),(0,jsx_runtime.jsx)("div",{className:"memori--hidden-uploader",ref:documentRef,children:(0,jsx_runtime.jsx)(UploadDocuments_UploadDocuments,{setDocumentPreviewFiles:files=>{if(0===files.length)return;const file=files[0],formattedContent=`<Documento allegato al messaggio: ${file.name}>\n${file.content}\n</Documento allegato al messaggio: ${file.name}>`;setDocumentPreviewFiles([{name:file.name,id:file.id,content:formattedContent}]),setIsLoading(!1)}})}),(0,jsx_runtime.jsx)("div",{className:"memori--hidden-uploader",ref:imageRef,children:(0,jsx_runtime.jsx)(UploadImages_UploadImages,{authToken,apiUrl,setDocumentPreviewFiles,sessionID,documentPreviewFiles,isMediaAccepted})}),(0,jsx_runtime.jsx)("div",{className:"memori--error-message-container",children:errors.map(((error,index)=>(0,jsx_runtime.jsx)(Alert.Z,{open:!0,type:error.severity,title:"Upload notification",description:error.message,onClose:()=>removeError(error.message),width:"350px"},`${error.message}-${index}`)))}),!authToken&&menuOpen&&(0,jsx_runtime.jsx)("div",{className:"memori--login-tip",children:(0,jsx_runtime.jsx)(Alert.Z,{type:"info",title:"Login Required",description:"Please login to upload images",width:"350px",onClose:closeMenu})})]})};UploadButton.displayName="UploadButton";const UploadButton_UploadButton=UploadButton;try{UploadButton.displayName="UploadButton",UploadButton.__docgenInfo={description:"",displayName:"UploadButton",props:{authToken:{defaultValue:{value:""},description:"",name:"authToken",required:!1,type:{name:"string"}},apiUrl:{defaultValue:{value:""},description:"",name:"apiUrl",required:!1,type:{name:"string"}},sessionID:{defaultValue:{value:""},description:"",name:"sessionID",required:!1,type:{name:"string"}},isMediaAccepted:{defaultValue:{value:"false"},description:"",name:"isMediaAccepted",required:!1,type:{name:"boolean"}},setDocumentPreviewFiles:{defaultValue:null,description:"",name:"setDocumentPreviewFiles",required:!0,type:{name:"any"}},documentPreviewFiles:{defaultValue:null,description:"",name:"documentPreviewFiles",required:!0,type:{name:"{ name: string; id: string; content: string; mediumID?: string | undefined; }[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/UploadButton/UploadButton.tsx#UploadButton"]={docgenInfo:UploadButton.__docgenInfo,name:"UploadButton",path:"src/components/UploadButton/UploadButton.tsx#UploadButton"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/Document.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DocumentIcon:()=>DocumentIcon,default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const DocumentIcon=({className})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("svg",{className,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M14 2.5H6C5.60218 2.5 5.22064 2.65804 4.93934 2.93934C4.65804 3.22064 4.5 3.60218 4.5 4V20C4.5 20.3978 4.65804 20.7794 4.93934 21.0607C5.22064 21.342 5.60218 21.5 6 21.5H18C18.3978 21.5 18.7794 21.342 19.0607 21.0607C19.342 20.7794 19.5 20.3978 19.5 20V8L14 2.5Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M14 2.5V8H19.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M16 13H8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M16 17H8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M10 9H8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]});DocumentIcon.displayName="DocumentIcon";const __WEBPACK_DEFAULT_EXPORT__=DocumentIcon;try{DocumentIcon.displayName="DocumentIcon",DocumentIcon.__docgenInfo={description:"",displayName:"DocumentIcon",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Document.tsx#DocumentIcon"]={docgenInfo:DocumentIcon.__docgenInfo,name:"DocumentIcon",path:"src/components/icons/Document.tsx#DocumentIcon"})}catch(__react_docgen_typescript_loader_error){}try{Document.displayName="Document",Document.__docgenInfo={description:"",displayName:"Document",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Document.tsx#Document"]={docgenInfo:Document.__docgenInfo,name:"Document",path:"src/components/icons/Document.tsx#Document"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/Image.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ImageIcon:()=>ImageIcon});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const ImageIcon=({className})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("svg",{className,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M21 15L16 10L5 21",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]});ImageIcon.displayName="ImageIcon";try{ImageIcon.displayName="ImageIcon",ImageIcon.__docgenInfo={description:"",displayName:"ImageIcon",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Image.tsx#ImageIcon"]={docgenInfo:ImageIcon.__docgenInfo,name:"ImageIcon",path:"src/components/icons/Image.tsx#ImageIcon"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/icons/Upload.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{UploadIcon:()=>UploadIcon});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const UploadIcon=({className})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("svg",{className,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M17 8L12 3L7 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M12 3V15",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]});UploadIcon.displayName="UploadIcon";try{UploadIcon.displayName="UploadIcon",UploadIcon.__docgenInfo={description:"",displayName:"UploadIcon",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/icons/Upload.tsx#UploadIcon"]={docgenInfo:UploadIcon.__docgenInfo,name:"UploadIcon",path:"src/components/icons/Upload.tsx#UploadIcon"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/ui/Alert.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_headlessui_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@headlessui/react/dist/components/transitions/transition.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_icons_Close__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/icons/Close.tsx"),_Button__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/ui/Button.tsx"),react_i18next__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Alert=({open=!1,onClose,className,title,description,children,type="info",icon,closable=!0,duration=null,action,width="400px"})=>{const{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_5__.$)();react__WEBPACK_IMPORTED_MODULE_0__.useEffect((()=>{if(duration&&open){const timer=setTimeout((()=>{onClose(!1)}),duration);return()=>clearTimeout(timer)}}),[duration,open,onClose]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_6__.u,{show:open,as:react__WEBPACK_IMPORTED_MODULE_0__.Fragment,appear:!0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("memori-alert",(type=>{switch(type){case"success":return"memori-alert--success";case"warning":return"memori-alert--warning";case"error":return"memori-alert--error";default:return"memori-alert--info"}})(type),className),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("style",{dangerouslySetInnerHTML:{__html:`\n              .memori-alert {\n                --memori-alert--width: ${width};\n              }\n            `}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_headlessui_react__WEBPACK_IMPORTED_MODULE_6__.u.Child,{as:react__WEBPACK_IMPORTED_MODULE_0__.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4",enterTo:"opacity-100 translate-y-0",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"memori-alert--container",children:[icon&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"memori-alert--icon",children:icon}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"memori-alert--content",children:[title&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"memori-alert--title",children:title}),description&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"memori-alert--description",children:description}),children]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"memori-alert--actions",children:[action&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"memori-alert--action",children:action}),closable&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_3__.Z,{ghost:!0,padded:!0,shape:"circle",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_icons_Close__WEBPACK_IMPORTED_MODULE_2__.default,{}),title:t("close")||"Close",onClick:()=>onClose(!1),className:"memori-alert--close"})]})]})})]})})};Alert.displayName="Alert";const __WEBPACK_DEFAULT_EXPORT__=Alert;try{Alert.displayName="Alert",Alert.__docgenInfo={description:"",displayName:"Alert",props:{open:{defaultValue:{value:"false"},description:"",name:"open",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"(value: boolean) => void"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"Element | ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"Element | ReactNode"}},type:{defaultValue:{value:"info"},description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"success"'},{value:'"warning"'},{value:'"error"'},{value:'"info"'}]}},icon:{defaultValue:null,description:"",name:"icon",required:!1,type:{name:"Element | ReactNode"}},closable:{defaultValue:{value:"true"},description:"",name:"closable",required:!1,type:{name:"boolean"}},duration:{defaultValue:{value:"null"},description:"",name:"duration",required:!1,type:{name:"number | null"}},action:{defaultValue:null,description:"",name:"action",required:!1,type:{name:"Element | ReactNode"}},width:{defaultValue:{value:"400px"},description:"",name:"width",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ui/Alert.tsx#Alert"]={docgenInfo:Alert.__docgenInfo,name:"Alert",path:"src/components/ui/Alert.tsx#Alert"})}catch(__react_docgen_typescript_loader_error){}}}]);