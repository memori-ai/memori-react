"use strict";(self.webpackChunk_memori_ai_memori_react=self.webpackChunk_memori_ai_memori_react||[]).push([[7017],{"./src/components/LoginDrawer/LoginDrawer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>LoginDrawer_LoginDrawer});var react=__webpack_require__("./node_modules/react/index.js"),Button=__webpack_require__("./src/components/ui/Button.tsx"),Drawer=__webpack_require__("./src/components/ui/Drawer.tsx"),dist=__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),helpers_error=__webpack_require__("./src/helpers/error.ts"),utils=__webpack_require__("./src/helpers/utils.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const reservedUserNames=["memori","private","public","api","404","500","it","en","account","auth","logout","privacy_and_cookie","unauthorized","users","virtual_spaces"],SignupForm=({tenant,apiClient,onLogin,goToLogin,__TEST__waitingForOtp=!1})=>{const{t,i18n}=(0,useTranslation.B)(),lang="it"===i18n.language?"it":"en",{userSignUp,userConfirmSignUp,resendVerificationCode}=apiClient.backend,[email,setEmail]=(0,react.useState)(),[username,setUsername]=(0,react.useState)(),[password,setPassword]=(0,react.useState)(),[confirmPassword,setConfirmPassword]=(0,react.useState)(),pwdAcceptable=!password||password&&utils.pF.test(password),pwdGreen=pwdAcceptable&&password&&password.length>=24,pwdEmpty=!password||0===password.length,pwdMeterValue=!pwdAcceptable||pwdEmpty?0:password.length<8?15:password.length>=32?100:(password.length-8)*(50/24)+50,[loading,setLoading]=(0,react.useState)(!1),[loadingOtp,setLoadingOtp]=(0,react.useState)(!1),[waitingForOtp,setWaitingForOtp]=(0,react.useState)(__TEST__waitingForOtp),[error,setError]=(0,react.useState)(null),[referral,setReferral]=(0,react.useState)();(0,react.useEffect)(()=>{setReferral(window.location.href)},[]);return waitingForOtp?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("form",{className:"memori--login-drawer--form",onSubmit:async e=>{e.preventDefault();const form=e.currentTarget,tenantID=form.tenant.value??tenant.name,userName=form.userName.value??username,pwd=form.password.value??password,verificationCode=form.verificationCode.value;setLoading(!0),setError(null);try{const{user,token,...resp}=await userConfirmSignUp({tenant:tenantID,userName,password:pwd,verificationCode});0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode)))):user&&token&&(dist.Ay.success(t("success")),onLogin(user,token))}catch(e){let err=e;console.error("[validate otp]",err),err?.message&&dist.Ay.error(err.message)}finally{setLoading(!1)}},children:[(0,jsx_runtime.jsx)("input",{type:"hidden",name:"userName",value:username}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"password",value:password}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"tenant",value:tenant.name}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#verificationCode",children:[t("login.otpCode"),(0,jsx_runtime.jsx)("input",{id:"verificationCode",name:"verificationCode",type:"text",required:!0,autoComplete:"one-time-code",placeholder:t("login.otpCode")||"OTP"})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)(Button.A,{outlined:!0,onClick:async e=>{if(e.preventDefault(),username){setLoadingOtp(!0);try{const resp=await resendVerificationCode({tenant:tenant?.name,userName:username});0===resp.resultCode?dist.Ay.success(t("resentVerificationCode")):(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode))))}catch(e){let err=e;console.error("[resend otp]",err),err?.message&&dist.Ay.error(err.message)}finally{setLoadingOtp(!1)}}},loading:loadingOtp,children:t("login.resendVerificationCode")})}),(0,jsx_runtime.jsx)(Button.A,{htmlType:"submit",primary:!0,loading,children:t("confirm")})]}),error&&(0,jsx_runtime.jsx)("p",{role:"alert",className:"memori--login-drawer--error",children:error})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("form",{className:"memori--login-drawer--form",onSubmit:async e=>{e.preventDefault();const form=e.currentTarget,tenantID=form.tenant.value??tenant.name,eMail=(form.eMail.value??email).toLowerCase(),userName=form.userName.value??username,password=form.password.value,birthDate=new Date(form.birthDate?.value).toISOString(),tnCAndPPAccepted=form.tnCAndPPAccepted?.checked,pAndCUAccepted=form.pAndCUAccepted?.checked,referral=form.referral?.value;if(!(eMail&&userName&&password&&birthDate&&tnCAndPPAccepted))return void setError(t("missingData"));setLoading(!0),setError(null);if(((new Date).getTime()-new Date(birthDate).getTime())/1e3/60/60/24/365<14)return dist.Ay.error(t("login.underage",{age:14})),void setError(t("login.underage",{age:14}));try{const{user,...resp}=await userSignUp({tenant:tenantID,eMail,userName,password,birthDate,tnCAndPPAccepted,tnCAndPPAcceptanceDate:(new Date).toISOString(),pAndCUAccepted,pAndCUAcceptanceDate:(new Date).toISOString(),referral});0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode)))):user&&(dist.Ay.success(t("success")),setWaitingForOtp(!0))}catch(e){let err=e;console.error("[signup]",err),err?.message&&dist.Ay.error(err.message)}finally{setLoading(!1)}},children:[(0,jsx_runtime.jsx)("input",{type:"hidden",name:"tenant",value:tenant.name}),(0,jsx_runtime.jsx)("input",{type:"hidden",name:"referral",value:referral}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#eMail",children:[t("login.email"),(0,jsx_runtime.jsx)("input",{type:"email",name:"eMail",id:"eMail",required:!0,autoComplete:"email",placeholder:t("login.email")||"Email",onChange:e=>setEmail(e.target.value),"aria-invalid":!!email?.length&&!utils.Lr.test(email)})]}),!!email?.length&&!utils.Lr.test(email)&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.emailFormatError")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"userName",children:[t("login.username"),(0,jsx_runtime.jsx)("input",{type:"text",name:"userName",id:"userName",required:!0,autoComplete:"username",placeholder:t("login.username")||"Username",onFocus:()=>{if(!username?.length&&email?.length){let username=(email=>email.split("@")[0].replace(/[^a-zA-Z0-9]/g,""))(email);const field=document.getElementById("userName");field&&(field.value=username,setUsername(username))}},onChange:e=>setUsername(e.target.value),"aria-invalid":!!username?.length&&(reservedUserNames.includes(username.toLowerCase())||!utils.KW.test(username))})]}),!!username?.length&&reservedUserNames.includes(username.toLowerCase())&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.usernameContainsReservedWord")}),!!username?.length&&!utils.KW.test(username)&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.usernameFormatError")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#birthDate",children:[t("login.birthDate"),(0,jsx_runtime.jsx)("input",{id:"birthDate",name:"birthDate",type:"date",required:!0,autoComplete:"bday"})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.birthDateHelper")})}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#password",children:[t("login.password"),(0,jsx_runtime.jsx)("input",{id:"password",name:"password",type:"password",required:!0,autoComplete:"new-password",placeholder:t("login.password")||"Password",onChange:e=>setPassword(e.target.value),"aria-invalid":!pwdAcceptable})]}),!pwdAcceptable&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.passwordFormatError")}),(0,jsx_runtime.jsxs)("label",{htmlFor:"#confirm-password",children:[t("login.confirmPassword"),(0,jsx_runtime.jsx)("input",{id:"confirm-password",name:"confirmPassword",type:"password",required:!0,autoComplete:"new-password",placeholder:t("login.confirmPassword")||"Password",onChange:e=>setConfirmPassword(e.target.value),"aria-invalid":!!password?.length&&!!confirmPassword?.length&&password!==confirmPassword})]}),!!password?.length&&!!confirmPassword?.length&&password!==confirmPassword&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:t("login.passwordMatchingError")}),(0,jsx_runtime.jsx)("meter",{className:"memori--login-drawer--password-meter",min:0,low:33,high:66,optimum:80,max:100,value:pwdMeterValue,id:"password-strength-meter"}),(0,jsx_runtime.jsx)("small",{children:t("login.pwd"+(pwdGreen?"Strong":pwdAcceptable?"Acceptable":"Weak"))}),(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"tnCAndPPAccepted",required:!0,className:"memori-checkbox--input"}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.privacyLabel")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/privacy_and_cookie`,target:"_blank",rel:"noopener noreferrer",children:t("login.privacyAndCookiePolicy")})," ",t("login.and")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/tos`,target:"_blank",rel:"noopener noreferrer",children:t("login.termsOfService")})]})]}),(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"pAndCUAccepted",className:"memori-checkbox--input"}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.pAndCUAccepted")," ",(0,jsx_runtime.jsx)("small",{children:(0,jsx_runtime.jsxs)("em",{children:["(",t("login.optional"),")"]})})]})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.deepThoughtExplaination")})}),(0,jsx_runtime.jsx)(Button.A,{htmlType:"submit",primary:!0,loading,children:t("login.signUp")}),(0,jsx_runtime.jsxs)("p",{className:"memori--login-drawer--signup",children:[t("login.alreadyHaveAnAccount")," ",(0,jsx_runtime.jsx)(Button.A,{outlined:!0,onClick:goToLogin,children:t("login.backToLogin")})]})]}),error&&(0,jsx_runtime.jsx)("p",{role:"alert",className:"memori--login-drawer--error",children:error})]})},SignupForm_SignupForm=SignupForm;try{SignupForm.displayName="SignupForm",SignupForm.__docgenInfo={description:"",displayName:"SignupForm",props:{tenant:{defaultValue:null,description:"",name:"tenant",required:!0,type:{name:"Tenant"}},apiClient:{defaultValue:null,description:"",name:"apiClient",required:!0,type:{name:'{ constants: { BACKEND_URL: string; ENGINE_URL: string; allowedMediaTypes: string[]; anonTag: "👤"; }; asset: { getResourceUrl: ({ type, resourceURI, sessionID, baseURL, }: ResourceURLParams) => string; }; getAllFunctions: (sessionId: string) => Promise<...>; ... 137 more ...; backend: { ...; }; }'}},onLogin:{defaultValue:null,description:"",name:"onLogin",required:!0,type:{name:"(user: User, token: string) => void"}},goToLogin:{defaultValue:null,description:"",name:"goToLogin",required:!0,type:{name:"() => void"}},__TEST__waitingForOtp:{defaultValue:{value:"false"},description:"",name:"__TEST__waitingForOtp",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/SignupForm/SignupForm.tsx#SignupForm"]={docgenInfo:SignupForm.__docgenInfo,name:"SignupForm",path:"src/components/SignupForm/SignupForm.tsx#SignupForm"})}catch(__react_docgen_typescript_loader_error){}const LoginDrawer=({open=!1,onClose,onLogin,user,loginToken,setUser,tenant,apiClient,__TEST__signup=!1,__TEST__needMissingData=!1,__TEST__waitingForOtp=!1})=>{const{t,i18n}=(0,useTranslation.B)(),lang="it"===i18n.language?"it":"en",{pwlUpdateUser,loginWithOTP,validateOTPCode,pwlGetCurrentUser,uploadAsset}=apiClient.backend,isUserLoggedIn=user?.userID&&loginToken,[loading,setLoading]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null),[otpCode,setOtpCode]=(0,react.useState)(""),[otpEmail,setOtpEmail]=(0,react.useState)(""),[otpError,setOtpError]=(0,react.useState)(null),[showOtpForm,setShowOtpForm]=(0,react.useState)(!0),[showOtpCodeForm,setShowOtpCodeForm]=(0,react.useState)(!1),[otpTimer,setOtpTimer]=(0,react.useState)(null),[otpSent,setOtpSent]=(0,react.useState)(!1),[avatar,setAvatar]=(0,react.useState)(null),[isResending,setIsResending]=(0,react.useState)(!1),[otpSuccess,setOtpSuccess]=(0,react.useState)(!1),[emailValid,setEmailValid]=(0,react.useState)(!1),[birthDate,setBirthDate]=(0,react.useState)(""),[tnCAndPPAccepted,setTnCAndPPAccepted]=(0,react.useState)(!1),[pAndCUAccepted,setPAndCUAccepted]=(0,react.useState)(!1),[showSignup,setShowSignup]=(0,react.useState)(__TEST__signup),[needsMissingData,setNeedsMissingData]=(0,react.useState)(__TEST__needMissingData?{token:"token",birthDate:!0,tnCAndPPAccepted:!0}:{});(0,react.useEffect)(()=>{let interval;return otpTimer&&otpTimer>0&&(interval=setInterval(()=>{setOtpTimer(prev=>prev&&prev>0?prev-1:0)},1e3)),()=>{interval&&clearInterval(interval)}},[otpTimer]);const sendOtpToEmail=async(email,isResend=!1)=>{if(email&&utils.Lr.test(email)){isResend?setIsResending(!0):setLoading(!0),setOtpError(null);try{const response=await loginWithOTP({tenant:tenant.name,eMail:email.trim()});0===response.resultCode?(dist.Ay.success(t(isResend?"login.otpResent":"login.otpSent")),setOtpEmail(email.trim()),setOtpSent(!0),setShowOtpCodeForm(!0),startOtpTimer(),setOtpSuccess(!1)):setOtpError(response.resultMessage||t("login.otpSendError"))}catch(err){console.error("[OTP SEND]",err),setOtpError(t("login.otpSendError"))}finally{setLoading(!1),setIsResending(!1)}}else setOtpError(t("login.emailInvalid"))},handleOtpChange=value=>{const numericValue=value.replace(/\D/g,"").slice(0,4);setOtpCode(numericValue),setOtpError(null),4===numericValue.length&&otpEmail.trim().length>0&&(async otp=>{if(otp&&4===otp.length)if(otpEmail&&0!==otpEmail.trim().length){setLoading(!0),setOtpError(null);try{const response=await validateOTPCode(otp,tenant.name,void 0,otpEmail.trim());0===response.resultCode?(setOtpSuccess(!0),dist.Ay.success(t("login.otpSuccess")),setTimeout(async()=>{try{const{user,...resp}=await pwlGetCurrentUser(response.newSessionToken);user.age&&user.tnCAndPPAccepted?onLogin(user,response.newSessionToken):(setUser(user),setBirthDate(user?.birthDate??""),setTnCAndPPAccepted(user?.tnCAndPPAccepted??!1),setPAndCUAccepted(user?.pAndCUAccepted??!1),setNeedsMissingData({token:response.newSessionToken,birthDate:!user.age,tnCAndPPAccepted:!user.tnCAndPPAccepted}))}catch(err){console.error("[GET USER]",err),dist.Ay.error(t("login.userFetchError"))}},1e3),setTimeout(()=>{setShowOtpForm(!1),setShowOtpCodeForm(!1),setOtpCode(""),setOtpEmail(""),setOtpSent(!1),setOtpSuccess(!1)},2e3)):-107===response.resultCode?setOtpError(t("login.otpNotFound")):-108===response.resultCode?setOtpError(t("login.otpExpired")):-109===response.resultCode?setOtpError(t("login.otpMissing")):setOtpError(response.resultMessage||t("login.otpInvalid"))}catch(err){console.error("[OTP VALIDATION]",err),setOtpError(t("login.otpError"))}finally{setLoading(!1)}}else setOtpError(t("login.emailRequired"));else setOtpError(t("login.otpInvalidFormat"))})(numericValue)},startOtpTimer=()=>{setOtpTimer(60)};return(0,jsx_runtime.jsx)(Drawer.A,{open,onClose,className:classnames_default()("memori--login-drawer",{"memori--login-drawer--logged":isUserLoggedIn,"memori--login-drawer--signup":showSignup}),children:needsMissingData?.token?.length?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{children:t("login.missingData")}),(0,jsx_runtime.jsx)("p",{children:t("login.missingDataHelper")}),(0,jsx_runtime.jsxs)("form",{className:"memori--login-drawer--form",onSubmit:async e=>{if(e.preventDefault(),!user?.userID||!needsMissingData?.token)return void setError(t("login.userNotFound"));if(!birthDate||!tnCAndPPAccepted)return void setError(t("missingData"));let newUser={userID:user.userID,birthDate:user?.birthDate||!needsMissingData.birthDate?void 0:birthDate,tnCAndPPAccepted:tnCAndPPAccepted||user?.tnCAndPPAccepted,tnCAndPPAcceptanceDate:tnCAndPPAccepted?(new Date).toISOString():void 0,pAndCUAccepted:pAndCUAccepted||user?.pAndCUAccepted,pAndCUAcceptanceDate:pAndCUAccepted?(new Date).toISOString():void 0};const{user:patchedUser,...resp}=await pwlUpdateUser(needsMissingData.token,user.userID,newUser);0!==resp.resultCode?(console.error(resp),dist.Ay.error(t((0,helpers_error._)(resp.resultCode))),setError(resp.resultMessage)):(dist.Ay.success(t("success")),onLogin(patchedUser||newUser,needsMissingData.token))},children:[needsMissingData.birthDate&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("label",{htmlFor:"#birthDate",children:[t("login.birthDate"),(0,jsx_runtime.jsx)("input",{id:"birthDate",name:"birthDate",type:"date",required:!0,onChange:e=>setBirthDate(e.target.value),value:birthDate,autoComplete:"bday"})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.birthDateHelper")})})]}),needsMissingData?.tnCAndPPAccepted&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"tnCAndPPAccepted",className:"memori-checkbox--input",onChange:e=>setTnCAndPPAccepted(e.target.checked),checked:tnCAndPPAccepted}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.privacyLabel")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/privacy_and_cookie`,target:"_blank",rel:"noopener noreferrer",children:t("login.privacyAndCookiePolicy")})," ",t("login.and")," ",(0,jsx_runtime.jsx)("a",{href:`https://memori.ai/${lang}/tos`,target:"_blank",rel:"noopener noreferrer",children:t("login.termsOfService")})]})]}),(0,jsx_runtime.jsxs)("label",{className:"memori-checkbox",children:[(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--input-wrapper",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",name:"pAndCUAccepted",onChange:e=>setPAndCUAccepted(e.target.checked),checked:pAndCUAccepted,className:"memori-checkbox--input"}),(0,jsx_runtime.jsx)("span",{className:"memori-checkbox--inner"})]}),(0,jsx_runtime.jsxs)("span",{className:"memori-checkbox--text",children:[t("login.pAndCUAccepted")," ",(0,jsx_runtime.jsx)("small",{children:(0,jsx_runtime.jsxs)("em",{children:["(",t("login.optional"),")"]})})]})]}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.goToAccountToChangeYourPreferences")})}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("small",{children:t("login.deepThoughtExplaination")})})]}),error&&(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--inline-error",children:error}),(0,jsx_runtime.jsx)(Button.A,{htmlType:"submit",primary:!0,loading,children:t("login.save")})]})]}):showSignup?(0,jsx_runtime.jsx)(SignupForm_SignupForm,{tenant,apiClient,onLogin:(_user,token)=>{setNeedsMissingData({token,birthDate:!0,tnCAndPPAccepted:!0})},goToLogin:()=>setShowSignup(!1),__TEST__waitingForOtp}):showOtpCodeForm?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-container",children:[(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-header",children:[otpSuccess&&(0,jsx_runtime.jsx)("div",{className:"memori--login-drawer--otp-icon",children:"✅"}),(0,jsx_runtime.jsx)("h3",{children:t("login.otpTitle")}),(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--otp-description",children:otpSuccess?t("login.otpSuccessMessage"):t("login.otpCodeDescription",{email:otpEmail})})]}),!otpSuccess&&(0,jsx_runtime.jsx)("div",{className:classnames_default()("memori--login-drawer--otp-form",{loading}),children:(0,jsx_runtime.jsxs)("label",{htmlFor:"otp-code",className:"memori--login-drawer--otp-label",children:[(0,jsx_runtime.jsx)("span",{className:"memori--login-drawer--otp-label-text",style:{textAlign:"center"},children:t("login.otpCode")}),(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-input-container",children:[(0,jsx_runtime.jsx)("input",{id:"otp-code",type:"text",className:classnames_default()("memori--login-drawer--otp-input",{success:4===otpCode.length&&!otpError,error:otpError,loading}),value:otpCode,onChange:e=>handleOtpChange(e.target.value),placeholder:"0000",maxLength:4,autoComplete:"one-time-code",required:!0,disabled:loading,"aria-describedby":"otp-help"}),loading&&(0,jsx_runtime.jsx)("div",{className:"memori--login-drawer--otp-loading",children:(0,jsx_runtime.jsx)("div",{className:"memori--login-drawer--otp-spinner"})})]}),(0,jsx_runtime.jsx)("small",{id:"otp-help",className:"memori--login-drawer--otp-help",children:t("login.otpHelp")})]})}),otpTimer&&otpTimer>0&&!otpSuccess&&(0,jsx_runtime.jsx)("div",{className:"memori--login-drawer--otp-timer",children:(0,jsx_runtime.jsx)("span",{children:t("login.otpTimer",{seconds:otpTimer})})}),!otpSuccess&&(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-actions",children:[(0,jsx_runtime.jsx)(Button.A,{outlined:!0,onClick:()=>{setShowOtpCodeForm(!1),setOtpCode(""),setOtpError(null)},disabled:loading,children:t("login.backToEmail")}),(0,jsx_runtime.jsx)(Button.A,{outlined:!0,onClick:()=>{otpEmail&&utils.Lr.test(otpEmail)&&sendOtpToEmail(otpEmail,!0)},disabled:loading||isResending||otpTimer&&otpTimer>0||!otpEmail,loading:isResending,children:t(isResending?"login.resending":"login.resendOtp")})]}),otpError&&(0,jsx_runtime.jsxs)("div",{role:"alert",className:"memori--login-drawer--otp-error",children:[(0,jsx_runtime.jsx)("span",{className:"memori--login-drawer--otp-error-icon",children:"⚠️"}),(0,jsx_runtime.jsx)("span",{children:otpError})]})]})}):showOtpForm?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-container",children:[(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-header",children:[(0,jsx_runtime.jsx)("h3",{children:t("login.otpEmailTitle")}),(0,jsx_runtime.jsx)("p",{className:"memori--login-drawer--otp-description",children:t("login.otpEmailDescription")})]}),(0,jsx_runtime.jsx)("div",{className:classnames_default()("memori--login-drawer--otp-form",{loading}),children:(0,jsx_runtime.jsxs)("label",{htmlFor:"otp-email",className:"memori--login-drawer--otp-label",children:[(0,jsx_runtime.jsx)("span",{className:"memori--login-drawer--otp-label-text",children:t("login.email")}),(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-input-container",children:[(0,jsx_runtime.jsx)("input",{id:"otp-email",type:"email",className:classnames_default()("memori--login-drawer--otp-email-input",{error:otpError&&!utils.Lr.test(otpEmail),valid:emailValid&&!otpError,loading}),value:otpEmail,onChange:e=>{return value=e.target.value,setOtpEmail(value),setOtpError(null),void setEmailValid(utils.Lr.test(value));var value},placeholder:t("login.emailPlaceholder")||"Enter your email",autoComplete:"email",required:!0,disabled:loading,"aria-describedby":"email-help"}),emailValid&&!loading&&(0,jsx_runtime.jsx)("div",{className:"memori--login-drawer--otp-valid-icon",children:"✓"}),loading&&(0,jsx_runtime.jsx)("div",{className:"memori--login-drawer--otp-loading",children:(0,jsx_runtime.jsx)("div",{className:"memori--login-drawer--otp-spinner"})})]})]})}),(0,jsx_runtime.jsxs)("div",{className:"memori--login-drawer--otp-actions",children:[showOtpCodeForm&&(0,jsx_runtime.jsx)(Button.A,{outlined:!0,onClick:()=>{setShowOtpForm(!1),setOtpEmail(""),setOtpError(null),setEmailValid(!1)},disabled:loading,children:t("login.backToLogin")}),(0,jsx_runtime.jsx)(Button.A,{primary:!0,onClick:()=>{sendOtpToEmail(otpEmail)},disabled:loading||!emailValid,loading,children:t("login.sendOtp")})]}),otpError&&(0,jsx_runtime.jsxs)("div",{role:"alert",className:"memori--login-drawer--otp-error",children:[(0,jsx_runtime.jsx)("span",{className:"memori--login-drawer--otp-error-icon",children:"⚠️"}),(0,jsx_runtime.jsx)("span",{children:otpError})]})]})}):null})};LoginDrawer.displayName="LoginDrawer";const LoginDrawer_LoginDrawer=LoginDrawer;try{LoginDrawer.displayName="LoginDrawer",LoginDrawer.__docgenInfo={description:"",displayName:"LoginDrawer",props:{open:{defaultValue:{value:"false"},description:"",name:"open",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},user:{defaultValue:null,description:"",name:"user",required:!1,type:{name:"User"}},loginToken:{defaultValue:null,description:"",name:"loginToken",required:!1,type:{name:"string"}},onLogin:{defaultValue:null,description:"",name:"onLogin",required:!0,type:{name:"(user: User, token: string) => void"}},onLogout:{defaultValue:null,description:"",name:"onLogout",required:!0,type:{name:"() => void"}},tenant:{defaultValue:null,description:"",name:"tenant",required:!0,type:{name:"Tenant"}},apiClient:{defaultValue:null,description:"",name:"apiClient",required:!0,type:{name:'{ constants: { BACKEND_URL: string; ENGINE_URL: string; allowedMediaTypes: string[]; anonTag: "👤"; }; asset: { getResourceUrl: ({ type, resourceURI, sessionID, baseURL, }: ResourceURLParams) => string; }; getAllFunctions: (sessionId: string) => Promise<...>; ... 137 more ...; backend: { ...; }; }'}},__TEST__signup:{defaultValue:{value:"false"},description:"",name:"__TEST__signup",required:!1,type:{name:"boolean"}},__TEST__needMissingData:{defaultValue:{value:"false"},description:"",name:"__TEST__needMissingData",required:!1,type:{name:"boolean"}},__TEST__waitingForOtp:{defaultValue:{value:"false"},description:"",name:"__TEST__waitingForOtp",required:!1,type:{name:"boolean"}},setUser:{defaultValue:null,description:"",name:"setUser",required:!0,type:{name:"(user: User) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/LoginDrawer/LoginDrawer.tsx#LoginDrawer"]={docgenInfo:LoginDrawer.__docgenInfo,name:"LoginDrawer",path:"src/components/LoginDrawer/LoginDrawer.tsx#LoginDrawer"})}catch(__react_docgen_typescript_loader_error){}}}]);